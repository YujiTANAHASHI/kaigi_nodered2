[
    {
        "id": "3d69815d.415ade",
        "type": "tab",
        "label": "バッチ",
        "disabled": false,
        "info": ""
    },
    {
        "id": "99f53198.98718",
        "type": "tab",
        "label": "管理API",
        "disabled": false,
        "info": ""
    },
    {
        "id": "b36ee370.d8e85",
        "type": "tab",
        "label": "オンラインAPI（照会系）",
        "disabled": false,
        "info": ""
    },
    {
        "id": "9f3a28b9.aa8348",
        "type": "tab",
        "label": "オンラインAPI（更新系）",
        "disabled": false,
        "info": ""
    },
    {
        "id": "f3d7869e.91c5f8",
        "type": "tab",
        "label": "実験段階",
        "disabled": false,
        "info": ""
    },
    {
        "id": "8e9cc33.fffd44",
        "type": "tab",
        "label": "動作検証のページ",
        "disabled": false,
        "info": ""
    },
    {
        "id": "624e24c1.a2567c",
        "type": "subflow",
        "name": "リソース一覧取得",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 100,
                "y": 60,
                "wires": [
                    {
                        "id": "aafdc73e.cd9d18"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 600,
                "y": 140,
                "wires": [
                    {
                        "id": "41ad541f.fb38dc",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "7c664e6f.eb225",
        "type": "subflow",
        "name": "イベント登録",
        "info": "msg.payload={\nevent:\n{\n    \"subject\": \n    \"user\": \n    \"pin\":\n    \"status\":\n    \"saved\":\n}\n'param': {\n    'calendarId': calendarId,\n    'check': {\n        'timeMin': timeMin,\n        'timeMax': timeMax,\n        'timeZone': 'Asia/Tokyo',\n        'items': [{'id': calendarId}],\n    }\n}\n}\n",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 40,
                "wires": [
                    {
                        "id": "f347f5a9.1b9638"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 440,
                "y": 40,
                "wires": [
                    {
                        "id": "f347f5a9.1b9638",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "3bd1c83b.24e548",
        "type": "subflow",
        "name": "現在状況取得",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 140,
                "y": 300,
                "wires": [
                    {
                        "id": "6ef7c510.34d1ec"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 700,
                "y": 500,
                "wires": [
                    {
                        "id": "4abbe0d0.4eb99",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "25a48dc1.1a6252",
        "type": "subflow",
        "name": "認証とカレンダーオブジェクト取得toGlobal",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 80,
                "wires": [
                    {
                        "id": "814d0fc3.0e0e9"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 620,
                "y": 80,
                "wires": [
                    {
                        "id": "814d0fc3.0e0e9",
                        "port": 0
                    },
                    {
                        "id": "2d050091.06aa6",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "b43956c5.b0eb58",
        "type": "subflow",
        "name": "create commandLog",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 60,
                "wires": [
                    {
                        "id": "4e167bc5.fce494"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 420,
                "y": 60,
                "wires": [
                    {
                        "id": "4e167bc5.fce494",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "911a8268.a68b6",
        "type": "subflow",
        "name": "write log",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 100,
                "y": 60,
                "wires": [
                    {
                        "id": "997381a6.1ebad"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 380,
                "y": 60,
                "wires": [
                    {
                        "id": "997381a6.1ebad",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "dc77db7a.d03128",
        "type": "change",
        "z": "624e24c1.a2567c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.cals",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 60,
        "wires": [
            [
                "761cce4.d075c3"
            ]
        ]
    },
    {
        "id": "aafdc73e.cd9d18",
        "type": "function",
        "z": "624e24c1.a2567c",
        "name": "calendar.calendarList.list",
        "func": "var calList = [];\n  const calendar = global.get('calendar');\n\n  calendar.calendarList.list({}, (err, res) => {\n      console.log('calendarlist.list:'+err);\n      const calendarlist = res.data.items;\n      if(calendarlist.length){\n          calendarlist.map((cal, i) => {\n              console.log('calendarlist:'+cal.description)\n              if(cal.description && cal.description.lastIndexOf('Geek:',0) === 0){\n                  calList.push(cal);\n              }\n          })\n          msg.payload = {'cals':calList};\n      }\n      node.send(msg);\n  })\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 290,
        "y": 60,
        "wires": [
            [
                "dc77db7a.d03128"
            ]
        ]
    },
    {
        "id": "761cce4.d075c3",
        "type": "split",
        "z": "624e24c1.a2567c",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": "1",
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 110,
        "y": 100,
        "wires": [
            [
                "fc51c6a3.9ee598"
            ]
        ]
    },
    {
        "id": "fc51c6a3.9ee598",
        "type": "function",
        "z": "624e24c1.a2567c",
        "name": "出力形式に変換する",
        "func": "var dsk = msg.payload.description.split(':');\nvar outObj = {\n    resourceId: msg.payload.id,\n//    name: msg.payload.summary,\n    name: msg.payload.summaryOverride,\n    capacity: dsk[1],\n    description: dsk[2]\n}\nmsg.payload = outObj;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 280,
        "y": 100,
        "wires": [
            [
                "b262c692.f30018"
            ]
        ]
    },
    {
        "id": "b262c692.f30018",
        "type": "join",
        "z": "624e24c1.a2567c",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 450,
        "y": 100,
        "wires": [
            [
                "41ad541f.fb38dc"
            ]
        ]
    },
    {
        "id": "41ad541f.fb38dc",
        "type": "change",
        "z": "624e24c1.a2567c",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload.resources",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "78b5dd17.7bb6f4",
        "type": "catch",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "scope": null,
        "x": 640,
        "y": 80,
        "wires": [
            [
                "ebbb0da5.5b756"
            ]
        ]
    },
    {
        "id": "ebbb0da5.5b756",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 800,
        "y": 100,
        "wires": []
    },
    {
        "id": "257cd56d.bf1bea",
        "type": "http in",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "url": "/test/resources/:id/events/list",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 940,
        "wires": [
            [
                "ec85fd4e.e7d45",
                "502bba9e.4a6054"
            ]
        ]
    },
    {
        "id": "3ff199b.6d4d566",
        "type": "http in",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "url": "/test/resources/:id/events/list/:date",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 190,
        "y": 980,
        "wires": [
            [
                "ec85fd4e.e7d45",
                "502bba9e.4a6054"
            ]
        ]
    },
    {
        "id": "b98cfb3e.64bc18",
        "type": "change",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 900,
        "wires": [
            [
                "ec85fd4e.e7d45",
                "502bba9e.4a6054"
            ]
        ]
    },
    {
        "id": "f2630e90.2eff3",
        "type": "inject",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"id\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\",\"date\":\"2018-11-03\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 900,
        "wires": [
            [
                "b98cfb3e.64bc18"
            ]
        ]
    },
    {
        "id": "ec85fd4e.e7d45",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 450,
        "y": 900,
        "wires": []
    },
    {
        "id": "502bba9e.4a6054",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "param",
        "func": "var date = msg.req.params.date;\n\n//if(!date) {\n//    date = (new Date()).toISOString();\n//}\n\nmsg.payload = {\n    'param': {\n        calendarId: msg.req.params.id,\n        date: msg.req.params.date\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 290,
        "y": 1020,
        "wires": [
            [
                "441861f2.28d86"
            ]
        ]
    },
    {
        "id": "441861f2.28d86",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "calendar.events.list",
        "func": "var eventList = [];\nvar calendarId = msg.payload.param.calendarId;\nvar date = msg.payload.param.date;\nvar timezoneoffset = -9     // UTC-表示したいタイムゾーン(単位:hour)。JSTなら-9\nvar fakeDate = new Date(Date.now() - (timezoneoffset * 60 - new Date().getTimezoneOffset()) * 60000);\n\nif(!date){\n    date = fakeDate.toISOString().substr(0, 10);\n}\nconsole.log('date:' +date);\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        calendarId: calendarId,\n        timeMin: date + 'T00:00:00+09:00',\n        timeMax: date + 'T23:59:00+09:00',\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = {\"events\":eventList};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 450,
        "y": 1020,
        "wires": [
            [
                "d6de073c.2894c8"
            ]
        ]
    },
    {
        "id": "f39fa37.051ca6",
        "type": "inject",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"id\":\"kaigishitsu.work_3430323338373732393131@resource.calendar.google.com\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 860,
        "wires": [
            [
                "b98cfb3e.64bc18"
            ]
        ]
    },
    {
        "id": "d6de073c.2894c8",
        "type": "change",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.events",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 1020,
        "wires": [
            [
                "6053f242.3e93ec",
                "57c721f3.86b76"
            ]
        ]
    },
    {
        "id": "23d771f5.3de8fe",
        "type": "split",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": "1",
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 270,
        "y": 1060,
        "wires": [
            [
                "1e21ebd7.33ad34"
            ]
        ]
    },
    {
        "id": "1e21ebd7.33ad34",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "出力形式に変換する",
        "func": "var outObj = {\n    detail: msg.payload,\n    eventId: msg.payload.id,\n    subject: msg.payload.summary,\n    start: msg.payload.start.dateTime.substr(11,5),\n    end: msg.payload.end.dateTime.substr(11,5),\n    resource: {\n        name: msg.payload.organizer.displayName,\n        resourceId: msg.payload.organizer.email\n    }\n}\nmsg.payload = outObj;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 1060,
        "wires": [
            [
                "e58949b1.1a1188"
            ]
        ]
    },
    {
        "id": "e58949b1.1a1188",
        "type": "join",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 630,
        "y": 1060,
        "wires": [
            [
                "58b51e24.83e65"
            ]
        ]
    },
    {
        "id": "acd23eaf.48f",
        "type": "http response",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 830,
        "y": 1100,
        "wires": []
    },
    {
        "id": "58b51e24.83e65",
        "type": "change",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload.events",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 1100,
        "wires": [
            [
                "acd23eaf.48f",
                "dceffc22.1c669"
            ]
        ]
    },
    {
        "id": "1829bfd9.85a12",
        "type": "comment",
        "z": "f3d7869e.91c5f8",
        "name": "resource（会議室）別event（予約）一覧取得",
        "info": "",
        "x": 210,
        "y": 820,
        "wires": []
    },
    {
        "id": "6053f242.3e93ec",
        "type": "switch",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "property": "payload.length",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 150,
        "y": 1080,
        "wires": [
            [
                "23d771f5.3de8fe"
            ],
            [
                "58b51e24.83e65"
            ]
        ]
    },
    {
        "id": "46c5367e.37ca48",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 490,
        "y": 1180,
        "wires": []
    },
    {
        "id": "2cecdc15.c72a04",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "calendar.events.insert",
        "func": "var calList = [];\n  const calendar = global.get('calendar');\n  const auth = global.get('auth');\nvar timezone = 'Asia/Tokyo';\n\nvar returned = false;\n\n    var event = {\n      'summary': 'テスト会議',\n      'location': '',\n      'description': '0:UserA:1234',\n      'start': {\n        'dateTime': '2018-11-22T20:15:00+09:00',\n        'timeZone': 'Asia/Tokyo',\n      },\n      'end': {\n        'dateTime': '2018-11-22T20:30:00+09:00',\n        'timeZone': 'Asia/Tokyo',\n      },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n      'attendees': [\n          {'email':'kaigishitsu.work_3835353636383833343637@resource.calendar.google.com'}],\n//      'reminders': {\n//        'useDefault': false,\n//        'overrides': [\n//          {'method': 'email', 'minutes': 24 * 60},\n//          {'method': 'popup', 'minutes': 10},\n//        ],\n//      },\n    };\n    var apiOptions = {\n        auth: auth,\n        calendarId: 'master@kaigishitsu.work',\n        resource: event\n    };\n    console.log('apiOptions:'+apiOptions);\n//    calendar.events.insert(\n//        apiOptions,\n//        (err, event) => {\n//            console.log('*err:'+err);\n//            console.log('*event:'+event);\n//            msg.payload = {err: err, event: event}\n//            if (err) {\n//                console.log('There was an error contacting the Calendar service: ' + err);\n//            } else {\n//                console.log('Event created: %s', event.data.htmlLink);\n//            }\n//            node.send(msg);\n//            console.log('callback end.');\n//        }\n//    );\n\n\n    calendar.events.insert(apiOptions)\n        .then(event => {\n            msg.payload = {event: event};\n            node.send(msg);\n        })\n        .catch(err => {console.log('err:'+err)});\n\n    console.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 300,
        "y": 1180,
        "wires": [
            [
                "46c5367e.37ca48",
                "a73178e1.2ecee8"
            ]
        ]
    },
    {
        "id": "824495d1.5850a8",
        "type": "inject",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 1180,
        "wires": [
            [
                "2cecdc15.c72a04"
            ]
        ]
    },
    {
        "id": "57c721f3.86b76",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 850,
        "y": 1020,
        "wires": []
    },
    {
        "id": "809d32aa.bd3b8",
        "type": "http in",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "url": "/test/ins",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 1240,
        "wires": [
            [
                "2cecdc15.c72a04"
            ]
        ]
    },
    {
        "id": "a73178e1.2ecee8",
        "type": "http response",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 500,
        "y": 1240,
        "wires": []
    },
    {
        "id": "e6cbb782.e910a8",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "calendar.events.list",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        //calendarId: 'primary',\n        calendarId: '1pp3nr9at4s2c5f0brhhbsj7hc@group.calendar.google.com',\n        //timeMin: (new Date()).toISOString(),\n        timeMin: '2018-11-03T00:00:00+09:00',\n        timeMax: '2018-11-03T23:59:00+09:00',\n        //maxResults: 10,\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = {\"events\":eventList};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 290,
        "y": 220,
        "wires": [
            [
                "8c53f6b6.061528"
            ]
        ]
    },
    {
        "id": "30511ee4.279162",
        "type": "inject",
        "z": "8e9cc33.fffd44",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 220,
        "wires": [
            [
                "e6cbb782.e910a8"
            ]
        ]
    },
    {
        "id": "8c53f6b6.061528",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 510,
        "y": 220,
        "wires": []
    },
    {
        "id": "942d1050.cb1f3",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "calendar.calendarList.list",
        "func": "var calList = [];\n  const calendar = global.get('calendar');\n\n  calendar.calendarList.list({}, (err, res) => {\n      console.log('calendarlist.list:'+err);\n      const calendarlist = res.data.items;\n      if(calendarlist.length){\n          calendarlist.map((cal, i) => {\n              console.log('calendarlist:'+cal)\n              calList.push(cal);\n          })\n          msg.payload = {'cals':calList};\n      }\n      node.send(msg);\n  })\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 430,
        "y": 140,
        "wires": [
            [
                "cc1465a9.090a38"
            ]
        ]
    },
    {
        "id": "cc1465a9.090a38",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 630,
        "y": 140,
        "wires": []
    },
    {
        "id": "b48849d9.ad97c8",
        "type": "inject",
        "z": "8e9cc33.fffd44",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 140,
        "wires": [
            [
                "66a38a41.b44bb4"
            ]
        ]
    },
    {
        "id": "1373c2d8.cc31bd",
        "type": "inject",
        "z": "8e9cc33.fffd44",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 260,
        "wires": [
            [
                "6560df85.d0ae"
            ]
        ]
    },
    {
        "id": "6560df85.d0ae",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "calendar.events.insert",
        "func": "var calList = [];\n  const calendar = global.get('calendar');\n  const auth = global.get('auth');\n\nvar timezone = 'Asia/Tokyo';\n\n    var event = {\n      'summary': 'テスト会議',\n      'location': 'Tシアン左',\n      'description': '0:UserA:1234',\n      'start': {\n        'dateTime': '2018-11-08T18:15:00+09:00',\n        'timeZone': 'Asia/Tokyo',\n      },\n      'end': {\n        'dateTime': '2018-11-08T18:30:00+09:00',\n        'timeZone': 'Asia/Tokyo',\n      },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n      'attendees': [],\n//      'reminders': {\n//        'useDefault': false,\n//        'overrides': [\n//          {'method': 'email', 'minutes': 24 * 60},\n//          {'method': 'popup', 'minutes': 10},\n//        ],\n//      },\n    };\n    var apiOptions = {\n        auth: auth,\n        calendarId: '1pp3nr9at4s2c5f0brhhbsj7hc@group.calendar.google.com',\n        resource: event\n    };\n    console.log('apiOptions:'+apiOptions);\n    calendar.events.insert(\n        apiOptions,\n        function(err, event) {\n            console.log('err:'+err);\n            console.log('event:'+event);\n            msg.payload['err'] = err;\n            msg.payload['event'] = event;\n            if (err) {\n                console.log('There was an error contacting the Calendar service: ' + err);\n            } else {\n                console.log('Event created: %s', event.htmlLink);\n            }\n            node.send(msg);\n        }\n    );\n    console.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 300,
        "y": 260,
        "wires": [
            [
                "30fa788e.a1c318"
            ]
        ]
    },
    {
        "id": "30fa788e.a1c318",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 510,
        "y": 260,
        "wires": []
    },
    {
        "id": "d4b56902.8b1428",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "calendar.calendarList.get",
        "func": "var calList = [];\n  const calendar = global.get('calendar');\n\n  calendar.calendarList.get({\n    //calendarId: '1pp3nr9at4s2c5f0brhhbsj7hc@group.calendar.google.com',\n    calendarId: msg.payload.param.calendarId\n  }, (err, res) => {\n      console.log('calendarlist.get err:'+err);\n      console.log('calendarlist.get res:'+res);\n      const cal = res.data;\n//      if(calendarlist.length){\n//          calendarlist.map((cal, i) => {\n//              console.log('calendarlist:'+cal)\n//              calList.push(cal);\n//          })\n//          msg.payload = {'cals':calList};\n//      }\n        msg.payload['cal'] = cal;\n        node.send(msg);\n  })\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 430,
        "y": 180,
        "wires": [
            [
                "1ac7d3fd.f698ec"
            ]
        ]
    },
    {
        "id": "1ac7d3fd.f698ec",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 630,
        "y": 180,
        "wires": []
    },
    {
        "id": "563d4331.49009c",
        "type": "inject",
        "z": "8e9cc33.fffd44",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 180,
        "wires": [
            [
                "d5530da1.7e079"
            ]
        ]
    },
    {
        "id": "66a38a41.b44bb4",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "param",
        "func": "msg.payload = {\n    'param': {\n        // no params\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 250,
        "y": 140,
        "wires": [
            [
                "942d1050.cb1f3"
            ]
        ]
    },
    {
        "id": "d5530da1.7e079",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "param",
        "func": "msg.payload = {\n    'param': {\n        calendarId: '1pp3nr9at4s2c5f0brhhbsj7hc@group.calendar.google.com',\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 250,
        "y": 180,
        "wires": [
            [
                "d4b56902.8b1428"
            ]
        ]
    },
    {
        "id": "a9e3ae34.7cfc8",
        "type": "comment",
        "z": "8e9cc33.fffd44",
        "name": "動作検証",
        "info": "",
        "x": 100,
        "y": 100,
        "wires": []
    },
    {
        "id": "21b88cba.ee6a24",
        "type": "inject",
        "z": "8e9cc33.fffd44",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 300,
        "wires": [
            [
                "c97abc82.7a399"
            ]
        ]
    },
    {
        "id": "c97abc82.7a399",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "param",
        "func": "var calendarId = 'kaigishitsu.work_3835353636383833343637@resource.calendar.google.com';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'check': {\n            'timeMin': \"2018-11-28T11:42:00+09:00\",\n            'timeMax': \"2018-11-28T11:43:00+09:00\",\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 250,
        "y": 300,
        "wires": [
            [
                "caed8244.949ed"
            ]
        ]
    },
    {
        "id": "caed8244.949ed",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "calendar.Freebusy.query",
        "func": "const calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar check = {\n    auth: auth,\n    resource: msg.payload.param.check\n};\n\nconsole.log('calendar.Freebusy.query:'+check)\nvar response = calendar.freebusy.query(check,\n    function(err, response){\n\n        console.log('err: '+ err);\n        console.log('Response: '+ response);\n//        console.log('Response Calendars: '+ response.calendars.calendarId);\n\n//        for (var property in response){\n//            console.log('Property: '+ property);\n//            console.log('Property Value: '+ response[property]);\n//        }\n\n//        for (var calendarValue in response){\n//            console.log('Calendar Value: '+ response.calendars.calendarValue);\n//        }\n        msg.payload = response;\n        node.send(msg);\n    }\n);\n\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 430,
        "y": 300,
        "wires": [
            [
                "5c3a1cbf.fe0ce4"
            ]
        ]
    },
    {
        "id": "5c3a1cbf.fe0ce4",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 630,
        "y": 300,
        "wires": []
    },
    {
        "id": "b56a5247.c5a53",
        "type": "catch",
        "z": "8e9cc33.fffd44",
        "name": "",
        "scope": null,
        "x": 640,
        "y": 40,
        "wires": [
            [
                "7f348b2d.4a2e14"
            ]
        ]
    },
    {
        "id": "7f348b2d.4a2e14",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 800,
        "y": 60,
        "wires": []
    },
    {
        "id": "79b44d68.5c2e24",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "",
        "func": "const fs = global.get('fs');\nconst readline = global.get('readline');\nconst {google} = global.get('google');\n\nvar eventList = [];\n\n// If modifying these scopes, delete token.json.\nconst SCOPES = ['https://www.googleapis.com/auth/calendar.readonly'];\nconst TOKEN_PATH = 'token.json';\n\n// Load client secrets from a local file.\nfs.readFile('/data/credentials.json', (err, content) => {\n    console.log(']]]readFile start:'+content);\n  if (err) return console.log('Error loading client secret file:', err);\n  // Authorize a client with credentials, then call the Google Calendar API.\n  authorize(JSON.parse(content), listEvents);\n});\n\n/**\n * Create an OAuth2 client with the given credentials, and then execute the\n * given callback function.\n * @param {Object} credentials The authorization client credentials.\n * @param {function} callback The callback to call with the authorized client.\n */\nfunction authorize(credentials, callback) {\n  const {client_secret, client_id, redirect_uris} = credentials.installed;\n  const oAuth2Client = new google.auth.OAuth2(\n      client_id, client_secret, redirect_uris[0]);\n\n    console.log(']]]authorize start:'+credentials);\n  // Check if we have previously stored a token.\n  fs.readFile(TOKEN_PATH, (err, token) => {\n    if (err) return getAccessToken(oAuth2Client, callback);\n    oAuth2Client.setCredentials(JSON.parse(token));\n    callback(oAuth2Client);\n  });\n}\n\n/**\n * Get and store new token after prompting for user authorization, and then\n * execute the given callback with the authorized OAuth2 client.\n * @param {google.auth.OAuth2} oAuth2Client The OAuth2 client to get token for.\n * @param {getEventsCallback} callback The callback for the authorized client.\n */\nfunction getAccessToken(oAuth2Client, callback) {\n  const authUrl = oAuth2Client.generateAuthUrl({\n    access_type: 'offline',\n    scope: SCOPES,\n  });\n  console.log('Authorize this app by visiting this url:', authUrl);\n//  const rl = readline.createInterface({\n//    input: process.stdin,\n//    output: process.stdout,\n//  });\n//  rl.question('Enter the code from that page here: ', (code) => {\n//    rl.close();\n  code='4/hgBo3mDA3IyMA1VGNbHIw0vCzZ0u4vcE42DAN5EnntuTobUbo_L21ek';\n    oAuth2Client.getToken(code, (err, token) => {\n      if (err) return console.error('Error retrieving access token', err);\n      oAuth2Client.setCredentials(token);\n      // Store the token to disk for later program executions\n      fs.writeFile(TOKEN_PATH, JSON.stringify(token), (err) => {\n        if (err) console.error(err);\n        console.log('Token stored to', TOKEN_PATH);\n      });\n      callback(oAuth2Client);\n//    });\n  });\n}\n\n/**\n * Lists the next 10 events on the user's primary calendar.\n * @param {google.auth.OAuth2} auth An authorized OAuth2 client.\n */\nfunction listEvents(auth) {\n  const calendar = google.calendar({version: 'v3', auth});\n  calendar.events.list({\n    calendarId: 'primary',\n//    calendarId: 'roomA',\n    timeMin: (new Date()).toISOString(),\n    maxResults: 10,\n    singleEvents: true,\n    orderBy: 'startTime',\n  }, (err, res) => {\n    if (err) return console.log('The API returned an error: ' + err);\n    const events = res.data.items;\n    if (events.length) {\n      console.log('Upcoming 10 events:');\n      events.map((event, i) => {\n        const start = event.start.dateTime || event.start.date;\n        console.log(`${start} - ${event.summary}`);\n        console.log(event);\n        eventList.push(event);\n      });\n    } else {\n      console.log('No upcoming events found.');\n    }\n    msg.payload = {\"events\":eventList};\n    console.log('node.send();');\n    node.send(msg);\n  });\n}\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 250,
        "y": 420,
        "wires": [
            [
                "3b6f6319.88894c"
            ]
        ]
    },
    {
        "id": "ceba8990.a5de78",
        "type": "inject",
        "z": "8e9cc33.fffd44",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 420,
        "wires": [
            [
                "79b44d68.5c2e24"
            ]
        ]
    },
    {
        "id": "3b6f6319.88894c",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 370,
        "y": 420,
        "wires": []
    },
    {
        "id": "9e817f9.712708",
        "type": "inject",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"id\":\"1pp3nr9at4s2c5f0brhhbsj7hc@group.calendar.google.com\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 680,
        "wires": [
            [
                "5490bccc.db1214"
            ]
        ]
    },
    {
        "id": "5490bccc.db1214",
        "type": "change",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 680,
        "wires": [
            [
                "85a8e3b2.1b237",
                "b56f2cc8.f8c6e"
            ]
        ]
    },
    {
        "id": "85a8e3b2.1b237",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "param",
        "func": "msg.payload = {\n    'param': {\n        calendarId: msg.req.params.id,\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 290,
        "y": 720,
        "wires": [
            [
                "137ff949.599887"
            ]
        ]
    },
    {
        "id": "b56f2cc8.f8c6e",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 450,
        "y": 680,
        "wires": []
    },
    {
        "id": "2260266.c1849da",
        "type": "http in",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "url": "/test/resources/:id",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 720,
        "wires": [
            [
                "85a8e3b2.1b237",
                "b56f2cc8.f8c6e"
            ]
        ]
    },
    {
        "id": "137ff949.599887",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "calendar.calendarList.get",
        "func": "var calList = [];\n  const calendar = global.get('calendar');\n\n  calendar.calendarList.get({\n    //calendarId: '1pp3nr9at4s2c5f0brhhbsj7hc@group.calendar.google.com',\n    calendarId: msg.payload.param.calendarId\n  }, (err, res) => {\n      console.log('calendarlist.get err:'+err);\n      console.log('calendarlist.get res:'+res);\n      const cal = res.data;\n//      if(calendarlist.length){\n//          calendarlist.map((cal, i) => {\n//              console.log('calendarlist:'+cal)\n//              calList.push(cal);\n//          })\n//          msg.payload = {'cals':calList};\n//      }\n        msg.payload['cal'] = cal;\n        node.send(msg);\n  })\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 470,
        "y": 720,
        "wires": [
            [
                "7fadf4de.6860bc"
            ]
        ]
    },
    {
        "id": "7fadf4de.6860bc",
        "type": "change",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.cal",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 720,
        "wires": [
            [
                "326fb6be.48aafa"
            ]
        ]
    },
    {
        "id": "326fb6be.48aafa",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "出力形式に変換する",
        "func": "var dsk = msg.payload.description.split(':');\nvar outObj = {\n    resourceId: msg.payload.id,\n    name: msg.payload.summary,\n    capacity: dsk[1],\n    description: dsk[2]\n}\nmsg.payload = outObj;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 460,
        "y": 760,
        "wires": [
            [
                "c4eb7b12.8d53b8"
            ]
        ]
    },
    {
        "id": "c4eb7b12.8d53b8",
        "type": "change",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload.resource",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 610,
        "y": 800,
        "wires": [
            [
                "c0277c6d.876de",
                "e278f5cd.8768c8"
            ]
        ]
    },
    {
        "id": "c0277c6d.876de",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 850,
        "y": 760,
        "wires": []
    },
    {
        "id": "e278f5cd.8768c8",
        "type": "http response",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 830,
        "y": 800,
        "wires": []
    },
    {
        "id": "e0095184.cd891",
        "type": "comment",
        "z": "f3d7869e.91c5f8",
        "name": "resource（会議室）取得",
        "info": "",
        "x": 150,
        "y": 640,
        "wires": []
    },
    {
        "id": "77f224eb.8f111c",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "calendar.events.list",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        //calendarId: 'primary',\n        calendarId: 'kaigishitsu.work_3835353636383833343637@resource.calendar.google.com',\n        //timeMin: (new Date()).toISOString(),\n        timeMin: '2018-11-28T11:48:00+09:00',\n        timeMax: '2018-11-28T11:49:00+09:00',\n        //maxResults: 10,\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = {\"events\":eventList};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 290,
        "y": 340,
        "wires": [
            [
                "2f651172.0cfade"
            ]
        ]
    },
    {
        "id": "2f651172.0cfade",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 510,
        "y": 340,
        "wires": []
    },
    {
        "id": "c11e6333.51d77",
        "type": "inject",
        "z": "8e9cc33.fffd44",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 340,
        "wires": [
            [
                "77f224eb.8f111c"
            ]
        ]
    },
    {
        "id": "c09cfc5.d98b4",
        "type": "inject",
        "z": "8e9cc33.fffd44",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 500,
        "wires": [
            [
                "efc88c7c.68a62"
            ]
        ]
    },
    {
        "id": "dded1c22.17bf9",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 590,
        "y": 500,
        "wires": []
    },
    {
        "id": "efc88c7c.68a62",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "時刻フォーマット",
        "func": "var timezone = 9;\nvar timezoneOffset = timezone * 1000 * 60 * 60;\nvar date = new Date(msg.payload + timezoneOffset);\nvar p = {\n    year: date.getFullYear().toString(),\n    month: ('0'+(date.getMonth()+1)).slice(-2),\n    day: ('0'+date.getDate()).slice(-2),\n    hours: ('0'+date.getHours()).slice(-2),\n    minutes: ('0'+date.getMinutes()).slice(-2),\n    secounds: ('0'+date.getSeconds()).slice(-2),\n    timezone:'+'+('0'+timezone).slice(-2)+':00',\n}\nmsg.payload={p:p};\nconsole.log('now:'+date);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 270,
        "y": 500,
        "wires": [
            [
                "5d8364df.f057ec"
            ]
        ]
    },
    {
        "id": "5d8364df.f057ec",
        "type": "template",
        "z": "8e9cc33.fffd44",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{{payload.p.year}}-{{payload.p.month}}-{{payload.p.day}}T{{payload.p.hours}}:{{payload.p.minutes}}:00{{payload.p.timezone}}",
        "output": "str",
        "x": 440,
        "y": 500,
        "wires": [
            [
                "dded1c22.17bf9"
            ]
        ]
    },
    {
        "id": "79012397.1c22dc",
        "type": "inject",
        "z": "8e9cc33.fffd44",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 600,
        "wires": [
            [
                "96828b64.6b3a58"
            ]
        ]
    },
    {
        "id": "96828b64.6b3a58",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "時刻フォーマット（cFunc）",
        "func": "var cFunc = global.get('cFunc');\nvar out = cFunc.getTimeString(msg.payload);\nmsg.payload={out:out};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 310,
        "y": 600,
        "wires": [
            [
                "331d87ba.0993c8"
            ]
        ]
    },
    {
        "id": "331d87ba.0993c8",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 530,
        "y": 600,
        "wires": []
    },
    {
        "id": "75202fa2.09c34",
        "type": "inject",
        "z": "8e9cc33.fffd44",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 680,
        "wires": [
            [
                "c051610d.1982c"
            ]
        ]
    },
    {
        "id": "c051610d.1982c",
        "type": "change",
        "z": "8e9cc33.fffd44",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "now",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 250,
        "y": 680,
        "wires": [
            [
                "e684d6e5.0fc068"
            ]
        ]
    },
    {
        "id": "c4116ae2.fcec18",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 790,
        "y": 700,
        "wires": []
    },
    {
        "id": "dea68fb5.ee66",
        "type": "subflow:624e24c1.a2567c",
        "z": "8e9cc33.fffd44",
        "name": "",
        "x": 270,
        "y": 720,
        "wires": [
            [
                "d0dc4f95.0673"
            ]
        ]
    },
    {
        "id": "d0dc4f95.0673",
        "type": "change",
        "z": "8e9cc33.fffd44",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.resources",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 720,
        "wires": [
            [
                "c4116ae2.fcec18",
                "9861a52c.9e6258"
            ]
        ]
    },
    {
        "id": "9861a52c.9e6258",
        "type": "split",
        "z": "8e9cc33.fffd44",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 240,
        "y": 780,
        "wires": [
            [
                "ac5e0fca.1b24"
            ]
        ]
    },
    {
        "id": "ac5e0fca.1b24",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "param",
        "func": "var cFunc = global.get('cFunc');\n\nmsg.payload = {\n    'resource': msg.payload,\n    'param': {\n        calendarId: msg.payload.resourceId,\n        timeMin: msg.times.timeMin,\n        timeMax: msg.times.timeMax,\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 370,
        "y": 780,
        "wires": [
            [
                "139a66b.0af3c99"
            ]
        ]
    },
    {
        "id": "139a66b.0af3c99",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "calendar.events.list",
        "func": "var cFunc=global.get('cFunc');\nvar eventList = [];\nvar calendarId = msg.payload.param.calendarId;\nvar timeMin = msg.payload.param.timeMin;\nvar timeMax = msg.payload.param.timeMax;\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        calendarId: calendarId,\n        timeMin: timeMin,\n        timeMax: timeMax,\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = msg.payload.resource;\n        msg.payload.event = {};\n        if(eventList[0]){\n            var dsk = eventList[0].description.split(':');\n            msg.payload.event = {\n                detail: eventList[0],\n                eventId: eventList[0].id,\n                subject: eventList[0].summary,\n                user:dsk[1],\n                start: eventList[0].start.dateTime.substr(11,5),\n                end: eventList[0].end.dateTime.substr(11,5),\n            };\n            if(dsk[0]==='0'){\n                msg.payload.status=1; //予約済み未CheckIn\n                msg.payload.statusLabel='予約済み';\n            } else {\n                msg.payload.status=2; //使用中\n                msg.payload.statusLabel='使用中';\n            }\n        } else {\n            msg.payload.status=0; //空き\n            msg.payload.statusLabel='空き';\n        }\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 530,
        "y": 780,
        "wires": [
            [
                "95c61871.ae08a8"
            ]
        ]
    },
    {
        "id": "95c61871.ae08a8",
        "type": "join",
        "z": "8e9cc33.fffd44",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 690,
        "y": 780,
        "wires": [
            [
                "d458eb4e.5fdf98"
            ]
        ]
    },
    {
        "id": "e684d6e5.0fc068",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "set msg.times",
        "func": "var cFunc=global.get('cFunc');\nmsg.times = {\n    timeMin: cFunc.getTimeString(msg.now),\n    timeMax: cFunc.getTimeString(msg.now + 60000),\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 420,
        "y": 680,
        "wires": [
            [
                "dea68fb5.ee66"
            ]
        ]
    },
    {
        "id": "d458eb4e.5fdf98",
        "type": "change",
        "z": "8e9cc33.fffd44",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload.resources",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 840,
        "wires": [
            [
                "b52f3b10.3110b8"
            ]
        ]
    },
    {
        "id": "b52f3b10.3110b8",
        "type": "change",
        "z": "8e9cc33.fffd44",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.at",
                "pt": "msg",
                "to": "times.timeMin",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 840,
        "wires": [
            [
                "89b4b1d1.fced5"
            ]
        ]
    },
    {
        "id": "89b4b1d1.fced5",
        "type": "change",
        "z": "8e9cc33.fffd44",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "gInfo.currentStatus",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 880,
        "wires": [
            [
                "f0eb0489.59b3d8"
            ]
        ]
    },
    {
        "id": "3dfaa003.846ec",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 710,
        "y": 880,
        "wires": []
    },
    {
        "id": "f0eb0489.59b3d8",
        "type": "change",
        "z": "8e9cc33.fffd44",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "gInfo",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 880,
        "wires": [
            [
                "3dfaa003.846ec"
            ]
        ]
    },
    {
        "id": "90e196bc.4fc768",
        "type": "inject",
        "z": "3d69815d.415ade",
        "name": "起動時",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "x": 100,
        "y": 80,
        "wires": [
            [
                "5e67e36b.43d3ec"
            ]
        ]
    },
    {
        "id": "814d0fc3.0e0e9",
        "type": "function",
        "z": "25a48dc1.1a6252",
        "name": "認証とカレンダーオブジェクト取得toGlobal",
        "func": "const fs = global.get('fs');\nconst readline = global.get('readline');\nconst {google} = global.get('google');\n\n// var eventList = [];\n\nvar authStats = global.get('authStats') || \n{\n    stat: \"NoClientSecrets\",\n};\nglobal.set('authStats', authStats);\n\n// If modifying these scopes, delete token.json.\nconst SCOPES = ['https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/spreadsheets'];\nconst TOKEN_PATH = '/data/token.json';\n\n// Load client secrets from a local file.\nfs.readFile('/data/credentials.json', (err, content) => {\n    console.log(']]]readFile start:'+content);\n  if (err) {\n      authStats.stat = \"NoClientSecrets\";\n      global.set('authStats', authStats);\n      msg.error = 'Error loading client secret file:'+ err;\n      node.send(msg);\n      return console.log('Error loading client secret file:', err);\n  }\n  // Authorize a client with credentials, then call the Google Calendar API.\n  authorize(JSON.parse(content), saveCalendarToGlobal);\n});\n\n/**\n * Create an OAuth2 client with the given credentials, and then execute the\n * given callback function.\n * @param {Object} credentials The authorization client credentials.\n * @param {function} callback The callback to call with the authorized client.\n */\nfunction authorize(credentials, callback) {\n  const {client_secret, client_id, redirect_uris} = credentials.installed;\n  const oAuth2Client = new google.auth.OAuth2(\n      client_id, client_secret, redirect_uris[0]);\n\n    console.log(']]]authorize start:'+credentials);\n  // Check if we have previously stored a token.\n  fs.readFile(TOKEN_PATH, (err, token) => {\n    if (err) return getAccessToken(oAuth2Client, callback);\n    oAuth2Client.setCredentials(JSON.parse(token));\n    callback(oAuth2Client);\n  });\n}\n\n/**\n * Get and store new token after prompting for user authorization, and then\n * execute the given callback with the authorized OAuth2 client.\n * @param {google.auth.OAuth2} oAuth2Client The OAuth2 client to get token for.\n * @param {getEventsCallback} callback The callback for the authorized client.\n */\nfunction getAccessToken(oAuth2Client, callback) {\n  const authUrl = oAuth2Client.generateAuthUrl({\n    access_type: 'offline',\n    scope: SCOPES,\n  });\n  if(!authStats.code) {\n      authStats.stat = \"NeedToAuthorize\";\n      authStats.url = authUrl;\n      global.set('authStats', authStats);\n      msg.error = 'no token';\n      node.send(msg);\n      return console.log('Authorize this app by visiting this url:', authUrl);\n  } else {\n      code = authStats.code;\n//  code='4/qwA2we0WATDIKq5MEsQDW1vnpzzx2wM26lIl7Mm7zgC0lIJwtxVy2AE';\n    oAuth2Client.getToken(code, (err, token) => {\n      if (err) {\n          authStats.stat = \"NeedToAuthorize\";\n          authStats.url = authUrl;\n          global.set('authStats', authStats);\n          msg.error = 'bad token';\n          node.send(msg);\n          return console.error('Error retrieving access token', err);\n      }\n      oAuth2Client.setCredentials(token);\n      // Store the token to disk for later program executions\n      fs.writeFile(TOKEN_PATH, JSON.stringify(token), (err) => {\n        if (err) console.error(err);\n        console.log('Token stored to', TOKEN_PATH);\n      });\n      callback(oAuth2Client);\n  });\n  }\n}\n\n/**\n * Lists the next 10 events on the user's primary calendar.\n * @param {google.auth.OAuth2} auth An authorized OAuth2 client.\n */\nfunction saveCalendarToGlobal(auth) {\n  const calendar = google.calendar({version: 'v3', auth});\n  const sheets = google.sheets({version: 'v4', auth});\n  console.log('saveCalendarToGlobal called:'+auth);\n  global.set('auth', auth);\n  global.set('calendar', calendar);\n  global.set('sheets', sheets);\n  authStats.stat = \"OK\";\n  global.set('authStats', authStats);\n  node.send(msg);\n}\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 370,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "6e4f6b00.59a774",
        "type": "debug",
        "z": "3d69815d.415ade",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 610,
        "y": 80,
        "wires": []
    },
    {
        "id": "b9ac00ad.a2781",
        "type": "function",
        "z": "3d69815d.415ade",
        "name": "グローバルストレージ作成",
        "func": "var gInfo = {\n    resources: [], //リソース一覧\n    currentStatus: {}, //現在状況\n    constants:{ //定数一覧\n        autoCancelMin: 10, //自動キャンセル時間（分）\n    },\n}\nglobal.set('gInfo', gInfo)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 320,
        "y": 120,
        "wires": [
            [
                "ab11e15a.320ee"
            ]
        ]
    },
    {
        "id": "8928bbf.da81d48",
        "type": "subflow:624e24c1.a2567c",
        "z": "3d69815d.415ade",
        "name": "",
        "x": 290,
        "y": 240,
        "wires": [
            [
                "f6df97d.96e7e68"
            ]
        ]
    },
    {
        "id": "f6df97d.96e7e68",
        "type": "function",
        "z": "3d69815d.415ade",
        "name": "リソース一覧を保持する。",
        "func": "var gInfo = global.get('gInfo');\ngInfo.resources = msg.payload.resources;\nglobal.set('gInfo', gInfo);\nmsg.gInfo = gInfo;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 520,
        "y": 240,
        "wires": [
            [
                "b68918f.bdc73e8",
                "d0b9c0e9.ba5bf"
            ]
        ]
    },
    {
        "id": "ab11e15a.320ee",
        "type": "function",
        "z": "3d69815d.415ade",
        "name": "cFunc設定",
        "func": "var timezone = 9,\n    timezoneOffset = timezone * 1000 * 60 * 60;\n\nvar cFunc = {\n    timezone: timezone,\n    timezoneOffset: timezoneOffset,\n    getTimeString: function(time){\n        var date = new Date(time + timezoneOffset);\n        var p = this.getDateObject(date);\n        var ret = p.year+'-'+p.month+'-'+p.day+'T'+p.hours+':'+p.minutes+':00'+p.timezone;\n        return ret;\n    },\n    getDateObject: function(date){\n        var p = {\n            year: date.getFullYear().toString(),\n            month: ('0'+(date.getMonth()+1)).slice(-2),\n            day: ('0'+date.getDate()).slice(-2),\n            hours: ('0'+date.getHours()).slice(-2),\n            minutes: ('0'+date.getMinutes()).slice(-2),\n            seconds: ('0'+date.getSeconds()).slice(-2),\n            milliseconds: ('00'+date.getMilliseconds()).slice(-3),\n            timezone:'+'+('0'+timezone).slice(-2)+':00',\n        };\n        return p;\n    },\n    getTimeFromTimeString: function(ts){\n        return new Date(ts).getTime();\n    },\n    getSavedTime(oldTime, newTime){\n        var delta = oldTime - newTime;\n        return Math.ceil(delta / 60000);\n    },\n    getJstCommonString(time){\n        var p = this.getDateObject(new Date(time + timezoneOffset));\n        return p.year+'/'+p.month+'/'+p.day+' '+p.hours+':'+p.minutes+':'+p.seconds+'.'+p.milliseconds;\n    }\n};\nglobal.set('cFunc', cFunc);\nmsg.cFunc = cFunc;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 270,
        "y": 160,
        "wires": [
            [
                "9ef7f44c.eff128"
            ]
        ]
    },
    {
        "id": "d0b9c0e9.ba5bf",
        "type": "debug",
        "z": "3d69815d.415ade",
        "name": "初期化バッチ",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 760,
        "y": 240,
        "wires": []
    },
    {
        "id": "c336af0.2aba05",
        "type": "comment",
        "z": "3d69815d.415ade",
        "name": "node-red起動時の処理",
        "info": "",
        "x": 120,
        "y": 40,
        "wires": []
    },
    {
        "id": "7bd8854f.28a98c",
        "type": "inject",
        "z": "3d69815d.415ade",
        "name": "１分おき",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "*/1 0-23 * * *",
        "once": false,
        "onceDelay": "0.5",
        "x": 110,
        "y": 340,
        "wires": [
            [
                "47267595.d661cc"
            ]
        ]
    },
    {
        "id": "8f1061f2.685b1",
        "type": "comment",
        "z": "3d69815d.415ade",
        "name": "定期処理",
        "info": "",
        "x": 80,
        "y": 300,
        "wires": []
    },
    {
        "id": "d62d5845.f56018",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "calendar.Freebusy.query",
        "func": "const calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar check = {\n    auth: auth,\n    resource: msg.payload.param.check\n};\n\nconsole.log('calendar.Freebusy.query:'+check)\nvar response = calendar.freebusy.query(check,\n    function(err, response){\n\n        console.log('err: '+ err);\n        console.log('Response: '+ response);\n//        console.log('Response Calendars: '+ response.calendars.calendarId);\n\n//        for (var property in response){\n//            console.log('Property: '+ property);\n//            console.log('Property Value: '+ response[property]);\n//        }\n\n//        for (var calendarValue in response){\n//            console.log('Calendar Value: '+ response.calendars.calendarValue);\n//        }\n        msg.payload = response;\n        node.send(msg);\n    }\n);\n\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 1020,
        "wires": [
            [
                "78ae6f32.646c9"
            ]
        ]
    },
    {
        "id": "366dcadf.6b51b6",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "param",
        "func": "var calendarId = 'kaigishitsu.work_3835353636383833343637@resource.calendar.google.com';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'check': {\n            'timeMin': \"2018-11-28T16:30:00+09:00\",\n            'timeMax': \"2018-11-28T17:00:00+09:00\",\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 1020,
        "wires": [
            [
                "d62d5845.f56018"
            ]
        ]
    },
    {
        "id": "78ae6f32.646c9",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 610,
        "y": 1020,
        "wires": []
    },
    {
        "id": "c43b7916.2dbb88",
        "type": "inject",
        "z": "8e9cc33.fffd44",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 1020,
        "wires": [
            [
                "366dcadf.6b51b6"
            ]
        ]
    },
    {
        "id": "6248206f.ee5a6",
        "type": "inject",
        "z": "3d69815d.415ade",
        "name": "毎朝",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "00 23 * * *",
        "once": false,
        "onceDelay": 0.1,
        "x": 90,
        "y": 120,
        "wires": [
            [
                "5e67e36b.43d3ec"
            ]
        ]
    },
    {
        "id": "b68918f.bdc73e8",
        "type": "change",
        "z": "3d69815d.415ade",
        "name": "timestamp",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 300,
        "wires": [
            [
                "47267595.d661cc"
            ]
        ]
    },
    {
        "id": "febecd2f.3dd1e",
        "type": "http in",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "url": "/rc/resources/:id/events",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 1400,
        "wires": [
            [
                "6d62bd31.fbd3c4",
                "3da12983.814c86"
            ]
        ]
    },
    {
        "id": "6d62bd31.fbd3c4",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 690,
        "y": 1360,
        "wires": []
    },
    {
        "id": "5b730792.0309e8",
        "type": "change",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 1360,
        "wires": [
            [
                "eccaa8ed.d87478"
            ]
        ]
    },
    {
        "id": "c8448bfc.e20ff8",
        "type": "inject",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"id\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\"},\"query\":{},\"body\":{\"date\":\"2018-11-29\",\"start\":\"18:00\",\"end\":\"19:00\",\"user\":\"社員abc\",\"subject\":\"テスト会議X\",\"pin\":\"1234\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 1360,
        "wires": [
            [
                "5b730792.0309e8"
            ]
        ]
    },
    {
        "id": "526cf183.63fb9",
        "type": "http response",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 750,
        "y": 1500,
        "wires": []
    },
    {
        "id": "eccaa8ed.d87478",
        "type": "change",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "req.body",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 480,
        "y": 1360,
        "wires": [
            [
                "6d62bd31.fbd3c4",
                "3da12983.814c86"
            ]
        ]
    },
    {
        "id": "3170f920.7c8d36",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "calendar.Freebusy.query",
        "func": "const calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar check = {\n    auth: auth,\n    resource: msg.payload.param.check\n};\n\nconsole.log('calendar.Freebusy.query:'+check);\nvar response = calendar.freebusy.query(check,\n    function(err, response){\n        var obj={status:-1, statusLabel:'不明'};\n        console.dir(err);\n        if(response){\n            console.dir(response.data);\n        }\n        \n        if(response && \n            response.data &&\n            response.data.calendars &&\n            response.data.calendars[msg.req.params.id] &&\n            response.data.calendars[msg.req.params.id].busy){\n            if(response.data.calendars[msg.req.params.id].busy.length === 0){\n                //vacancy\n                obj.status=0;\n                obj.statusLabel='OK';\n            } else {\n                obj.status=1;\n                obj.statusLabel='NG';\n            }\n        }\n        msg.payload={param:msg.payload.param, result:obj};\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 490,
        "y": 1460,
        "wires": [
            [
                "c2e1b519.54b8d8",
                "b161d19f.4423c"
            ]
        ]
    },
    {
        "id": "fd63c841.b68af8",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "param",
        "func": "var calendarId = msg.req.params.id;\nvar timeMin = msg.payload.req.body.date+'T'+msg.payload.req.body.start+':00+09:00';\nvar timeMax = msg.payload.req.body.date+'T'+msg.payload.req.body.end+':00+09:00';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'check': {\n            'timeMin': timeMin,\n            'timeMax': timeMax,\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 110,
        "y": 1460,
        "wires": [
            []
        ]
    },
    {
        "id": "dceffc22.1c669",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 850,
        "y": 1060,
        "wires": []
    },
    {
        "id": "9285a366.808a4",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 750,
        "y": 1460,
        "wires": []
    },
    {
        "id": "c2e1b519.54b8d8",
        "type": "switch",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "property": "payload.result.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 230,
        "y": 1520,
        "wires": [
            [
                "d7541d0e.88f2c"
            ],
            [
                "a94f317a.4bd7d"
            ]
        ]
    },
    {
        "id": "d7541d0e.88f2c",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "func": "var result={\n    status: \"busy\"\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 490,
        "y": 1520,
        "wires": [
            [
                "526cf183.63fb9",
                "9285a366.808a4"
            ]
        ]
    },
    {
        "id": "a94f317a.4bd7d",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "calendar.events.insert",
        "func": "var calList = [];\nconst calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar timezone = 'Asia/Tokyo';\nvar master ='master@kaigishitsu.work';\n\nvar returned = false;\n\nvar event = {\n    'summary': msg.req.body.subject,\n    //'location': '',\n    'description': '0:'+msg.req.body.user+':'+msg.req.body.pin,\n    'start': {\n        'dateTime': msg.payload.param.check.timeMin,\n        'timeZone': timezone,\n    },\n    'end': {\n        'dateTime': msg.payload.param.check.timeMax,\n        'timeZone': 'Asia/Tokyo',\n    },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n    'organizer': {'email': master},\n    'attendees': [\n        //{'email': master},\n        {'email': msg.payload.param.calendarId, 'resource': true}\n        ],\n    'reminders': {},\n};\nvar apiOptions = {\n    auth: auth,\n    calendarId: master,\n    resource: event\n};\nconsole.log('apiOptions:'+apiOptions);\ncalendar.events.insert(\n    apiOptions,\n    (err, event) => {\n        if (err) {\n            console.log('There was an error contacting the Calendar service: ' + err);\n        } else {\n            console.log('Event created: %s', event.data.htmlLink);\n        }\n        msg.payload.id=event.data.id;\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 380,
        "y": 1600,
        "wires": [
            [
                "4d9ff0ac.1498f"
            ]
        ]
    },
    {
        "id": "b161d19f.4423c",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 750,
        "y": 1420,
        "wires": []
    },
    {
        "id": "4d9ff0ac.1498f",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "func": "var result={\n    status: \"ok\",\n    id: msg.payload.id\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 580,
        "y": 1620,
        "wires": [
            [
                "526cf183.63fb9",
                "9285a366.808a4",
                "1a61a0d5.a4222f"
            ]
        ]
    },
    {
        "id": "3da12983.814c86",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "param",
        "func": "var calendarId = msg.req.params.id;\nvar timeMin = msg.payload.date+'T'+msg.payload.start+':00+09:00';\nvar timeMax = msg.payload.date+'T'+msg.payload.end+':00+09:00';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'check': {\n            'timeMin': timeMin,\n            'timeMax': timeMax,\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 310,
        "y": 1460,
        "wires": [
            [
                "3170f920.7c8d36"
            ]
        ]
    },
    {
        "id": "1a61a0d5.a4222f",
        "type": "change",
        "z": "f3d7869e.91c5f8",
        "name": "timestamp",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 1680,
        "wires": [
            [
                "9eebb3c0.7480d"
            ]
        ]
    },
    {
        "id": "f347f5a9.1b9638",
        "type": "function",
        "z": "7c664e6f.eb225",
        "name": "calendar.events.insert",
        "func": "var calList = [];\nconst calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar timezone = 'Asia/Tokyo';\nvar master ='primary';\n\nvar returned = false;\n\nvar event = {\n    'summary': msg.payload.event.subject,\n    //'location': '',\n    'description': msg.payload.event.status+':'+msg.payload.event.user+':'+msg.payload.event.pin+':'+msg.payload.event.saved+\":\"+msg.payload.event.checkedin,\n    'start': {\n        'dateTime': msg.payload.param.check.timeMin,\n        'timeZone': timezone,\n    },\n    'end': {\n        'dateTime': msg.payload.param.check.timeMax,\n        'timeZone': 'Asia/Tokyo',\n    },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n    'organizer': {'email': master},\n    'attendees': [\n        //{'email': master},\n        {'email': msg.payload.param.calendarId, 'resource': true}\n        ],\n    'reminders': {},\n};\nvar apiOptions = {\n    auth: auth,\n    calendarId: master,\n    resource: event\n};\nconsole.log('apiOptions:'+apiOptions);\ncalendar.events.insert(\n    apiOptions,\n    (err, event) => {\n        if (err) {\n            console.log('There was an error contacting the Calendar service: ' + err);\n        } else {\n            console.log('Event created: %s', event.data.htmlLink);\n            msg.payload.id=event.data.id;\n            msg.payload.attendees = event.data.attendees;\n        }\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 240,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "6ef7c510.34d1ec",
        "type": "change",
        "z": "3bd1c83b.24e548",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "now",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 300,
        "wires": [
            [
                "b823944b.6fb0b8"
            ]
        ]
    },
    {
        "id": "b823944b.6fb0b8",
        "type": "function",
        "z": "3bd1c83b.24e548",
        "name": "set msg.times",
        "func": "var cFunc=global.get('cFunc');\nmsg.times = {\n    timeMin: cFunc.getTimeString(msg.now),\n    timeMax: cFunc.getTimeString(msg.now + 60000),\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 460,
        "y": 300,
        "wires": [
            [
                "f9fcc65e.57fbe8"
            ]
        ]
    },
    {
        "id": "f9fcc65e.57fbe8",
        "type": "change",
        "z": "3bd1c83b.24e548",
        "name": "リソース一覧取得",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "gInfo.resources",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 300,
        "wires": [
            [
                "6d7ec2f9.a9839c",
                "e8098d53.c5f59"
            ]
        ]
    },
    {
        "id": "e8098d53.c5f59",
        "type": "debug",
        "z": "3bd1c83b.24e548",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 830,
        "y": 300,
        "wires": []
    },
    {
        "id": "6d7ec2f9.a9839c",
        "type": "split",
        "z": "3bd1c83b.24e548",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 290,
        "y": 360,
        "wires": [
            [
                "3204296f.b44496"
            ]
        ]
    },
    {
        "id": "3204296f.b44496",
        "type": "function",
        "z": "3bd1c83b.24e548",
        "name": "param",
        "func": "var cFunc = global.get('cFunc');\n\nmsg.payload = {\n    'resource': msg.payload,\n    'param': {\n        calendarId: msg.payload.resourceId,\n        timeMin: msg.times.timeMin,\n        timeMax: msg.times.timeMax,\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 420,
        "y": 360,
        "wires": [
            [
                "b0b16ddf.e6a28"
            ]
        ]
    },
    {
        "id": "b0b16ddf.e6a28",
        "type": "function",
        "z": "3bd1c83b.24e548",
        "name": "calendar.events.list",
        "func": "var cFunc=global.get('cFunc');\nvar eventList = [];\nvar calendarId = msg.payload.param.calendarId;\nvar timeMin = msg.payload.param.timeMin;\nvar timeMax = msg.payload.param.timeMax;\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        calendarId: calendarId,\n        timeMin: timeMin,\n        timeMax: timeMax,\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = msg.payload.resource;\n        msg.payload.event = {};\n        if(eventList[0]){\n            var dsk = eventList[0].description.split(':');\n            msg.payload.event = {\n                detail: eventList[0],\n                eventId: eventList[0].id,\n                subject: eventList[0].summary,\n                user:dsk[1],\n                pin:dsk[2],\n                start: eventList[0].start.dateTime.substr(11,5),\n                end: eventList[0].end.dateTime.substr(11,5),\n            };\n            if(dsk[0]==='0'){\n                msg.payload.status=1; //予約済み未CheckIn\n                msg.payload.statusLabel='予約済み';\n            } else {\n                msg.payload.status=2; //使用中\n                msg.payload.statusLabel='使用中';\n            }\n        } else {\n            msg.payload.status=0; //空き\n            msg.payload.statusLabel='空き';\n        }\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 580,
        "y": 360,
        "wires": [
            [
                "89d79417.3b4c08"
            ]
        ]
    },
    {
        "id": "89d79417.3b4c08",
        "type": "join",
        "z": "3bd1c83b.24e548",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 740,
        "y": 360,
        "wires": [
            [
                "cac8f9e7.917078"
            ]
        ]
    },
    {
        "id": "cac8f9e7.917078",
        "type": "change",
        "z": "3bd1c83b.24e548",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload.resources",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 420,
        "wires": [
            [
                "dd858d3d.57fd5"
            ]
        ]
    },
    {
        "id": "dd858d3d.57fd5",
        "type": "change",
        "z": "3bd1c83b.24e548",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.at",
                "pt": "msg",
                "to": "times.timeMin",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 510,
        "y": 420,
        "wires": [
            [
                "f0f2c1cf.8e8a4"
            ]
        ]
    },
    {
        "id": "f0f2c1cf.8e8a4",
        "type": "change",
        "z": "3bd1c83b.24e548",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "gInfo.currentStatus",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 460,
        "wires": [
            [
                "4abbe0d0.4eb99"
            ]
        ]
    },
    {
        "id": "4abbe0d0.4eb99",
        "type": "change",
        "z": "3bd1c83b.24e548",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "gInfo",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 580,
        "y": 460,
        "wires": [
            [
                "6c53c9ac.c91768"
            ]
        ]
    },
    {
        "id": "6c53c9ac.c91768",
        "type": "debug",
        "z": "3bd1c83b.24e548",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 750,
        "y": 460,
        "wires": []
    },
    {
        "id": "be840f31.19e66",
        "type": "inject",
        "z": "b36ee370.d8e85",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 160,
        "wires": [
            [
                "8db518bf.37b9a8",
                "31dc6206.a8fbfe"
            ]
        ]
    },
    {
        "id": "8db518bf.37b9a8",
        "type": "debug",
        "z": "b36ee370.d8e85",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 290,
        "y": 160,
        "wires": []
    },
    {
        "id": "31dc6206.a8fbfe",
        "type": "change",
        "z": "b36ee370.d8e85",
        "name": "empty payload",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 200,
        "wires": [
            [
                "d14e51d2.ae2ab"
            ]
        ]
    },
    {
        "id": "9ad936c.7fc23c8",
        "type": "http in",
        "z": "b36ee370.d8e85",
        "name": "",
        "url": "/resources",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 200,
        "wires": [
            [
                "8db518bf.37b9a8",
                "31dc6206.a8fbfe"
            ]
        ]
    },
    {
        "id": "d14e51d2.ae2ab",
        "type": "change",
        "z": "b36ee370.d8e85",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.resources",
                "pt": "msg",
                "to": "gInfo.resources",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 200,
        "wires": [
            [
                "82c3d0b4.be38c",
                "74c3b04f.276de"
            ]
        ]
    },
    {
        "id": "82c3d0b4.be38c",
        "type": "debug",
        "z": "b36ee370.d8e85",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 830,
        "y": 240,
        "wires": []
    },
    {
        "id": "74c3b04f.276de",
        "type": "http response",
        "z": "b36ee370.d8e85",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 810,
        "y": 200,
        "wires": []
    },
    {
        "id": "be59f290.f578f",
        "type": "comment",
        "z": "b36ee370.d8e85",
        "name": "resource（会議室）一覧取得",
        "info": "",
        "x": 160,
        "y": 120,
        "wires": []
    },
    {
        "id": "7446877e.44faf8",
        "type": "catch",
        "z": "b36ee370.d8e85",
        "name": "",
        "scope": null,
        "x": 700,
        "y": 40,
        "wires": [
            [
                "eb443642.cb0938"
            ]
        ]
    },
    {
        "id": "eb443642.cb0938",
        "type": "debug",
        "z": "b36ee370.d8e85",
        "name": "Exception!!",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 850,
        "y": 40,
        "wires": []
    },
    {
        "id": "134a5f19.7df8d1",
        "type": "inject",
        "z": "b36ee370.d8e85",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 320,
        "wires": [
            [
                "a148fe5.2b20e",
                "76a8a2e0.76546c"
            ]
        ]
    },
    {
        "id": "a148fe5.2b20e",
        "type": "debug",
        "z": "b36ee370.d8e85",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 290,
        "y": 320,
        "wires": []
    },
    {
        "id": "76a8a2e0.76546c",
        "type": "change",
        "z": "b36ee370.d8e85",
        "name": "empty payload",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 400,
        "y": 360,
        "wires": [
            [
                "f71540f4.831dd"
            ]
        ]
    },
    {
        "id": "fb80bd0e.7ddc2",
        "type": "http in",
        "z": "b36ee370.d8e85",
        "name": "",
        "url": "/currentstatus",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 360,
        "wires": [
            [
                "a148fe5.2b20e",
                "76a8a2e0.76546c"
            ]
        ]
    },
    {
        "id": "f71540f4.831dd",
        "type": "change",
        "z": "b36ee370.d8e85",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "gInfo.currentStatus",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 580,
        "y": 360,
        "wires": [
            [
                "9ea08724.cc58c8",
                "b6454dc0.2b37d"
            ]
        ]
    },
    {
        "id": "9ea08724.cc58c8",
        "type": "debug",
        "z": "b36ee370.d8e85",
        "name": "現在状況取得",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 840,
        "y": 400,
        "wires": []
    },
    {
        "id": "b6454dc0.2b37d",
        "type": "http response",
        "z": "b36ee370.d8e85",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 810,
        "y": 360,
        "wires": []
    },
    {
        "id": "122f0476.83865c",
        "type": "comment",
        "z": "b36ee370.d8e85",
        "name": "現在状況取得",
        "info": "",
        "x": 110,
        "y": 280,
        "wires": []
    },
    {
        "id": "7174a1aa.cc",
        "type": "function",
        "z": "b36ee370.d8e85",
        "name": "calendar.events.list",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        calendarId: msg.payload.param.calendarId,\n        timeMin: msg.payload.param.timeMin,\n        timeMax: msg.payload.param.timeMax,\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = {\"events\":eventList};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 330,
        "y": 560,
        "wires": [
            [
                "1d76532b.74a4cd"
            ]
        ]
    },
    {
        "id": "f94bbb34.2712f8",
        "type": "function",
        "z": "b36ee370.d8e85",
        "name": "param",
        "func": "var cFunc=global.get('cFunc');\nvar targetDate;\nif(msg.req.query.date){\n    targetDate = new Date(msg.req.query.date);\n}else{\n    targetDate = new Date();\n    targetDate.setHours(0);\n    targetDate.setMinutes(0);\n    targetDate.setSeconds(0);\n    targetDate.setMilliseconds(0);\n}\n\nvar dateStr=cFunc.getTimeString(targetDate);\nvar startHour=dateStr.substr(0,11)+'00:00:00'+dateStr.substr(19,25);\nvar endHour=dateStr.substr(0,11)+'23:59:59'+dateStr.substr(19,25);\nmsg.payload={\n    //param:{\n    //    resourceId: msg.req.params.id,\n    //    date: date,\n    //},\n    param: {\n        calendarId: msg.req.params.id,\n        timeMin: startHour,\n        timeMax: endHour,\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 470,
        "y": 520,
        "wires": [
            [
                "7174a1aa.cc"
            ]
        ]
    },
    {
        "id": "1d76532b.74a4cd",
        "type": "change",
        "z": "b36ee370.d8e85",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.events",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 560,
        "wires": [
            [
                "68d16247.337e3c"
            ]
        ]
    },
    {
        "id": "56e93366.52698c",
        "type": "http in",
        "z": "b36ee370.d8e85",
        "name": "",
        "url": "/resources/:id/events/",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 520,
        "wires": [
            [
                "f4926595.5fc4f8",
                "f94bbb34.2712f8"
            ]
        ]
    },
    {
        "id": "68d16247.337e3c",
        "type": "switch",
        "z": "b36ee370.d8e85",
        "name": "",
        "property": "payload.length",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 170,
        "y": 620,
        "wires": [
            [
                "fa583acc.3c8dc8"
            ],
            [
                "a1f4c75e.db49e8"
            ]
        ]
    },
    {
        "id": "f4926595.5fc4f8",
        "type": "debug",
        "z": "b36ee370.d8e85",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 470,
        "y": 480,
        "wires": []
    },
    {
        "id": "fa583acc.3c8dc8",
        "type": "split",
        "z": "b36ee370.d8e85",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": "1",
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 290,
        "y": 600,
        "wires": [
            [
                "bc523fd0.418d"
            ]
        ]
    },
    {
        "id": "a1f4c75e.db49e8",
        "type": "change",
        "z": "b36ee370.d8e85",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload.events",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 790,
        "y": 620,
        "wires": [
            [
                "6d43ed8a.417544",
                "2577f6bc.c082fa"
            ]
        ]
    },
    {
        "id": "bc523fd0.418d",
        "type": "function",
        "z": "b36ee370.d8e85",
        "name": "出力形式に変換する",
        "func": "var dsk = msg.payload.description.split(':');\nvar status = \"\";\nswitch (dsk[0]){\ncase \"0\":\n    break;\ncase \"1\":\n    break;\ncase \"2\":\n    status = \"チェックアウト済\";\n    break;\ncase \"9\":\n    status = \"自動キャンセル\";\n    break;\n}\nvar outObj = {\n    detail: msg.payload,\n    eventId: msg.payload.id,\n    subject: msg.payload.summary,\n    user:dsk[1],\n    status: status,\n    start: msg.payload.start.dateTime.substr(11,5),\n    end: msg.payload.end.dateTime.substr(11,5),\n}\nmsg.payload = outObj;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 460,
        "y": 600,
        "wires": [
            [
                "15c6da11.aa9216"
            ]
        ]
    },
    {
        "id": "15c6da11.aa9216",
        "type": "join",
        "z": "b36ee370.d8e85",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 630,
        "y": 600,
        "wires": [
            [
                "a1f4c75e.db49e8"
            ]
        ]
    },
    {
        "id": "6d43ed8a.417544",
        "type": "http response",
        "z": "b36ee370.d8e85",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 810,
        "y": 520,
        "wires": []
    },
    {
        "id": "2577f6bc.c082fa",
        "type": "debug",
        "z": "b36ee370.d8e85",
        "name": "予約一覧",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 820,
        "y": 560,
        "wires": []
    },
    {
        "id": "63592857.76d5b8",
        "type": "comment",
        "z": "b36ee370.d8e85",
        "name": "リソース別予約一覧取得",
        "info": "",
        "x": 150,
        "y": 440,
        "wires": []
    },
    {
        "id": "b32e8b6f.30aac8",
        "type": "change",
        "z": "b36ee370.d8e85",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 480,
        "wires": [
            [
                "f94bbb34.2712f8",
                "f4926595.5fc4f8"
            ]
        ]
    },
    {
        "id": "2bb36a9c.bc3da6",
        "type": "inject",
        "z": "b36ee370.d8e85",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"id\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\"},\"query\":{}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 480,
        "wires": [
            [
                "b32e8b6f.30aac8"
            ]
        ]
    },
    {
        "id": "dd16f88b.399378",
        "type": "inject",
        "z": "b36ee370.d8e85",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"resourceid\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\",\"eventid\":\"djcjsd67gkduhog10cnatfjreg\"},\"query\":{}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 720,
        "wires": [
            [
                "b58f8686.9f5058"
            ]
        ]
    },
    {
        "id": "b58f8686.9f5058",
        "type": "change",
        "z": "b36ee370.d8e85",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 720,
        "wires": [
            [
                "c2b41b54.97ee58",
                "762bc402.aa992c"
            ]
        ]
    },
    {
        "id": "c2b41b54.97ee58",
        "type": "debug",
        "z": "b36ee370.d8e85",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 470,
        "y": 720,
        "wires": []
    },
    {
        "id": "762bc402.aa992c",
        "type": "function",
        "z": "b36ee370.d8e85",
        "name": "param",
        "func": "msg.payload={\n    //param:{\n    //    resourceId: msg.req.params.id,\n    //    date: date,\n    //},\n    param: {\n        calendarId: msg.req.params.resourceid,\n        eventId: msg.req.params.eventid\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 470,
        "y": 760,
        "wires": [
            [
                "52214fce.2b744"
            ]
        ]
    },
    {
        "id": "52214fce.2b744",
        "type": "function",
        "z": "b36ee370.d8e85",
        "name": "calendar.events.get",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\nconsole.log('calling calendar.events.get###')\nconsole.log('calendarId:'+msg.payload.param.calendarId);\nconsole.log('eventId:'+msg.payload.param.eventId);\n\n    calendar.events.get({\n        calendarId: msg.payload.param.calendarId,\n        eventId: msg.payload.param.eventId\n    }, (err, res) => {\n        if (err){\n            console.log('The API returned an error: ' + err);\n            msg.payload = {};\n            console.log('node.send();');\n            node.send(msg);\n            return;\n        }\n        console.log('res.data>>>');\n        console.dir(res.data);\n        const event = res.data;\n        if (event) {\n            console.log('target event:');\n            const start = event.start.dateTime || event.start.date;\n            console.log(`${start} - ${event.summary}`);\n            console.log(event);\n        } else {\n            console.log('No event found.');\n        }\n        msg.payload = {\"event\":event};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 630,
        "y": 760,
        "wires": [
            [
                "bea3af35.93ca2",
                "46097fe3.63074"
            ]
        ]
    },
    {
        "id": "bea3af35.93ca2",
        "type": "debug",
        "z": "b36ee370.d8e85",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 820,
        "y": 760,
        "wires": []
    },
    {
        "id": "9c78bae2.57e028",
        "type": "http in",
        "z": "b36ee370.d8e85",
        "name": "",
        "url": "/resources/:resourceid/events/:eventid",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 210,
        "y": 760,
        "wires": [
            [
                "762bc402.aa992c",
                "c2b41b54.97ee58"
            ]
        ]
    },
    {
        "id": "4aea2ed1.176a6",
        "type": "http response",
        "z": "b36ee370.d8e85",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 810,
        "y": 860,
        "wires": []
    },
    {
        "id": "d86b261e.1b47b8",
        "type": "comment",
        "z": "b36ee370.d8e85",
        "name": "予約情報取得",
        "info": "",
        "x": 110,
        "y": 680,
        "wires": []
    },
    {
        "id": "d749b88b.baa8a8",
        "type": "function",
        "z": "b36ee370.d8e85",
        "name": "出力形式に変換する",
        "func": "var dsk = msg.payload.description.split(':');\nvar outObj = {\n    detail: msg.payload,\n    eventId: msg.payload.id,\n    subject: msg.payload.summary,\n    user:dsk[1],\n    start: msg.payload.start.dateTime.substr(11,5),\n    end: msg.payload.end.dateTime.substr(11,5),\n}\nmsg.payload = {result: 'ok',event:outObj};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 520,
        "y": 820,
        "wires": [
            [
                "d5a3eec0.52f8b",
                "4aea2ed1.176a6"
            ]
        ]
    },
    {
        "id": "62fe42dc.56b98c",
        "type": "change",
        "z": "b36ee370.d8e85",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.event",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 820,
        "wires": [
            [
                "d749b88b.baa8a8"
            ]
        ]
    },
    {
        "id": "d5a3eec0.52f8b",
        "type": "debug",
        "z": "b36ee370.d8e85",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 830,
        "y": 820,
        "wires": []
    },
    {
        "id": "46097fe3.63074",
        "type": "switch",
        "z": "b36ee370.d8e85",
        "name": "",
        "property": "payload.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 170,
        "y": 840,
        "wires": [
            [
                "62fe42dc.56b98c"
            ],
            [
                "cba188b0.4aff18"
            ]
        ]
    },
    {
        "id": "cba188b0.4aff18",
        "type": "function",
        "z": "b36ee370.d8e85",
        "name": "not found",
        "func": "msg.payload = {result: 'not found',event:{}};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 860,
        "wires": [
            [
                "4aea2ed1.176a6",
                "d5a3eec0.52f8b"
            ]
        ]
    },
    {
        "id": "47267595.d661cc",
        "type": "subflow:3bd1c83b.24e548",
        "z": "3d69815d.415ade",
        "name": "",
        "x": 480,
        "y": 340,
        "wires": [
            [
                "b60dfc75.5e8",
                "469954f7.d6486c"
            ]
        ]
    },
    {
        "id": "b60dfc75.5e8",
        "type": "debug",
        "z": "3d69815d.415ade",
        "name": "現在状況更新バッチ",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 780,
        "y": 340,
        "wires": []
    },
    {
        "id": "595dbea.76bf84",
        "type": "inject",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "topic": "",
        "payload": "2019-01-05T16:25:00+09:00",
        "payloadType": "str",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 1760,
        "wires": [
            [
                "da44fcd3.dec"
            ]
        ]
    },
    {
        "id": "da44fcd3.dec",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "func": "var cFunc=global.get('cFunc');\n\nvar t = cFunc.getTimeFromTimeString(msg.payload);\nmsg.t = t;\nvar n = new Date().getTime();\nmsg.n = n;\nmsg.d = cFunc.getSavedTime(t, n);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 1760,
        "wires": [
            [
                "e980767d.e24e98"
            ]
        ]
    },
    {
        "id": "e753c671.1dc958",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 430,
        "y": 1760,
        "wires": []
    },
    {
        "id": "469954f7.d6486c",
        "type": "change",
        "z": "3d69815d.415ade",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "now",
                "pt": "msg",
                "to": "payload.currentStatus.at",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 170,
        "y": 460,
        "wires": [
            [
                "b50fca29.d500e8"
            ]
        ]
    },
    {
        "id": "b50fca29.d500e8",
        "type": "change",
        "z": "3d69815d.415ade",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.currentStatus.resources",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 460,
        "wires": [
            [
                "87d7a8e8.fac7f8"
            ]
        ]
    },
    {
        "id": "87d7a8e8.fac7f8",
        "type": "split",
        "z": "3d69815d.415ade",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 170,
        "y": 520,
        "wires": [
            [
                "279c2a2b.610716",
                "8e5f725c.9ae1f"
            ]
        ]
    },
    {
        "id": "279c2a2b.610716",
        "type": "debug",
        "z": "3d69815d.415ade",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 490,
        "y": 620,
        "wires": []
    },
    {
        "id": "8e5f725c.9ae1f",
        "type": "switch",
        "z": "3d69815d.415ade",
        "name": "未チェックイン？",
        "property": "payload.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 350,
        "y": 520,
        "wires": [
            [
                "ca67bec7.7efd2"
            ],
            []
        ]
    },
    {
        "id": "ca67bec7.7efd2",
        "type": "function",
        "z": "3d69815d.415ade",
        "name": "",
        "func": "var cFunc=global.get('cFunc');\nvar gInfo=global.get('gInfo');\nvar startTime = msg.payload.event.detail.start.dateTime;\n\nvar tStart = cFunc.getTimeFromTimeString(startTime);\nvar tNow = cFunc.getTimeFromTimeString(msg.now);\n\nvar delta = tNow - tStart;\nvar deltaMin = Math.floor(delta / 60000);\nvar timeToAutoCancel = gInfo.constants.autoCancelMin - deltaMin;\n\nmsg.payload.timePast = deltaMin;\nmsg.payload.timeToAutoCancel = timeToAutoCancel;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 510,
        "y": 500,
        "wires": [
            [
                "ac7e888b.a84a38"
            ]
        ]
    },
    {
        "id": "23b326cf.f3ddca",
        "type": "debug",
        "z": "3d69815d.415ade",
        "name": "自動キャンセル発動",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 860,
        "y": 560,
        "wires": []
    },
    {
        "id": "ac7e888b.a84a38",
        "type": "switch",
        "z": "3d69815d.415ade",
        "name": "時間切れ？",
        "property": "payload.timePast",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gte",
                "v": "10",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 650,
        "y": 480,
        "wires": [
            [
                "d977e51c.7469e8"
            ],
            []
        ]
    },
    {
        "id": "fb2fb6e9.c98f08",
        "type": "http request",
        "z": "3d69815d.415ade",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "",
        "x": 820,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "d977e51c.7469e8",
        "type": "function",
        "z": "3d69815d.415ade",
        "name": "",
        "func": "var dsk = msg.payload.event.detail.description.split(':');\n\nvar data =\n{\n    \"req\": {\n        \"params\": {\n            \"resourceid\": msg.payload.resourceId,\n            \"eventid\": msg.payload.event.eventId\n        },\n        \"query\": {\n            \"operation\": \"autocancel\"\n        },\n        \"body\": {\n            \"pin\": dsk[2]\n        }\n    }\n};\nmsg.payload = data;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 790,
        "y": 480,
        "wires": [
            [
                "23b326cf.f3ddca",
                "3ea46a3a.b9ad36"
            ]
        ]
    },
    {
        "id": "3ea46a3a.b9ad36",
        "type": "link out",
        "z": "3d69815d.415ade",
        "name": "",
        "links": [
            "530ad113.0ba55",
            "aa36c7e7.d6a448"
        ],
        "x": 820,
        "y": 600,
        "wires": []
    },
    {
        "id": "46acd943.b79e28",
        "type": "inject",
        "z": "8e9cc33.fffd44",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 1140,
        "wires": [
            [
                "2d89c2ab.d511be"
            ]
        ]
    },
    {
        "id": "2d89c2ab.d511be",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "param",
        "func": "var calendarId = 'kaigishitsu.work_3835353636383833343637@resource.calendar.google.com';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'check': {\n            'timeMin': \"2019-03-13T16:30:00+09:00\",\n            'timeMax': \"2019-03-13T17:10:00+09:00\",\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    },\n    'event': {\n        \"subject\": \"てすと\",\n        \"user\": \"tana\",\n        \"pin\": \"100\",\n        \"status\": 0,\n        \"saved\": 0\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 1140,
        "wires": [
            [
                "5ad8a264.a03f7c"
            ]
        ]
    },
    {
        "id": "5ad8a264.a03f7c",
        "type": "subflow:7c664e6f.eb225",
        "z": "8e9cc33.fffd44",
        "name": "",
        "x": 380,
        "y": 1140,
        "wires": [
            [
                "dd509354.263fb"
            ]
        ]
    },
    {
        "id": "dd509354.263fb",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 530,
        "y": 1140,
        "wires": []
    },
    {
        "id": "5ab2d5bb.1a9c1c",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "calendar.events.update",
        "func": "var calList = [];\nconst calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar timezone = 'Asia/Tokyo';\nvar master ='master@kaigishitsu.work';\n\nvar returned = false;\n\nvar event = {\n    'summary': msg.payload.event.subject,\n    //'location': '',\n    'description': msg.payload.event.status+':'+msg.payload.event.user+':'+msg.payload.event.pin+':'+msg.payload.event.saved,\n    'start': {\n        'dateTime': msg.payload.param.check.timeMin,\n        'timeZone': timezone,\n    },\n    'end': {\n        'dateTime': msg.payload.param.check.timeMax,\n        'timeZone': 'Asia/Tokyo',\n    },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n    'organizer': {'email': master},\n    'attendees': [\n        //{'email': master},\n        {'email': msg.payload.param.calendarId, 'resource': true}\n        ],\n    'reminders': {},\n};\nvar apiOptions = {\n    auth: auth,\n    calendarId: master,\n    eventId: msg.payload.eventId,\n    resource: event\n};\nconsole.log('apiOptions:'+apiOptions);\ncalendar.events.update(\n    apiOptions,\n    (err, event) => {\n        if (err) {\n            msg.payload.err = err;\n            console.log('There was an error contacting the Calendar service: ' + err);\n        } else {\n            console.log('Event created: %s', event.data.htmlLink);\n        }\n        msg.payload.id=event.data.id;\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 1240,
        "wires": [
            [
                "265b6f67.85aa8"
            ]
        ]
    },
    {
        "id": "cdb47294.df3ac",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "param",
        "func": "var calendarId = 'kaigishitsu.work_3835353636383833343637@resource.calendar.google.com';\nvar eventId = '4kl4nfgrr0nhual90mn5klv614';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'check': {\n            'timeMin': \"2019-03-13T16:30:00+09:00\",\n            'timeMax': \"2019-03-13T17:20:00+09:00\",\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    },\n    'event': {\n        \"subject\": \"てすと\",\n        \"user\": \"tana\",\n        \"pin\": \"100\",\n        \"status\": 0,\n        \"saved\": 0\n    },\n    'eventId': eventId\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 1240,
        "wires": [
            [
                "5ab2d5bb.1a9c1c"
            ]
        ]
    },
    {
        "id": "58b955a0.26b8ac",
        "type": "inject",
        "z": "8e9cc33.fffd44",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 1240,
        "wires": [
            [
                "cdb47294.df3ac"
            ]
        ]
    },
    {
        "id": "265b6f67.85aa8",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 590,
        "y": 1240,
        "wires": []
    },
    {
        "id": "9eebb3c0.7480d",
        "type": "subflow:3bd1c83b.24e548",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "x": 670,
        "y": 1680,
        "wires": [
            []
        ]
    },
    {
        "id": "9ef7f44c.eff128",
        "type": "switch",
        "z": "3d69815d.415ade",
        "name": "",
        "property": "authStats.stat",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "OK",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 410,
        "y": 160,
        "wires": [
            [
                "8928bbf.da81d48"
            ],
            [
                "14977fad.0a588"
            ]
        ]
    },
    {
        "id": "5c6f92b9.8b3a9c",
        "type": "debug",
        "z": "3d69815d.415ade",
        "name": "初期化エラー（未認証）",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 810,
        "y": 160,
        "wires": []
    },
    {
        "id": "14977fad.0a588",
        "type": "template",
        "z": "3d69815d.415ade",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Authorization not completed. status:{{global.authStats.stat}}",
        "output": "str",
        "x": 620,
        "y": 160,
        "wires": [
            [
                "5c6f92b9.8b3a9c"
            ]
        ]
    },
    {
        "id": "3ca690e9.800c7",
        "type": "http in",
        "z": "99f53198.98718",
        "name": "",
        "url": "/mente/stats",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 100,
        "wires": [
            [
                "b153b1e0.edbae",
                "5dbf923a.ad95dc"
            ]
        ]
    },
    {
        "id": "22fd5c16.765124",
        "type": "comment",
        "z": "99f53198.98718",
        "name": "状況取得",
        "info": "",
        "x": 100,
        "y": 60,
        "wires": []
    },
    {
        "id": "5da2e088.94a3d",
        "type": "http response",
        "z": "99f53198.98718",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1000,
        "y": 100,
        "wires": []
    },
    {
        "id": "b6b61194.1c6f6",
        "type": "http in",
        "z": "99f53198.98718",
        "name": "",
        "url": "/mente/setcredentials",
        "method": "post",
        "upload": true,
        "swaggerDoc": "",
        "x": 160,
        "y": 300,
        "wires": [
            [
                "21551b95.61e924",
                "fba41be6.556db8"
            ]
        ]
    },
    {
        "id": "21551b95.61e924",
        "type": "function",
        "z": "99f53198.98718",
        "name": "file check",
        "func": "let files = msg.req.files;\n\nif(files.length === 0) {\n    msg.payload = null;\n    return msg;\n}\n\nmsg.payload = files[0].buffer;\nmsg.filename = \"/data/credentials.json\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 360,
        "y": 300,
        "wires": [
            [
                "55330564.1ff0fc"
            ]
        ]
    },
    {
        "id": "ca6390bb.373ef",
        "type": "file",
        "z": "99f53198.98718",
        "name": "",
        "filename": "/data/credentials.json",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "x": 680,
        "y": 320,
        "wires": [
            [
                "90dcb80a.2026d8"
            ]
        ]
    },
    {
        "id": "5e67e36b.43d3ec",
        "type": "subflow:25a48dc1.1a6252",
        "z": "3d69815d.415ade",
        "x": 370,
        "y": 80,
        "wires": [
            [
                "6e4f6b00.59a774",
                "b9ac00ad.a2781"
            ]
        ]
    },
    {
        "id": "90dcb80a.2026d8",
        "type": "subflow:25a48dc1.1a6252",
        "z": "99f53198.98718",
        "name": "",
        "x": 750,
        "y": 380,
        "wires": [
            [
                "15891dac.6c6752",
                "541d97ce.df4498"
            ]
        ]
    },
    {
        "id": "4963195.5584de8",
        "type": "switch",
        "z": "99f53198.98718",
        "name": "",
        "property": "authStats.stat",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "OK",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "NeedToAuthorize",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "NoClientSecrets",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 450,
        "y": 120,
        "wires": [
            [
                "458a27a4.3c3e08"
            ],
            [
                "31017269.35827e"
            ],
            [
                "8616ce06.08f13"
            ],
            [
                "5b9c88a.63d5b78"
            ]
        ]
    },
    {
        "id": "458a27a4.3c3e08",
        "type": "template",
        "z": "99f53198.98718",
        "name": "ok",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!doctype html>\n<html>\n    <head>\n        <meta charset=\"utf-8\">\n        <title>stats</title>\n    </head>\n    <body>\n        <p>status:{{global.authStats.stat}}</p>\n    </body>\n</html>",
        "output": "str",
        "x": 590,
        "y": 60,
        "wires": [
            [
                "5da2e088.94a3d"
            ]
        ]
    },
    {
        "id": "b153b1e0.edbae",
        "type": "debug",
        "z": "99f53198.98718",
        "name": "mente/stats",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 290,
        "y": 60,
        "wires": []
    },
    {
        "id": "3582b983.812846",
        "type": "debug",
        "z": "99f53198.98718",
        "name": "Error!",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 1210,
        "y": 40,
        "wires": []
    },
    {
        "id": "8616ce06.08f13",
        "type": "template",
        "z": "99f53198.98718",
        "name": "upload credentials",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!doctype html>\n<html>\n    <head>\n        <meta charset=\"utf-8\">\n        <title>stats</title>\n    </head>\n    <body>\n        <p>{{payload}}</p>\n        <p>status:{{global.authStats.stat}}</p>\n        <form action=\"/mente/setcredentials\" method=\"post\" enctype=\"multipart/form-data\">\n            <input name=\"file\" type=\"file\" id=\"file\"><br>\n            <input type=\"submit\" value=\"アップロード\">\n        </form>\n    </body>\n</html>",
        "output": "str",
        "x": 630,
        "y": 140,
        "wires": [
            [
                "5da2e088.94a3d"
            ]
        ]
    },
    {
        "id": "31497d06.895d52",
        "type": "catch",
        "z": "99f53198.98718",
        "name": "",
        "scope": null,
        "x": 1060,
        "y": 40,
        "wires": [
            [
                "3582b983.812846"
            ]
        ]
    },
    {
        "id": "f100f88c.cd1f58",
        "type": "link in",
        "z": "99f53198.98718",
        "name": "",
        "links": [
            "15891dac.6c6752",
            "ddb14e69.8a352"
        ],
        "x": 235,
        "y": 140,
        "wires": [
            [
                "4963195.5584de8"
            ]
        ]
    },
    {
        "id": "15891dac.6c6752",
        "type": "link out",
        "z": "99f53198.98718",
        "name": "",
        "links": [
            "f100f88c.cd1f58"
        ],
        "x": 995,
        "y": 280,
        "wires": []
    },
    {
        "id": "55330564.1ff0fc",
        "type": "switch",
        "z": "99f53198.98718",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 490,
        "y": 300,
        "wires": [
            [
                "ae444011.10f1b"
            ],
            [
                "ca6390bb.373ef"
            ]
        ]
    },
    {
        "id": "5dbf923a.ad95dc",
        "type": "change",
        "z": "99f53198.98718",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 100,
        "wires": [
            [
                "4963195.5584de8"
            ]
        ]
    },
    {
        "id": "fba41be6.556db8",
        "type": "debug",
        "z": "99f53198.98718",
        "name": "mente/setcredentials",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 400,
        "y": 260,
        "wires": []
    },
    {
        "id": "ae444011.10f1b",
        "type": "change",
        "z": "99f53198.98718",
        "name": "No file.",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "No file.",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 280,
        "wires": [
            [
                "15891dac.6c6752"
            ]
        ]
    },
    {
        "id": "e22bd995.080418",
        "type": "link in",
        "z": "3d69815d.415ade",
        "name": "",
        "links": [
            "512fa6d6.c59e78"
        ],
        "x": 80,
        "y": 240,
        "wires": [
            [
                "8928bbf.da81d48"
            ]
        ]
    },
    {
        "id": "512fa6d6.c59e78",
        "type": "link out",
        "z": "99f53198.98718",
        "name": "データ取得へ...",
        "links": [
            "e22bd995.080418"
        ],
        "x": 1095,
        "y": 380,
        "wires": []
    },
    {
        "id": "541d97ce.df4498",
        "type": "switch",
        "z": "99f53198.98718",
        "name": "if OK",
        "property": "authStats.stat",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "OK",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1010,
        "y": 380,
        "wires": [
            [
                "512fa6d6.c59e78"
            ]
        ]
    },
    {
        "id": "31017269.35827e",
        "type": "template",
        "z": "99f53198.98718",
        "name": "authorize",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!doctype html>\n<html>\n    <head>\n        <meta charset=\"utf-8\">\n        <title>stats</title>\n    </head>\n    <body>\n        <p>status:{{global.authStats.stat}}</p>\n        click <a href=\"{{global.authStats.url}}\" target=\"_blank\">here</a> to authorize.\n        <hr/>\n        <form action=\"/mente/setcode\" method=\"get\">\n            <input name=\"code\" type=\"text\" id=\"code\"><br>\n            <input type=\"submit\" value=\"設定\">\n        </form>\n    </body>\n</html>",
        "output": "str",
        "x": 600,
        "y": 100,
        "wires": [
            [
                "5da2e088.94a3d"
            ]
        ]
    },
    {
        "id": "2d050091.06aa6",
        "type": "catch",
        "z": "25a48dc1.1a6252",
        "name": "",
        "scope": null,
        "x": 480,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "6cd8f6e2.4c3b28",
        "type": "http in",
        "z": "99f53198.98718",
        "name": "",
        "url": "/mente/setcode",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 440,
        "wires": [
            [
                "357a74ea.19ca5c",
                "e807b77f.8da648"
            ]
        ]
    },
    {
        "id": "357a74ea.19ca5c",
        "type": "switch",
        "z": "99f53198.98718",
        "name": "",
        "property": "payload.code",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "empty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 290,
        "y": 460,
        "wires": [
            [
                "dc78bd0b.d7aef"
            ],
            [
                "dc78bd0b.d7aef"
            ],
            [
                "667e16d0.094cd8"
            ]
        ]
    },
    {
        "id": "dc78bd0b.d7aef",
        "type": "change",
        "z": "99f53198.98718",
        "name": "No code.",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "No code.",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 440,
        "wires": [
            [
                "ddb14e69.8a352"
            ]
        ]
    },
    {
        "id": "ddb14e69.8a352",
        "type": "link out",
        "z": "99f53198.98718",
        "name": "",
        "links": [
            "f100f88c.cd1f58"
        ],
        "x": 535,
        "y": 440,
        "wires": []
    },
    {
        "id": "667e16d0.094cd8",
        "type": "function",
        "z": "99f53198.98718",
        "name": "",
        "func": "var authStats = global.get('authStats') || \n{\n};\nauthStats.code = msg.payload.code;\nglobal.set('authStats', authStats);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 430,
        "y": 480,
        "wires": [
            [
                "90dcb80a.2026d8"
            ]
        ]
    },
    {
        "id": "586907c7.f39c28",
        "type": "comment",
        "z": "99f53198.98718",
        "name": "ユーザID設定",
        "info": "",
        "x": 110,
        "y": 260,
        "wires": []
    },
    {
        "id": "fd44c64.76b0938",
        "type": "comment",
        "z": "99f53198.98718",
        "name": "oAuth2認証",
        "info": "",
        "x": 110,
        "y": 400,
        "wires": []
    },
    {
        "id": "e807b77f.8da648",
        "type": "debug",
        "z": "99f53198.98718",
        "name": "mente/setcode",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 320,
        "y": 400,
        "wires": []
    },
    {
        "id": "a90a989e.091608",
        "type": "comment",
        "z": "99f53198.98718",
        "name": "データ取得へ...",
        "info": "",
        "x": 1160,
        "y": 340,
        "wires": []
    },
    {
        "id": "5b9c88a.63d5b78",
        "type": "template",
        "z": "99f53198.98718",
        "name": "unknown status",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!doctype html>\n<html>\n    <head>\n        <meta charset=\"utf-8\">\n        <title>stats</title>\n    </head>\n    <body>\n        <p>status:{{global.authStats.stat}}</p>\n        click <a href=\"{{global.authStats.url}}\" target=\"_blank\">here</a> to authorize.\n        <hr/>\n        <form action=\"/mente/setcode\" method=\"get\">\n            <input name=\"code\" type=\"text\" id=\"code\"><br>\n            <input type=\"submit\" value=\"設定\">\n        </form>\n        <form action=\"/mente/setcredentials\" method=\"post\" enctype=\"multipart/form-data\">\n            <input name=\"file\" type=\"file\" id=\"file\"><br>\n            <input type=\"submit\" value=\"アップロード\">\n        </form>\n    </body>\n</html>",
        "output": "str",
        "x": 620,
        "y": 180,
        "wires": [
            [
                "5da2e088.94a3d"
            ]
        ]
    },
    {
        "id": "4e167bc5.fce494",
        "type": "function",
        "z": "b43956c5.b0eb58",
        "name": "create commandLog",
        "func": "var cFunc=global.get('cFunc');\nvar cLog = {\n    datetime: new Date().getTime(),\n    requestType: \"\",\n    resourceId: \"\",\n    eventId: \"\",\n    pin: \"\",\n    result: \"\",\n    before: {\n        subject: \"\",\n        description: \"\",\n        start: \"\",\n        end: \"\",\n    },\n    request: {\n        subject: \"\",\n        description: \"\",\n        start: \"\",\n        end: \"\",\n    }\n}\nmsg.cLog = cLog;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 240,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "997381a6.1ebad",
        "type": "function",
        "z": "911a8268.a68b6",
        "name": "write log",
        "func": "const auth = global.get('auth');\nconst sheets = global.get('sheets');\nconst cFunc = global.get('cFunc');\n\nvar l = msg.cLog;\n\nfunction c(ts){\n    if(!ts || ts ===\"\"){\n        return ts;\n    }\n    return cFunc.getJstCommonString(cFunc.getTimeFromTimeString(ts));\n}\nconst req = {\n    // spreadsheetId: '1XkAkXYc3tDURodovPVib4S1eEn-m-HXfR4JphY_BWnc',\n    spreadsheetId: '1Q6mCHwL_6ZWup7txyyZxb0Wgne8EePa78aPXsV2rBQA',\n    range: 'A1',\n    valueInputOption: 'USER_ENTERED',\n    insertDataOption: 'INSERT_ROWS',\n    resource: {\n        values: [\n            [\n\t\t\t\tcFunc.getJstCommonString(l.datetime),\n\t\t\t\tl.requestType,\n\t\t\t\tl.resourceId,\n\t\t\t\tl.eventId,\n\t\t\t\tl.pin,\n\t\t\t\tl.result,\n\t\t\t\tl.before.subject,\n\t\t\t\tl.before.description,\n\t\t\t\tc(l.before.start),\n\t\t\t\tc(l.before.end),\n\t\t\t\tl.request.subject,\n\t\t\t\tl.request.description,\n\t\t\t\tc(l.request.start),\n\t\t\t\tc(l.request.end),\n            ],\n        ],\n    },\n    auth: auth,\n};\nconsole.log('***** calling sheets.spreadsheets.values.append *****')\nsheets.spreadsheets.values.append(req, (err, res) =>{\n    if(err){\n        console.log('***** error!' + err);\n    } else {\n        console.log('***** res: ' + res);\n    }\n});\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 240,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "e980767d.e24e98",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "func": "var cFunc=global.get('cFunc');\n\nvar fmt = new Date(msg.t);\nmsg.fmt = fmt;\n\nvar df = cFunc.getDateObject(fmt);\nmsg.df = df;\n\nvar n2 = new Date();\nmsg.n2 = n2;\nvar t2 = cFunc.getTimeString(n2.getTime());\nmsg.t2 = t2;\nvar d2 = cFunc.getDateObject(n2);\nmsg.d2 = d2;\n\nvar jt = cFunc.getJstCommonString(msg.t);\nmsg.jt = jt;\nvar jt2 = cFunc.getJstCommonString(n2.getTime());\nmsg.jt2 = jt2;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 270,
        "y": 1800,
        "wires": [
            [
                "e753c671.1dc958"
            ]
        ]
    },
    {
        "id": "f66f170d.434208",
        "type": "inject",
        "z": "8e9cc33.fffd44",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 1380,
        "wires": [
            [
                "e63f1df3.baa77"
            ]
        ]
    },
    {
        "id": "e63f1df3.baa77",
        "type": "function",
        "z": "8e9cc33.fffd44",
        "name": "set CommandLog(Modify)",
        "func": "msg.cLog = {before:{},request:{}};\nmsg.cLog.requestType = \"Modify\";\nmsg.cLog.resourceId = \"msg.req.params.resourceid\";\nmsg.cLog.eventId = \"msg.req.params.eventid\";\nmsg.cLog.pin = \"msg.req.body.pin\";\nmsg.cLog.before.subject = \"msg.orgEvent.summary\";\nmsg.cLog.before.description = \"msg.orgEvent.description\";\nmsg.cLog.before.start = \"msg.orgEvent.start.dateTime\";\nmsg.cLog.before.end = \"msg.orgEvent.end.dateTime\";\n\n//var timeMin = msg.req.body.date+'T'+msg.req.body.start+':00+09:00';\n//var timeMax = msg.req.body.date+'T'+msg.req.body.end+':00+09:00';\n//var orgStats = msg.orgEvent.description.split(':');\n//var orgStatus = orgStats[0];\n//var orgSaved = orgStats[3];\nmsg.cLog.request.subject = \"msg.req.body.subject\";\nmsg.cLog.request.description = \"orgStatus+':'+msg.req.body.user+':'+msg.req.body.newPin+':'+orgSaved\",\nmsg.cLog.request.start = \"timeMin\";\nmsg.cLog.request.end = \"timeMax\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 300,
        "y": 1380,
        "wires": [
            [
                "b5c4f14b.74225"
            ]
        ]
    },
    {
        "id": "b5c4f14b.74225",
        "type": "subflow:911a8268.a68b6",
        "z": "8e9cc33.fffd44",
        "x": 500,
        "y": 1380,
        "wires": [
            [
                "86b501ab.16d48"
            ]
        ]
    },
    {
        "id": "86b501ab.16d48",
        "type": "debug",
        "z": "8e9cc33.fffd44",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 630,
        "y": 1380,
        "wires": []
    },
    {
        "id": "3b402011.2852b",
        "type": "change",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "req.body",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 510,
        "y": 100,
        "wires": [
            [
                "b74e5d21.5848c",
                "83fa15b3.f23048"
            ]
        ]
    },
    {
        "id": "1c89a543.dd2a6b",
        "type": "change",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 100,
        "wires": [
            [
                "3b402011.2852b"
            ]
        ]
    },
    {
        "id": "b74e5d21.5848c",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 690,
        "y": 60,
        "wires": []
    },
    {
        "id": "df48dce9.3f99a",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "param",
        "func": "var calendarId = msg.req.params.id;\nvar timeMin = msg.payload.date+'T'+msg.payload.start+':00+09:00';\nvar timeMax = msg.payload.date+'T'+msg.payload.end+':00+09:00';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'check': {\n            'timeMin': timeMin,\n            'timeMax': timeMax,\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 690,
        "y": 140,
        "wires": [
            [
                "3e9cb073.cc3d2"
            ]
        ]
    },
    {
        "id": "a1a4ab93.a29828",
        "type": "inject",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"id\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\"},\"query\":{},\"body\":{\"date\":\"2018-11-29\",\"start\":\"18:00\",\"end\":\"19:00\",\"user\":\"社員abc\",\"subject\":\"テスト会議X\",\"pin\":\"1234\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 100,
        "wires": [
            [
                "1c89a543.dd2a6b"
            ]
        ]
    },
    {
        "id": "c2b73b78.f42f78",
        "type": "http in",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "url": "/resources/:id/events",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 140,
        "wires": [
            [
                "b74e5d21.5848c",
                "83fa15b3.f23048"
            ]
        ]
    },
    {
        "id": "b596ffad.5526f",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "calendar.Freebusy.query",
        "func": "const calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar check = {\n    auth: auth,\n    resource: msg.payload.param.check\n};\n\nconsole.log('calendar.Freebusy.query:'+check);\nvar response = calendar.freebusy.query(check,\n    function(err, response){\n        var obj={status:-1, statusLabel:'不明'};\n        console.dir(err);\n        if(response){\n            console.dir(response.data);\n        }\n        \n        if(response && \n            response.data &&\n            response.data.calendars &&\n            response.data.calendars[msg.req.params.id] &&\n            response.data.calendars[msg.req.params.id].busy){\n            if(response.data.calendars[msg.req.params.id].busy.length === 0){\n                //vacancy\n                obj.status=0;\n                obj.statusLabel='OK';\n            } else {\n                obj.status=1;\n                obj.statusLabel='NG';\n            }\n        }\n        msg.payload={param:msg.payload.param, result:obj};\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 360,
        "y": 180,
        "wires": [
            [
                "ecba5737.4a9658",
                "8b9135a5.efd1e8"
            ]
        ]
    },
    {
        "id": "ecba5737.4a9658",
        "type": "switch",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "property": "payload.result.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 180,
        "y": 240,
        "wires": [
            [
                "e97ca71c.c66fc8"
            ],
            [
                "7381d215.81765c"
            ]
        ]
    },
    {
        "id": "8b9135a5.efd1e8",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 560,
        "y": 180,
        "wires": []
    },
    {
        "id": "e97ca71c.c66fc8",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "busy",
        "func": "var result={\n    status: \"busy\"\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 320,
        "y": 220,
        "wires": [
            [
                "2480b234.3bcf4e"
            ]
        ]
    },
    {
        "id": "97034dec.46d8e",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "ok",
        "func": "var result={\n    status: \"ok\",\n    id: msg.payload.id\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 880,
        "y": 260,
        "wires": [
            [
                "1ea9e98e.2cd1c6"
            ]
        ]
    },
    {
        "id": "eef8df21.1f1cb",
        "type": "comment",
        "z": "9f3a28b9.aa8348",
        "name": "予約登録",
        "info": "",
        "x": 110,
        "y": 60,
        "wires": []
    },
    {
        "id": "7381d215.81765c",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "event",
        "func": "msg.payload.event={\n    \"subject\": msg.req.body.subject,\n    \"user\": msg.req.body.user,\n    \"pin\": msg.req.body.pin,\n    \"status\": 0,\n    \"saved\": 0,\n    \"checkedin\": -1\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 320,
        "y": 260,
        "wires": [
            [
                "ab8dea6e.3dc608"
            ]
        ]
    },
    {
        "id": "ab8dea6e.3dc608",
        "type": "subflow:7c664e6f.eb225",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "x": 480,
        "y": 260,
        "wires": [
            [
                "23996d2e.56cf42",
                "51d9cb3d.6ac8f4"
            ]
        ]
    },
    {
        "id": "1ea9e98e.2cd1c6",
        "type": "link out",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "links": [
            "d91dcffa.0378",
            "f6ff5517.8c9158"
        ],
        "x": 975,
        "y": 260,
        "wires": []
    },
    {
        "id": "23996d2e.56cf42",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "イベント登録の戻りpayload",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 720,
        "y": 300,
        "wires": []
    },
    {
        "id": "2480b234.3bcf4e",
        "type": "link out",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "c1b9fdb1.fd6ca"
        ],
        "x": 855,
        "y": 220,
        "wires": []
    },
    {
        "id": "3e9cb073.cc3d2",
        "type": "subflow:b43956c5.b0eb58",
        "z": "9f3a28b9.aa8348",
        "x": 860,
        "y": 140,
        "wires": [
            [
                "f11b4dd6.1d69d"
            ]
        ]
    },
    {
        "id": "f11b4dd6.1d69d",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "set CommandLog(Create)",
        "func": "msg.cLog.requestType = \"Create\";\nmsg.cLog.resourceId = msg.req.params.id;\nmsg.cLog.eventId = \"\";\n//msg.cLog.pin = msg.req.body.pin;\n//msg.cLog.before.subject = msg.orgEvent.summary;\n//msg.cLog.before.description = msg.orgEvent.description;\n//msg.cLog.before.start = msg.orgEvent.start.dateTime;\n//msg.cLog.before.end = msg.orgEvent.end.dateTime;\n\nmsg.cLog.request.subject = msg.req.body.subject;\nmsg.cLog.request.description = '0:'+msg.req.body.user+':'+msg.req.body.pin+':0:-1',\nmsg.cLog.request.start = msg.payload.param.check.timeMin;\nmsg.cLog.request.end = msg.payload.param.check.timeMax;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1100,
        "y": 140,
        "wires": [
            [
                "b596ffad.5526f"
            ]
        ]
    },
    {
        "id": "51d9cb3d.6ac8f4",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "set CommandLog(Create)",
        "func": "msg.cLog.eventId = msg.payload.id;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 700,
        "y": 260,
        "wires": [
            [
                "97034dec.46d8e"
            ]
        ]
    },
    {
        "id": "51c61be2.b7d4d4",
        "type": "http in",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "url": "/resources/:resourceid/events/:eventid",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 220,
        "y": 460,
        "wires": [
            [
                "74f87eea.5a63d",
                "9f823975.d91bb8"
            ]
        ]
    },
    {
        "id": "74f87eea.5a63d",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "param",
        "func": "var master ='primary';\n\nmsg.payload={\n    param: {\n        //calendarId: msg.req.params.resourceid,\n        calendarId: master,\n        eventId: msg.req.params.eventid\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 490,
        "y": 460,
        "wires": [
            [
                "c6a70a.fae2c8f8"
            ]
        ]
    },
    {
        "id": "9f823975.d91bb8",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 490,
        "y": 420,
        "wires": []
    },
    {
        "id": "deef146b.4b5db8",
        "type": "change",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 420,
        "wires": [
            [
                "9f823975.d91bb8",
                "74f87eea.5a63d"
            ]
        ]
    },
    {
        "id": "6d7ce058.b65ea",
        "type": "inject",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"resourceid\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\",\"eventid\":\"djcjsd67gkduhog10cnatfjreg\"},\"query\":{}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 420,
        "wires": [
            [
                "deef146b.4b5db8"
            ]
        ]
    },
    {
        "id": "a3ce4221.18114",
        "type": "comment",
        "z": "9f3a28b9.aa8348",
        "name": "予約削除",
        "info": "",
        "x": 110,
        "y": 380,
        "wires": []
    },
    {
        "id": "4a240d09.e36bf4",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "calendar.events.delete",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\nconsole.log('calling calendar.events.delete###')\nconsole.log('calendarId:'+msg.payload.param.calendarId);\nconsole.log('eventId:'+msg.payload.param.eventId);\n\n    calendar.events.delete({\n        calendarId: msg.payload.param.calendarId,\n        eventId: msg.payload.param.eventId\n    }, \n    (err, event) => {\n        if (err) {\n            console.log('There was an error contacting the Calendar service: ' + err);\n        } else {\n            console.log('Event deleted.');\n        }\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 590,
        "y": 540,
        "wires": [
            [
                "fea36e2e.94085"
            ]
        ]
    },
    {
        "id": "fea36e2e.94085",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "ok",
        "func": "var result={\n    status: \"ok\",\n    id: msg.payload.id\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 770,
        "y": 540,
        "wires": [
            [
                "7a985f9c.c4352"
            ]
        ]
    },
    {
        "id": "7a985f9c.c4352",
        "type": "link out",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "links": [
            "350ae040.5d597",
            "d91dcffa.0378",
            "f6ff5517.8c9158"
        ],
        "x": 855,
        "y": 540,
        "wires": []
    },
    {
        "id": "c6a70a.fae2c8f8",
        "type": "subflow:b43956c5.b0eb58",
        "z": "9f3a28b9.aa8348",
        "x": 580,
        "y": 500,
        "wires": [
            [
                "bab68d82.15d9e"
            ]
        ]
    },
    {
        "id": "bab68d82.15d9e",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "set CommandLog(Delete)",
        "func": "msg.cLog.requestType = \"Delete\";\nmsg.cLog.resourceId = msg.payload.param.calendarId;\nmsg.cLog.eventId = msg.req.params.eventid;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 820,
        "y": 500,
        "wires": [
            [
                "4a240d09.e36bf4"
            ]
        ]
    },
    {
        "id": "3b1e1d03.a1b712",
        "type": "comment",
        "z": "9f3a28b9.aa8348",
        "name": "予約変更",
        "info": "",
        "x": 100,
        "y": 620,
        "wires": []
    },
    {
        "id": "1abaa737.0a3429",
        "type": "http in",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "url": "/resources/:resourceid/events/:eventid",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 210,
        "y": 700,
        "wires": [
            [
                "2d750a78.2e0c76",
                "7baac798.2d5438"
            ]
        ]
    },
    {
        "id": "db481bf5.fe1a08",
        "type": "inject",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"resourceid\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\",\"eventid\":\"djcjsd67gkduhog10cnatfjreg\"},\"query\":{},\"body\":{\"date\":\"2018-11-29\",\"start\":\"18:00\",\"end\":\"19:00\",\"user\":\"社員abc\",\"subject\":\"テスト会議X\",\"pin\":\"1234\",\"newPin\":\"1234\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 660,
        "wires": [
            [
                "cd90da18.f67b48"
            ]
        ]
    },
    {
        "id": "cd90da18.f67b48",
        "type": "change",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 660,
        "wires": [
            [
                "2d750a78.2e0c76",
                "7baac798.2d5438"
            ]
        ]
    },
    {
        "id": "2d750a78.2e0c76",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "予約変更",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 480,
        "y": 660,
        "wires": []
    },
    {
        "id": "e620c20d.a4a37",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "param",
        "func": "msg.payload={\n    //param:{\n    //    resourceId: msg.req.params.id,\n    //    date: date,\n    //},\n    param: {\n        calendarId: msg.req.params.resourceid,\n        eventId: msg.req.params.eventid\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 470,
        "y": 740,
        "wires": [
            [
                "41d52d15.bf2cc4"
            ]
        ]
    },
    {
        "id": "41d52d15.bf2cc4",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "calendar.events.get",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\nconsole.log('calling calendar.events.get###')\nconsole.log('calendarId:'+msg.payload.param.calendarId);\nconsole.log('eventId:'+msg.payload.param.eventId);\n\n    calendar.events.get({\n        calendarId: msg.payload.param.calendarId,\n        eventId: msg.payload.param.eventId\n    }, (err, res) => {\n        if (err){\n            console.log('The API returned an error: ' + err);\n            msg.payload = {};\n            console.log('node.send();');\n            node.send(msg);\n            return;\n        }\n        console.log('res.data>>>');\n        console.dir(res.data);\n        const event = res.data;\n        if (event) {\n            console.log('target event:');\n            const start = event.start.dateTime || event.start.date;\n            console.log(`${start} - ${event.summary}`);\n            console.log(event);\n        } else {\n            console.log('No event found.');\n        }\n        msg.payload = {\"event\":event};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 640,
        "y": 740,
        "wires": [
            [
                "3cb8d28b.5e4fce"
            ]
        ]
    },
    {
        "id": "38204740.73d748",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 1070,
        "y": 740,
        "wires": []
    },
    {
        "id": "3cb8d28b.5e4fce",
        "type": "change",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "orgEvent",
                "pt": "msg",
                "to": "payload.event",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 850,
        "y": 740,
        "wires": [
            [
                "38204740.73d748",
                "75817129.15a46"
            ]
        ]
    },
    {
        "id": "d1314fab.827f6",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "param",
        "func": "var calendarId = msg.req.params.resourceid;\nvar eventId = msg.req.params.eventid;\nvar timeMin = msg.req.body.date+'T'+msg.req.body.start+':00+09:00';\nvar timeMax = msg.req.body.date+'T'+msg.req.body.end+':00+09:00';\nvar orgStats = msg.orgEvent.description.split(':');\nvar orgStatus = orgStats[0];\nvar orgSaved = orgStats[3];\nvar orgCheckedin = orgStats[4] || '-1';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'eventId': eventId,\n        'check': {\n            'timeMin': timeMin,\n            'timeMax': timeMax,\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    },\n    'event': {\n        \"subject\": msg.req.body.subject,\n        \"user\": msg.req.body.user,\n        \"pin\": msg.req.body.newPin,\n        \"status\": parseInt(orgStatus, 10),\n        \"saved\": parseInt(orgSaved, 10),\n        \"checkedin\": parseInt(orgCheckedin, 10)\n    },\n    'eventId': eventId,\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 390,
        "y": 1200,
        "wires": [
            [
                "d56e2a71.fa1518"
            ]
        ]
    },
    {
        "id": "d56e2a71.fa1518",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "calendar.events.update",
        "func": "var calList = [];\nconst calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar timezone = 'Asia/Tokyo';\nvar master ='primary';\n\nvar returned = false;\n\nvar event = {\n    'summary': msg.payload.event.subject,\n    //'location': '',\n    'description': msg.payload.event.status+':'+msg.payload.event.user+':'+msg.payload.event.pin+':'+msg.payload.event.saved+':'+msg.payload.event.checkedin,\n    'start': {\n        'dateTime': msg.payload.param.check.timeMin,\n        'timeZone': timezone,\n    },\n    'end': {\n        'dateTime': msg.payload.param.check.timeMax,\n        'timeZone': 'Asia/Tokyo',\n    },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n    'organizer': {'email': master},\n    'attendees': [\n        //{'email': master},\n        {'email': msg.payload.param.calendarId, 'resource': true}\n        ],\n    'reminders': {},\n};\nvar apiOptions = {\n    auth: auth,\n    calendarId: master,\n    eventId: msg.payload.eventId,\n    resource: event\n};\nconsole.log('apiOptions:'+apiOptions);\ncalendar.events.update(\n    apiOptions,\n    (err, event) => {\n        if (err) {\n            msg.payload.err = err;\n            console.log('There was an error contacting the Calendar service: ' + err);\n        } else {\n            console.log('Event created: %s', event.data.htmlLink);\n            msg.payload.id=event.data.id;\n        }\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 570,
        "y": 1200,
        "wires": [
            [
                "d6d090ed.261e1"
            ]
        ]
    },
    {
        "id": "12a35fb3.fbf85",
        "type": "change",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.orgReq",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "765652e5.a6800c",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "busy",
        "func": "var result={\n    status: \"busy\"\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 770,
        "y": 1080,
        "wires": [
            [
                "509a1690.7ff7d8"
            ]
        ]
    },
    {
        "id": "85689fc3.b5d94",
        "type": "switch",
        "z": "9f3a28b9.aa8348",
        "name": "pinCheck",
        "property": "payload.targetPin",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "req.body.pin",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 880,
        "wires": [
            [
                "6f3e7b60.fb2344"
            ],
            [
                "781d028f.fac43c"
            ]
        ]
    },
    {
        "id": "a7470aa9.4c3558",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "brew PIN",
        "func": "var targetPin = msg.orgEvent.description.split(':')[2];\nmsg.payload.targetPin = targetPin;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 880,
        "wires": [
            [
                "85689fc3.b5d94"
            ]
        ]
    },
    {
        "id": "784c2eb5.4f099",
        "type": "link out",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "c1b9fdb1.fd6ca"
        ],
        "x": 875,
        "y": 860,
        "wires": []
    },
    {
        "id": "6f3e7b60.fb2344",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "bad pin",
        "func": "msg.payload = {\n    \"result\": {\"status\":'bad pin'}\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 780,
        "y": 860,
        "wires": [
            [
                "784c2eb5.4f099"
            ]
        ]
    },
    {
        "id": "509a1690.7ff7d8",
        "type": "link out",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "c1b9fdb1.fd6ca"
        ],
        "x": 875,
        "y": 1080,
        "wires": []
    },
    {
        "id": "781d028f.fac43c",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "param",
        "func": "var timeMin = msg.req.body.date+'T'+msg.req.body.start+':00+09:00';\nvar timeMax = msg.req.body.date+'T'+msg.req.body.end+':00+09:00';\n\nmsg.payload={\n    param: {\n        calendarId: msg.req.params.resourceid,\n        timeMin: timeMin,\n        timeMax: timeMax,\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 330,
        "y": 980,
        "wires": [
            [
                "a5e40f1b.203a7"
            ]
        ]
    },
    {
        "id": "a5e40f1b.203a7",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "calendar.events.list",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        calendarId: msg.payload.param.calendarId,\n        timeMin: msg.payload.param.timeMin,\n        timeMax: msg.payload.param.timeMax,\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = {\"events\":eventList};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 500,
        "y": 980,
        "wires": [
            [
                "737acd5d.93e164"
            ]
        ]
    },
    {
        "id": "737acd5d.93e164",
        "type": "change",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.events",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 980,
        "wires": [
            [
                "ad4814f8.0033a8"
            ]
        ]
    },
    {
        "id": "ad4814f8.0033a8",
        "type": "switch",
        "z": "9f3a28b9.aa8348",
        "name": "# of events",
        "property": "payload.length",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 350,
        "y": 1040,
        "wires": [
            [
                "d1314fab.827f6"
            ],
            [
                "f18926d6.067358"
            ],
            [
                "765652e5.a6800c"
            ]
        ]
    },
    {
        "id": "363a81d0.da340e",
        "type": "comment",
        "z": "9f3a28b9.aa8348",
        "name": "destination vacancy check",
        "info": "",
        "x": 340,
        "y": 940,
        "wires": []
    },
    {
        "id": "f18926d6.067358",
        "type": "switch",
        "z": "9f3a28b9.aa8348",
        "name": "self?",
        "property": "payload[0].id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "req.params.eventid",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 530,
        "y": 1040,
        "wires": [
            [
                "d1314fab.827f6"
            ],
            [
                "765652e5.a6800c"
            ]
        ]
    },
    {
        "id": "5127912d.d784",
        "type": "comment",
        "z": "9f3a28b9.aa8348",
        "name": "update event",
        "info": "",
        "x": 410,
        "y": 1160,
        "wires": []
    },
    {
        "id": "d6d090ed.261e1",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "ok",
        "func": "var result={\n    status: \"ok\",\n    id: msg.req.params.eventid\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 770,
        "y": 1200,
        "wires": [
            [
                "3bdfb179.16072e"
            ]
        ]
    },
    {
        "id": "3bdfb179.16072e",
        "type": "link out",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "links": [
            "350ae040.5d597",
            "d91dcffa.0378",
            "f6ff5517.8c9158"
        ],
        "x": 875,
        "y": 1200,
        "wires": []
    },
    {
        "id": "da1b226e.4ecfc",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "set CommandLog(Modify)",
        "func": "msg.cLog.requestType = \"Modify\";\nmsg.cLog.resourceId = msg.req.params.resourceid;\nmsg.cLog.eventId = msg.req.params.eventid;\nmsg.cLog.pin = msg.req.body.pin;\nmsg.cLog.before.subject = msg.orgEvent.summary;\nmsg.cLog.before.description = msg.orgEvent.description;\nmsg.cLog.before.start = msg.orgEvent.start.dateTime;\nmsg.cLog.before.end = msg.orgEvent.end.dateTime;\n\nvar timeMin = msg.req.body.date+'T'+msg.req.body.start+':00+09:00';\nvar timeMax = msg.req.body.date+'T'+msg.req.body.end+':00+09:00';\nvar orgStats = msg.orgEvent.description.split(':');\nvar orgStatus = orgStats[0];\nvar orgSaved = orgStats[3];\nvar orgCheckedin = orgStats[4] || '-1';\nmsg.cLog.request.subject = msg.req.body.subject;\nmsg.cLog.request.description = orgStatus+':'+msg.req.body.user+':'+msg.req.body.newPin+':'+orgSaved+':'+orgCheckedin,\nmsg.cLog.request.start = timeMin;\nmsg.cLog.request.end = timeMax;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 820,
        "y": 780,
        "wires": [
            [
                "a7470aa9.4c3558"
            ]
        ]
    },
    {
        "id": "75817129.15a46",
        "type": "subflow:b43956c5.b0eb58",
        "z": "9f3a28b9.aa8348",
        "x": 580,
        "y": 780,
        "wires": [
            [
                "da1b226e.4ecfc"
            ]
        ]
    },
    {
        "id": "e2a7289a.97b0e8",
        "type": "http in",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "url": "/resources/:resourceid/events/:eventid",
        "method": "patch",
        "upload": false,
        "swaggerDoc": "",
        "x": 220,
        "y": 1440,
        "wires": [
            [
                "4f461d95.a29374"
            ]
        ]
    },
    {
        "id": "4b414fb9.8379f",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 490,
        "y": 1400,
        "wires": []
    },
    {
        "id": "aec1b47.0964e48",
        "type": "change",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 1400,
        "wires": [
            [
                "4b414fb9.8379f",
                "4f461d95.a29374"
            ]
        ]
    },
    {
        "id": "29a5c8d0.e7d428",
        "type": "inject",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"resourceid\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\",\"eventid\":\"uvgn061ebva54f5fqtjhiliid0\"},\"query\":{\"operation\":\"checkin\"},\"body\":{\"pin\":\"9999\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 1320,
        "wires": [
            [
                "aec1b47.0964e48"
            ]
        ]
    },
    {
        "id": "9c77617e.e0cf2",
        "type": "comment",
        "z": "9f3a28b9.aa8348",
        "name": "CheckIn/CheckOut/AutoCancel",
        "info": "?operation=checkin/checkout/autocancel\n",
        "x": 170,
        "y": 1280,
        "wires": []
    },
    {
        "id": "cd2698f2.1bb088",
        "type": "switch",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "property": "req.query.operation",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "checkin",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "checkout",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "autocancel",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 210,
        "y": 1560,
        "wires": [
            [
                "d726f5cd.18b3d8"
            ],
            [
                "d726f5cd.18b3d8"
            ],
            [
                "d726f5cd.18b3d8"
            ],
            [
                "b94acfd0.7cf2b"
            ]
        ]
    },
    {
        "id": "b94acfd0.7cf2b",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "bad parameter",
        "func": "msg.payload = {\n    \"result\": {\"status\":'bad parameter'}\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 360,
        "y": 1860,
        "wires": [
            [
                "9e6e4dfc.a1ba9"
            ]
        ]
    },
    {
        "id": "881bcff9.6729b",
        "type": "subflow:3bd1c83b.24e548",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "x": 620,
        "y": 1540,
        "wires": [
            [
                "f3db6359.d9122"
            ]
        ]
    },
    {
        "id": "d726f5cd.18b3d8",
        "type": "change",
        "z": "9f3a28b9.aa8348",
        "name": "timestamp",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 1540,
        "wires": [
            [
                "881bcff9.6729b"
            ]
        ]
    },
    {
        "id": "f3db6359.d9122",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "get event and status",
        "func": "var status = -1;\nvar event;\nif (msg.payload.currentStatus &&\n    msg.payload.currentStatus.resources){\n    for (var resource of msg.payload.currentStatus.resources){\n        console.log('resource>>>');\n        console.dir(resource);\n        if(msg.req.params.resourceid === resource.resourceId){\n            console.log('resource:match, eventId:'+resource.event.eventId);\n            if(msg.req.params.eventid === resource.event.eventId)\n            status = resource.status;\n            event = resource.event;\n            break;\n        }\n    }\n}\nmsg.payload={\n    \"status\": status,\n    \"event\": event\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 460,
        "y": 1580,
        "wires": [
            [
                "7b6befa9.787b7",
                "58757f13.621a1"
            ]
        ]
    },
    {
        "id": "4c0386d2.b00078",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 830,
        "y": 1680,
        "wires": []
    },
    {
        "id": "64e5e3b7.15cd9c",
        "type": "switch",
        "z": "9f3a28b9.aa8348",
        "name": "statusCheck",
        "property": "payload.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gte",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 390,
        "y": 1780,
        "wires": [
            [
                "a1b8819c.efee8"
            ],
            [
                "c65555dd.9ff448"
            ]
        ]
    },
    {
        "id": "c65555dd.9ff448",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "no current event found",
        "func": "msg.payload = {\n    \"result\": {\"status\":'no current event found'}\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 610,
        "y": 1800,
        "wires": [
            [
                "a695a267.3952a"
            ]
        ]
    },
    {
        "id": "a9a53016.8208f",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "newStatus",
        "func": "var cFunc=global.get('cFunc');\n\nvar targetStatus;\nvar newEventStatus;\nvar newEndTime;\nvar savedTime = 0;\nvar orgStats = msg.payload.event.detail.description.split(':');\nvar checkedinTime = -1;\nif(orgStats[4]){\n    checkedinTime = parseInt(orgStats[4], 10);    \n}\n\nvar now = msg.payload.now;\nswitch(msg.req.query.operation){\n    case 'checkin':\n        targetStatus = 1; //未CheckIn\n        newEventStatus = 1; //CheckedIn\n        // チェックイン時間の計算\n        checkedinTime = cFunc.getSavedTime(\n            now,\n            cFunc.getTimeFromTimeString(msg.payload.event.detail.start.dateTime)\n            );\n    break;\n    case 'checkout':\n        targetStatus = 2; //CheckIn\n        newEventStatus = 2; //CheckedOut\n        newEndTime = cFunc.getTimeString(now);\n        // 節約時間の計算\n        savedTime = cFunc.getSavedTime(\n            cFunc.getTimeFromTimeString(msg.payload.event.detail.end.dateTime), \n            now);\n    break;\n    case 'autocancel':\n        targetStatus = 1; //未CheckIn\n        newEventStatus = 9; //AutoCanceled\n        newEndTime = cFunc.getTimeString(now);\n        // 節約時間の計算\n        savedTime = cFunc.getSavedTime(\n            cFunc.getTimeFromTimeString(msg.payload.event.detail.end.dateTime), \n            now);\n    break;\n}\nmsg.payload.target = {\n    targetStatus: targetStatus,\n    newEventStatus: newEventStatus,\n    newEndTime: newEndTime,\n    savedTime: savedTime,\n    checkedinTime: checkedinTime\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 710,
        "y": 1640,
        "wires": [
            [
                "4c0386d2.b00078",
                "52c7f84e.bb0628"
            ]
        ]
    },
    {
        "id": "a1b8819c.efee8",
        "type": "switch",
        "z": "9f3a28b9.aa8348",
        "name": "pinCheck",
        "property": "payload.event.pin",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "req.body.pin",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 400,
        "y": 1700,
        "wires": [
            [
                "c8a771de.3398f"
            ],
            [
                "eaaca0e.605476"
            ]
        ]
    },
    {
        "id": "eaaca0e.605476",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "bad pin",
        "func": "msg.payload = {\n    \"result\": {\"status\":'bad pin'}\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 560,
        "y": 1720,
        "wires": [
            [
                "f863ee1.cf7fa1"
            ]
        ]
    },
    {
        "id": "7b6befa9.787b7",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 880,
        "y": 1540,
        "wires": []
    },
    {
        "id": "52c7f84e.bb0628",
        "type": "switch",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "property": "payload.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "payload.target.targetStatus",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 850,
        "y": 1640,
        "wires": [
            [
                "e88f8ee6.e3351"
            ],
            [
                "e595a198.8dafd"
            ]
        ]
    },
    {
        "id": "e595a198.8dafd",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "bad status",
        "func": "msg.payload = {\n    \"result\": {status:'bad status'}\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1040,
        "y": 1840,
        "wires": [
            [
                "9a7c225a.c1c41"
            ]
        ]
    },
    {
        "id": "9a7c225a.c1c41",
        "type": "link out",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "c1b9fdb1.fd6ca"
        ],
        "x": 1145,
        "y": 1840,
        "wires": []
    },
    {
        "id": "f863ee1.cf7fa1",
        "type": "link out",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "c1b9fdb1.fd6ca"
        ],
        "x": 655,
        "y": 1720,
        "wires": []
    },
    {
        "id": "a695a267.3952a",
        "type": "link out",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "c1b9fdb1.fd6ca"
        ],
        "x": 745,
        "y": 1800,
        "wires": []
    },
    {
        "id": "3d7f8329.9b168c",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "calendar.events.update",
        "func": "var calList = [];\nconst calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar timezone = 'Asia/Tokyo';\nvar master ='primary';\n\nvar returned = false;\n\nvar event = {\n    'summary': msg.payload.event.subject,\n    //'location': '',\n    'description': msg.payload.event.status+':'+msg.payload.event.user+':'+msg.payload.event.pin+':'+msg.payload.event.savedTime+':'+msg.payload.event.checkedinTime,\n    'start': {\n        'dateTime': msg.payload.param.check.timeMin,\n        'timeZone': timezone,\n    },\n    'end': {\n        'dateTime': msg.payload.param.check.timeMax,\n        'timeZone': 'Asia/Tokyo',\n    },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n    'organizer': {'email': master},\n    'attendees': [\n        //{'email': master},\n        {'email': msg.payload.param.calendarId, 'resource': true}\n        ],\n    'reminders': {},\n};\nvar apiOptions = {\n    auth: auth,\n    calendarId: master,\n    eventId: msg.payload.param.eventId,\n    resource: event\n};\nconsole.log('>>>>>calendar.events.update<<<<<')\nconsole.dir(apiOptions);\ncalendar.events.update(\n    apiOptions,\n    (err, event) => {\n        if (err) {\n            console.log('There was an error contacting the Calendar service: ' + err);\n        } else {\n            console.log('Event updated: %s', event.data.htmlLink);\n        }\n        msg.payload.id=event.data.id;\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 1110,
        "y": 1700,
        "wires": [
            [
                "93e5bc8c.97d14"
            ]
        ]
    },
    {
        "id": "e88f8ee6.e3351",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "param",
        "func": "var check = {};\nvar calendarId = msg.req.params.resourceid;\nvar eventId = msg.payload.event.eventId;\nvar timeMin = msg.payload.event.detail.start.dateTime;\nvar timeMax = msg.payload.event.detail.end.dateTime;\nif(msg.payload.target.newEndTime){\n    timeMax = msg.payload.target.newEndTime;\n}\nvar param = {\n        'calendarId': calendarId,\n        'eventId': eventId,\n        'check': {\n            'timeMin': timeMin,\n            'timeMax': timeMax,\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    };\n\nmsg.payload.event.status = msg.payload.target.newEventStatus;\nmsg.payload.event.savedTime = msg.payload.target.savedTime;\nmsg.payload.event.checkedinTime = msg.payload.target.checkedinTime;\nmsg.payload.param = param;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 990,
        "y": 1620,
        "wires": [
            [
                "ca44ff3a.6e69a",
                "baf850fa.0b09c"
            ]
        ]
    },
    {
        "id": "93e5bc8c.97d14",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "ok",
        "func": "var result={\n    status: \"ok\",\n    id: msg.payload.id\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1070,
        "y": 1740,
        "wires": [
            [
                "c4bd3f7f.e9a3c",
                "9151f76c.450038"
            ]
        ]
    },
    {
        "id": "c4bd3f7f.e9a3c",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 1250,
        "y": 1780,
        "wires": []
    },
    {
        "id": "ca44ff3a.6e69a",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 1180,
        "y": 1620,
        "wires": []
    },
    {
        "id": "ec1dbdc5.dcd7d",
        "type": "inject",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"resourceid\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\",\"eventid\":\"uvgn061ebva54f5fqtjhiliid0\"},\"query\":{\"operation\":\"checkout\"},\"body\":{\"pin\":\"9999\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 1360,
        "wires": [
            [
                "aec1b47.0964e48"
            ]
        ]
    },
    {
        "id": "c8a771de.3398f",
        "type": "change",
        "z": "9f3a28b9.aa8348",
        "name": "timestamp",
        "rules": [
            {
                "t": "set",
                "p": "payload.now",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 1640,
        "wires": [
            [
                "a9a53016.8208f"
            ]
        ]
    },
    {
        "id": "9151f76c.450038",
        "type": "link out",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "links": [
            "350ae040.5d597",
            "d91dcffa.0378",
            "f6ff5517.8c9158"
        ],
        "x": 1215,
        "y": 1740,
        "wires": []
    },
    {
        "id": "aa36c7e7.d6a448",
        "type": "link in",
        "z": "9f3a28b9.aa8348",
        "name": "CheckIn/CheckOut/AutoCancel",
        "links": [
            "3ea46a3a.b9ad36"
        ],
        "x": 55,
        "y": 1400,
        "wires": [
            [
                "aec1b47.0964e48"
            ]
        ]
    },
    {
        "id": "2f087429.afa9fc",
        "type": "link out",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "c1b9fdb1.fd6ca"
        ],
        "x": 715,
        "y": 1860,
        "wires": []
    },
    {
        "id": "4f461d95.a29374",
        "type": "subflow:b43956c5.b0eb58",
        "z": "9f3a28b9.aa8348",
        "x": 540,
        "y": 1440,
        "wires": [
            [
                "cd2698f2.1bb088"
            ]
        ]
    },
    {
        "id": "9e6e4dfc.a1ba9",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "set CommandLog(patch)",
        "func": "msg.cLog.requestType = \"patch\";\nmsg.cLog.resourceId = msg.req.params.resourceid;\nmsg.cLog.eventId = msg.payload.event.eventId;\n\nmsg.cLog.pin = msg.req.body.pin;\n//msg.cLog.before.subject = msg.orgEvent.summary;\n//msg.cLog.before.description = msg.orgEvent.description;\n//msg.cLog.before.start = msg.orgEvent.start.dateTime;\n//msg.cLog.before.end = msg.orgEvent.end.dateTime;\n\n//var calendarId = msg.req.params.id;\n//var timeMin = msg.payload.date+'T'+msg.payload.start+':00+09:00';\n//var timeMax = msg.payload.date+'T'+msg.payload.end+':00+09:00';\n//msg.cLog.request.subject = msg.req.body.subject;\n//msg.cLog.request.description = '0:'+msg.req.body.user+':'+msg.req.body.pin+':0',\n//msg.cLog.request.start = timeMin;\n//msg.cLog.request.end = timeMax;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 570,
        "y": 1860,
        "wires": [
            [
                "2f087429.afa9fc"
            ]
        ]
    },
    {
        "id": "58757f13.621a1",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "set CommandLog(CheckIn/CheckOut/AutoCancel)",
        "func": "msg.cLog.requestType = msg.req.query.operation;\nmsg.cLog.resourceId = msg.req.params.resourceid;\nmsg.cLog.eventId = msg.payload.event.eventId;\nmsg.cLog.pin = msg.req.body.pin;\n\nif(msg.payload.event.detail.summary){\n    msg.cLog.before.subject = msg.payload.event.detail.summary;\n    msg.cLog.before.description = msg.payload.event.detail.description;\n    msg.cLog.before.start = msg.payload.event.detail.start.dateTime;\n    msg.cLog.before.end = msg.payload.event.detail.end.dateTime;\n}\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 780,
        "y": 1580,
        "wires": [
            [
                "64e5e3b7.15cd9c"
            ]
        ]
    },
    {
        "id": "baf850fa.0b09c",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "set CommandLog(CheckIn/CheckOut/AutoCancel)2",
        "func": "\nvar timeMin = msg.payload.event.detail.start.dateTime;\nvar timeMax = msg.payload.event.detail.end.dateTime;\nif(msg.payload.target.newEndTime){\n    timeMax = msg.payload.target.newEndTime;\n}\n//msg.cLog.request.subject = msg.req.body.subject;\nmsg.cLog.request.description = msg.payload.target.newEventStatus+':'+msg.payload.event.user+':'+msg.payload.event.pin+':'+msg.payload.target.savedTime+':'+msg.payload.event.checkedinTime;\nmsg.cLog.request.start = timeMin;\nmsg.cLog.request.end = timeMax;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1190,
        "y": 1660,
        "wires": [
            [
                "3d7f8329.9b168c"
            ]
        ]
    },
    {
        "id": "a39e3282.8339d",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 400,
        "y": 2060,
        "wires": []
    },
    {
        "id": "c1b9fdb1.fd6ca",
        "type": "link in",
        "z": "9f3a28b9.aa8348",
        "name": "out w/logout",
        "links": [
            "1d0c40.ab6223c",
            "6b12229d.33d81c",
            "7427da23.5b53b4",
            "7c6fb6c4.dbb518",
            "ac5455ae.6eaf78",
            "ed3bf30c.4f206",
            "efcfca3d.22bf88",
            "f7e33d4.fa2f1c",
            "2480b234.3bcf4e",
            "66979f6a.1b196",
            "784c2eb5.4f099",
            "509a1690.7ff7d8",
            "9a7c225a.c1c41",
            "f863ee1.cf7fa1",
            "a695a267.3952a",
            "2f087429.afa9fc",
            "326fbd11.eb2c12"
        ],
        "x": 195,
        "y": 2100,
        "wires": [
            [
                "a39e3282.8339d",
                "184b7af5.c0be45",
                "31353dd2.5e7792"
            ]
        ]
    },
    {
        "id": "184b7af5.c0be45",
        "type": "http response",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 370,
        "y": 2100,
        "wires": []
    },
    {
        "id": "31353dd2.5e7792",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "set commandLog(Result)",
        "func": "msg.cLog.result = msg.payload.result.status;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 2140,
        "wires": [
            [
                "be940330.160d7",
                "e288e041.26724"
            ]
        ]
    },
    {
        "id": "be940330.160d7",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 640,
        "y": 2100,
        "wires": []
    },
    {
        "id": "7c98ffe6.f674c",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 780,
        "y": 2140,
        "wires": []
    },
    {
        "id": "e288e041.26724",
        "type": "subflow:911a8268.a68b6",
        "z": "9f3a28b9.aa8348",
        "x": 650,
        "y": 2140,
        "wires": [
            [
                "7c98ffe6.f674c"
            ]
        ]
    },
    {
        "id": "94b39215.b2d17",
        "type": "comment",
        "z": "9f3a28b9.aa8348",
        "name": "返答、ログ出力",
        "info": "",
        "x": 260,
        "y": 2040,
        "wires": []
    },
    {
        "id": "f051df0c.e4dae",
        "type": "delay",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 140,
        "y": 1960,
        "wires": [
            [
                "d80f057a.02e548"
            ]
        ]
    },
    {
        "id": "d80f057a.02e548",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "param",
        "func": "msg.payload={\n    //param:{\n    //    resourceId: msg.req.params.id,\n    //    date: date,\n    //},\n    param: {\n        calendarId: msg.req.params.resourceid,\n        eventId: msg.req.params.eventid\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 270,
        "y": 1960,
        "wires": [
            [
                "8204b54.5c3c848"
            ]
        ]
    },
    {
        "id": "8204b54.5c3c848",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "calendar.events.get",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\nconsole.log('calling calendar.events.get###')\nconsole.log('calendarId:'+msg.payload.param.calendarId);\nconsole.log('eventId:'+msg.payload.param.eventId);\n\n    calendar.events.get({\n        calendarId: msg.payload.param.calendarId,\n        eventId: msg.payload.param.eventId\n    }, (err, res) => {\n        if (err){\n            console.log('The API returned an error: ' + err);\n            msg.payload = {};\n            console.log('node.send();');\n            node.send(msg);\n            return;\n        }\n        console.log('res.data>>>');\n        console.dir(res.data);\n        const event = res.data;\n        if (event) {\n            console.log('target event:');\n            const start = event.start.dateTime || event.start.date;\n            console.log(`${start} - ${event.summary}`);\n            console.log(event);\n        } else {\n            console.log('No event found.');\n        }\n        msg.payload = {\"event\":event};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 1960,
        "wires": [
            [
                "f17a63eb.0040b",
                "7890c42f.5c903c"
            ]
        ]
    },
    {
        "id": "f17a63eb.0040b",
        "type": "change",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.event.attendees",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 1960,
        "wires": [
            [
                "3c30218b.98bb1e",
                "b402111d.3f0cf"
            ]
        ]
    },
    {
        "id": "3c30218b.98bb1e",
        "type": "switch",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "property": "payload[0].responseStatus",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "accepted",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "declined",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 250,
        "y": 2040,
        "wires": [
            [
                "e05b3a5a.41e1e8"
            ],
            [
                "2d112cd1.a064a4"
            ],
            [
                "f051df0c.e4dae"
            ]
        ]
    },
    {
        "id": "e05b3a5a.41e1e8",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "ok",
        "func": "var result={\n    status: \"ok\",\n    id: msg.req.params.eventid\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 370,
        "y": 2020,
        "wires": [
            [
                "a52c8ef2.eac9c"
            ]
        ]
    },
    {
        "id": "a52c8ef2.eac9c",
        "type": "link out",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "links": [
            "350ae040.5d597",
            "d91dcffa.0378",
            "f6ff5517.8c9158"
        ],
        "x": 455,
        "y": 2020,
        "wires": []
    },
    {
        "id": "2d112cd1.a064a4",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "param",
        "func": "var calendarId = msg.req.params.resourceid;\nvar eventId = msg.req.params.eventid;\nvar timeMin = msg.orgEvent.start.dateTime;\nvar timeMax = msg.orgEvent.end.dateTime;\nvar dsk = msg.orgEvent.description.split(':');\n\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'eventId': eventId,\n        'check': {\n            'timeMin': timeMin,\n            'timeMax': timeMax,\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    },\n    'event': {\n        \"subject\": msg.orgEvent.summary,\n        \"description\": msg.orgEvent.description,\n        \"status\": dsk[0],\n        \"user\": dsk[1],\n        \"pin\": dsk[2],\n        \"saved\": dsk[3]\n    },\n    'eventId': eventId,\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 370,
        "y": 2060,
        "wires": [
            [
                "42eb4f96.6a67f"
            ]
        ]
    },
    {
        "id": "42eb4f96.6a67f",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "calendar.events.update",
        "func": "var calList = [];\nconst calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar timezone = 'Asia/Tokyo';\nvar master ='master@kaigishitsu.work';\n\nvar returned = false;\n\nvar event = {\n    'summary': msg.payload.event.subject,\n    //'location': '',\n    'description': msg.payload.event.status+':'+msg.payload.event.user+':'+msg.payload.event.pin+':'+msg.payload.event.saved,\n    'start': {\n        'dateTime': msg.payload.param.check.timeMin,\n        'timeZone': timezone,\n    },\n    'end': {\n        'dateTime': msg.payload.param.check.timeMax,\n        'timeZone': 'Asia/Tokyo',\n    },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n    'organizer': {'email': master},\n    'attendees': [\n        //{'email': master},\n        {'email': msg.payload.param.calendarId, 'resource': true}\n        ],\n    'reminders': {},\n};\nvar apiOptions = {\n    auth: auth,\n    calendarId: master,\n    eventId: msg.payload.eventId,\n    resource: event\n};\nconsole.log('apiOptions:'+apiOptions);\ncalendar.events.update(\n    apiOptions,\n    (err, event) => {\n        if (err) {\n            msg.payload.err = err;\n            console.log('There was an error contacting the Calendar service: ' + err);\n        } else {\n            console.log('Event created: %s', event.data.htmlLink);\n            msg.payload.id=event.data.id;\n        }\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 550,
        "y": 2060,
        "wires": [
            []
        ]
    },
    {
        "id": "7890c42f.5c903c",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 610,
        "y": 1920,
        "wires": []
    },
    {
        "id": "b402111d.3f0cf",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 870,
        "y": 1980,
        "wires": []
    },
    {
        "id": "38a2f3e9.27de7c",
        "type": "comment",
        "z": "f3d7869e.91c5f8",
        "name": "check if the change is accepted",
        "info": "",
        "x": 200,
        "y": 1920,
        "wires": []
    },
    {
        "id": "27431758.a024d8",
        "type": "change",
        "z": "9f3a28b9.aa8348",
        "name": "timestamp",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 2320,
        "wires": [
            [
                "b8142b50.336be8"
            ]
        ]
    },
    {
        "id": "b8142b50.336be8",
        "type": "subflow:3bd1c83b.24e548",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "x": 820,
        "y": 2320,
        "wires": [
            [
                "ad462264.755dd",
                "4c1e78a3.f40448"
            ]
        ]
    },
    {
        "id": "ad462264.755dd",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "現在状況after登録/更新",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 1030,
        "y": 2260,
        "wires": []
    },
    {
        "id": "2c9ebc74.6ce0f4",
        "type": "delay",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "pauseType": "delay",
        "timeout": "4",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 500,
        "y": 2320,
        "wires": [
            [
                "27431758.a024d8"
            ]
        ]
    },
    {
        "id": "3120db62.beea44",
        "type": "change",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 330,
        "y": 2320,
        "wires": [
            [
                "2c9ebc74.6ce0f4"
            ]
        ]
    },
    {
        "id": "4c1e78a3.f40448",
        "type": "change",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "response",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1020,
        "y": 2320,
        "wires": [
            [
                "326fbd11.eb2c12"
            ]
        ]
    },
    {
        "id": "f6ff5517.8c9158",
        "type": "link in",
        "z": "9f3a28b9.aa8348",
        "name": "ちょっと待って状況取得してresponse返す",
        "links": [
            "1ea9e98e.2cd1c6",
            "b2ef4b94.e935b8",
            "4fd015f5.f2a5bc",
            "a3817771.6099f8",
            "204d2f3b.b7a51",
            "a6feb63e.314d58",
            "7a985f9c.c4352",
            "3bdfb179.16072e",
            "9151f76c.450038",
            "a52c8ef2.eac9c"
        ],
        "x": 195,
        "y": 2320,
        "wires": [
            [
                "3120db62.beea44"
            ]
        ]
    },
    {
        "id": "326fbd11.eb2c12",
        "type": "link out",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "c1b9fdb1.fd6ca"
        ],
        "x": 1135,
        "y": 2320,
        "wires": []
    },
    {
        "id": "a46828c2.4cdcd8",
        "type": "comment",
        "z": "9f3a28b9.aa8348",
        "name": "現在状況を取得して返す",
        "info": "",
        "x": 290,
        "y": 2280,
        "wires": []
    },
    {
        "id": "91950a0f.9414d8",
        "type": "catch",
        "z": "9f3a28b9.aa8348",
        "name": "",
        "scope": null,
        "x": 1140,
        "y": 40,
        "wires": [
            [
                "21ebea29.0bb886"
            ]
        ]
    },
    {
        "id": "21ebea29.0bb886",
        "type": "debug",
        "z": "9f3a28b9.aa8348",
        "name": "Exception!!",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 1290,
        "y": 40,
        "wires": []
    },
    {
        "id": "7baac798.2d5438",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "escape for ':'",
        "func": "if(msg.req && msg.req.body && msg.req.body.user){\n    var u = msg.req.body.user.replace(/:/g, '：');\n    msg.req.body.user = u;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 330,
        "y": 740,
        "wires": [
            [
                "e620c20d.a4a37"
            ]
        ]
    },
    {
        "id": "83fa15b3.f23048",
        "type": "function",
        "z": "9f3a28b9.aa8348",
        "name": "escape for ':'",
        "func": "if(msg.req && msg.req.body && msg.req.body.user){\n    var u = msg.req.body.user.replace(/:/g, '：');\n    msg.req.body.user = u;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 550,
        "y": 140,
        "wires": [
            [
                "df48dce9.3f99a"
            ]
        ]
    },
    {
        "id": "5879c42.317c13c",
        "type": "http in",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "url": "/stats",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 80,
        "y": 160,
        "wires": [
            [
                "e8ee4959.4f0f88"
            ]
        ]
    },
    {
        "id": "e8ee4959.4f0f88",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "日付",
        "func": "let now = new Date(),\n    targetYear = now.getFullYear(),\n    targetMonth = now.getMonth() + 1,\n    startDate,\n    endDate;\n\nif(msg.req.query.target){\n    const regex = new RegExp(/^\\d{6}$/),\n        target = '' + msg.req.query.target;\n    if(regex.test(target)){\n        targetYear = parseInt(target.substring(0,4));\n        targetMonth = parseInt(target.substring(4,6));\n    }\n}\n\nstartDate = new Date(targetYear, targetMonth - 1, 1);\nendDate = new Date(startDate.getFullYear(), startDate.getMonth()+1, 1);\n\nmsg.date = {\n    start: startDate,\n    end: endDate,\n    summary: '' + targetYear + ('00' + targetMonth).slice(-2)\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 350,
        "y": 160,
        "wires": [
            [
                "ac045f64.36cd3"
            ]
        ]
    },
    {
        "id": "f51b7030.f08bd",
        "type": "inject",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 200,
        "wires": [
            [
                "e8ee4959.4f0f88"
            ]
        ]
    },
    {
        "id": "ac045f64.36cd3",
        "type": "change",
        "z": "f3d7869e.91c5f8",
        "name": "resources",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "gInfo.resources",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 200,
        "wires": [
            [
                "11e0ce92.edb9f1"
            ]
        ]
    },
    {
        "id": "11e0ce92.edb9f1",
        "type": "split",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 370,
        "y": 240,
        "wires": [
            [
                "836ff27d.930b"
            ]
        ]
    },
    {
        "id": "836ff27d.930b",
        "type": "change",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "partsBkup",
                "pt": "msg",
                "to": "parts",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 240,
        "wires": [
            [
                "e37193a.62a247"
            ]
        ]
    },
    {
        "id": "e37193a.62a247",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "param",
        "func": "const cFunc=global.get('cFunc');\n\n\nconst strStart=cFunc.getTimeString(msg.date.start);\nconst strEnd=cFunc.getTimeString(msg.date.end);\nconst startHour=strStart.substr(0,11)+'00:00:00'+strStart.substr(19,25);\nconst endHour=strEnd.substr(0,11)+'00:00:00'+strEnd.substr(19,25);\nmsg.resource = msg.payload;\nmsg.payload={\n    param: {\n        calendarId: msg.resource.resourceId,\n        timeMin: startHour,\n        timeMax: endHour,\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 390,
        "y": 280,
        "wires": [
            [
                "795525e8.a1badc"
            ]
        ]
    },
    {
        "id": "795525e8.a1badc",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "calendar.events.list",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        calendarId: msg.payload.param.calendarId,\n        timeMin: msg.payload.param.timeMin,\n        timeMax: msg.payload.param.timeMax,\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = {\"events\":eventList};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 450,
        "y": 320,
        "wires": [
            [
                "9f598fe.254967"
            ]
        ]
    },
    {
        "id": "9f598fe.254967",
        "type": "change",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.events",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 320,
        "wires": [
            [
                "7dd0b01b.629a",
                "29af54bb.eadd4c"
            ]
        ]
    },
    {
        "id": "7dd0b01b.629a",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 770,
        "y": 280,
        "wires": []
    },
    {
        "id": "29af54bb.eadd4c",
        "type": "split",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 430,
        "y": 360,
        "wires": [
            [
                "5c9b3212.6d5dcc"
            ]
        ]
    },
    {
        "id": "5c9b3212.6d5dcc",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "出力形式オブジェクトに変換",
        "func": "const dFmt = s => {\n    let d = new Date(s),\n        year, month, date, hours, minutes, seconds;\n\n    d.setHours(d.getHours() + 9);\n    year = '' + d.getFullYear();\n    month = ('0' + (d.getMonth()+1)).slice(-2);\n    date = ('0' + d.getDate()).slice(-2);\n    hours = ('0' + d.getHours()).slice(-2);\n    minutes = ('0' + d.getMinutes()).slice(-2);\n    seconds = ('0' + d.getSeconds()).slice(-2);\n\n    return year + '/' + month + '/' + date + ' ' + hours + ':' + minutes + ':' + seconds;\n};\nlet e = msg.payload,\n    d = e.description.split(':'),\n    aRecord = {\n        resourceId: msg.resource.resourceId,\n        resourceName: msg.resource.name,\n        \n        eventId: e.id,\n        created: dFmt(e.created),\n        description: e.summary,\n        user: d[1],\n        start: dFmt(e.start.dateTime),\n        end: dFmt(e.end.dateTime),\n        status: d[0],\n        checkedIn: d[4],\n        saved: d[3]\n    };\nmsg.payload = aRecord;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 620,
        "y": 380,
        "wires": [
            [
                "d73cc944.39edf8"
            ]
        ]
    },
    {
        "id": "d73cc944.39edf8",
        "type": "join",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 810,
        "y": 400,
        "wires": [
            [
                "cc2f628f.45891"
            ]
        ]
    },
    {
        "id": "cc2f628f.45891",
        "type": "change",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "parts",
                "pt": "msg",
                "to": "partsBkup",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 400,
        "y": 480,
        "wires": [
            [
                "9f8e1f09.9be4d"
            ]
        ]
    },
    {
        "id": "9f8e1f09.9be4d",
        "type": "join",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 550,
        "y": 480,
        "wires": [
            [
                "15f0ee8d.8d8501"
            ]
        ]
    },
    {
        "id": "15f0ee8d.8d8501",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "各リソースのイベントをマージ",
        "func": "let a = [];\nfor(let c of msg.payload) {\n    a = a.concat(c);\n}\nmsg.payload = a;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 500,
        "y": 540,
        "wires": [
            [
                "8364505.89ad2b",
                "77f8fcd5.04ba74"
            ]
        ]
    },
    {
        "id": "8364505.89ad2b",
        "type": "csv",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "sep": ",",
        "hdrin": "",
        "hdrout": true,
        "multi": "one",
        "ret": "\\r\\n",
        "temp": "resourceName, start, end, status, checkedIn, saved, description, user, resourceId, eventId, created",
        "skip": "0",
        "x": 710,
        "y": 540,
        "wires": [
            [
                "eeb17b23.114898",
                "3961a684.6312ea"
            ]
        ]
    },
    {
        "id": "77f8fcd5.04ba74",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 570,
        "y": 580,
        "wires": []
    },
    {
        "id": "eeb17b23.114898",
        "type": "debug",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 850,
        "y": 500,
        "wires": []
    },
    {
        "id": "3961a684.6312ea",
        "type": "function",
        "z": "f3d7869e.91c5f8",
        "name": "set headers",
        "func": "msg.headers = {\n    'Content-disposition': 'attachment; filename=SUGOYOYA_' + msg.date.summary + '.csv',\n    'Content-Type': 'text/csv; charset=UTF-8'\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 810,
        "y": 580,
        "wires": [
            [
                "3da5d915.8819c6"
            ]
        ]
    },
    {
        "id": "3da5d915.8819c6",
        "type": "http response",
        "z": "f3d7869e.91c5f8",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 880,
        "y": 620,
        "wires": []
    },
    {
        "id": "e6d61dc4.3dea5",
        "type": "comment",
        "z": "f3d7869e.91c5f8",
        "name": "統計情報取得",
        "info": "",
        "x": 90,
        "y": 120,
        "wires": []
    }
]