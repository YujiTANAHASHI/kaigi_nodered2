[
    {
        "id": "ea07e4a2.044d48",
        "type": "tab",
        "label": "バッチ",
        "disabled": false,
        "info": ""
    },
    {
        "id": "fb1d09b1.5e4f88",
        "type": "tab",
        "label": "管理API",
        "disabled": false,
        "info": ""
    },
    {
        "id": "4038e9de.d0dd68",
        "type": "tab",
        "label": "オンラインAPI（照会系）",
        "disabled": false,
        "info": ""
    },
    {
        "id": "f07df9cc.834608",
        "type": "tab",
        "label": "オンラインAPI（更新系）",
        "disabled": false,
        "info": ""
    },
    {
        "id": "8bc72c78.d5201",
        "type": "tab",
        "label": "実験段階",
        "disabled": false,
        "info": ""
    },
    {
        "id": "fabbdf33.d3c4",
        "type": "tab",
        "label": "動作検証のページ",
        "disabled": false,
        "info": ""
    },
    {
        "id": "4bf7bdc7.49b4b4",
        "type": "subflow",
        "name": "リソース一覧取得",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 100,
                "y": 60,
                "wires": [
                    {
                        "id": "ce90643a.735f78"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 600,
                "y": 140,
                "wires": [
                    {
                        "id": "6b31e244.5988bc",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "4f14d068.abfcc",
        "type": "subflow",
        "name": "イベント登録",
        "info": "msg.payload={\nevent:\n{\n    \"subject\": \n    \"user\": \n    \"pin\":\n    \"status\":\n    \"saved\":\n}\n'param': {\n    'calendarId': calendarId,\n    'check': {\n        'timeMin': timeMin,\n        'timeMax': timeMax,\n        'timeZone': 'Asia/Tokyo',\n        'items': [{'id': calendarId}],\n    }\n}\n}\n",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 40,
                "wires": [
                    {
                        "id": "2c56a044.614d7"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 440,
                "y": 40,
                "wires": [
                    {
                        "id": "2c56a044.614d7",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "247548cc.9b7088",
        "type": "subflow",
        "name": "現在状況取得",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 140,
                "y": 300,
                "wires": [
                    {
                        "id": "5085be80.00a98"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 700,
                "y": 500,
                "wires": [
                    {
                        "id": "9b61ef74.36ea3",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "90dfcaf6.6b3fd8",
        "type": "subflow",
        "name": "認証とカレンダーオブジェクト取得toGlobal",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 80,
                "wires": [
                    {
                        "id": "957a4bca.c03218"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 620,
                "y": 80,
                "wires": [
                    {
                        "id": "957a4bca.c03218",
                        "port": 0
                    },
                    {
                        "id": "31e5366c.526d8a",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "ba669923.5b3848",
        "type": "subflow",
        "name": "create commandLog",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 60,
                "wires": [
                    {
                        "id": "77aec57c.ed44dc"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 420,
                "y": 60,
                "wires": [
                    {
                        "id": "77aec57c.ed44dc",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "c58a19c0.ad3338",
        "type": "subflow",
        "name": "write log",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 100,
                "y": 60,
                "wires": [
                    {
                        "id": "83e0f421.1d8698"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 380,
                "y": 60,
                "wires": [
                    {
                        "id": "83e0f421.1d8698",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "d780e0b4.8e7b8",
        "type": "change",
        "z": "4bf7bdc7.49b4b4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.cals",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 60,
        "wires": [
            [
                "1abf0008.44516"
            ]
        ]
    },
    {
        "id": "ce90643a.735f78",
        "type": "function",
        "z": "4bf7bdc7.49b4b4",
        "name": "calendar.calendarList.list",
        "func": "var calList = [];\n  const calendar = global.get('calendar');\n\n  calendar.calendarList.list({}, (err, res) => {\n      console.log('calendarlist.list:'+err);\n      const calendarlist = res.data.items;\n      if(calendarlist.length){\n          calendarlist.map((cal, i) => {\n              console.log('calendarlist:'+cal.description)\n              if(cal.description && cal.description.lastIndexOf('Geek:',0) === 0){\n                  calList.push(cal);\n              }\n          })\n          msg.payload = {'cals':calList};\n      }\n      node.send(msg);\n  })\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 290,
        "y": 60,
        "wires": [
            [
                "d780e0b4.8e7b8"
            ]
        ]
    },
    {
        "id": "1abf0008.44516",
        "type": "split",
        "z": "4bf7bdc7.49b4b4",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": "1",
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 110,
        "y": 100,
        "wires": [
            [
                "a437dae0.8d71b8"
            ]
        ]
    },
    {
        "id": "a437dae0.8d71b8",
        "type": "function",
        "z": "4bf7bdc7.49b4b4",
        "name": "出力形式に変換する",
        "func": "var dsk = msg.payload.description.split(':');\nvar outObj = {\n    resourceId: msg.payload.id,\n//    name: msg.payload.summary,\n    name: msg.payload.summaryOverride,\n    capacity: dsk[1],\n    description: dsk[2]\n}\nmsg.payload = outObj;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 280,
        "y": 100,
        "wires": [
            [
                "eee440a0.eaa61"
            ]
        ]
    },
    {
        "id": "eee440a0.eaa61",
        "type": "join",
        "z": "4bf7bdc7.49b4b4",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 450,
        "y": 100,
        "wires": [
            [
                "6b31e244.5988bc"
            ]
        ]
    },
    {
        "id": "6b31e244.5988bc",
        "type": "change",
        "z": "4bf7bdc7.49b4b4",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload.resources",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "f18800e8.ca39f",
        "type": "catch",
        "z": "8bc72c78.d5201",
        "name": "",
        "scope": null,
        "x": 640,
        "y": 80,
        "wires": [
            [
                "ddece08e.ccb1a"
            ]
        ]
    },
    {
        "id": "ddece08e.ccb1a",
        "type": "debug",
        "z": "8bc72c78.d5201",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 800,
        "y": 100,
        "wires": []
    },
    {
        "id": "a8515d08.c3057",
        "type": "http in",
        "z": "8bc72c78.d5201",
        "name": "",
        "url": "/test/resources/:id/events/list",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 940,
        "wires": [
            [
                "b8e146d1.a7e128",
                "69f58922.2f5f58"
            ]
        ]
    },
    {
        "id": "49f9d479.3eac3c",
        "type": "http in",
        "z": "8bc72c78.d5201",
        "name": "",
        "url": "/test/resources/:id/events/list/:date",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 190,
        "y": 980,
        "wires": [
            [
                "b8e146d1.a7e128",
                "69f58922.2f5f58"
            ]
        ]
    },
    {
        "id": "918956e0.b1d548",
        "type": "change",
        "z": "8bc72c78.d5201",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 900,
        "wires": [
            [
                "b8e146d1.a7e128",
                "69f58922.2f5f58"
            ]
        ]
    },
    {
        "id": "41d81934.101748",
        "type": "inject",
        "z": "8bc72c78.d5201",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"id\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\",\"date\":\"2018-11-03\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 900,
        "wires": [
            [
                "918956e0.b1d548"
            ]
        ]
    },
    {
        "id": "b8e146d1.a7e128",
        "type": "debug",
        "z": "8bc72c78.d5201",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 450,
        "y": 900,
        "wires": []
    },
    {
        "id": "69f58922.2f5f58",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "param",
        "func": "var date = msg.req.params.date;\n\n//if(!date) {\n//    date = (new Date()).toISOString();\n//}\n\nmsg.payload = {\n    'param': {\n        calendarId: msg.req.params.id,\n        date: msg.req.params.date\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 290,
        "y": 1020,
        "wires": [
            [
                "4c45053b.56ffac"
            ]
        ]
    },
    {
        "id": "4c45053b.56ffac",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "calendar.events.list",
        "func": "var eventList = [];\nvar calendarId = msg.payload.param.calendarId;\nvar date = msg.payload.param.date;\nvar timezoneoffset = -9     // UTC-表示したいタイムゾーン(単位:hour)。JSTなら-9\nvar fakeDate = new Date(Date.now() - (timezoneoffset * 60 - new Date().getTimezoneOffset()) * 60000);\n\nif(!date){\n    date = fakeDate.toISOString().substr(0, 10);\n}\nconsole.log('date:' +date);\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        calendarId: calendarId,\n        timeMin: date + 'T00:00:00+09:00',\n        timeMax: date + 'T23:59:00+09:00',\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = {\"events\":eventList};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 450,
        "y": 1020,
        "wires": [
            [
                "a03f81d7.3f868"
            ]
        ]
    },
    {
        "id": "7154246.44a3ddc",
        "type": "inject",
        "z": "8bc72c78.d5201",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"id\":\"kaigishitsu.work_3430323338373732393131@resource.calendar.google.com\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 860,
        "wires": [
            [
                "918956e0.b1d548"
            ]
        ]
    },
    {
        "id": "a03f81d7.3f868",
        "type": "change",
        "z": "8bc72c78.d5201",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.events",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 1020,
        "wires": [
            [
                "6418a73e.66d428",
                "44f32465.5c0b4c"
            ]
        ]
    },
    {
        "id": "bda9d435.48de58",
        "type": "split",
        "z": "8bc72c78.d5201",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": "1",
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 270,
        "y": 1060,
        "wires": [
            [
                "a355477d.e2e3a8"
            ]
        ]
    },
    {
        "id": "a355477d.e2e3a8",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "出力形式に変換する",
        "func": "var outObj = {\n    detail: msg.payload,\n    eventId: msg.payload.id,\n    subject: msg.payload.summary,\n    start: msg.payload.start.dateTime.substr(11,5),\n    end: msg.payload.end.dateTime.substr(11,5),\n    resource: {\n        name: msg.payload.organizer.displayName,\n        resourceId: msg.payload.organizer.email\n    }\n}\nmsg.payload = outObj;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 1060,
        "wires": [
            [
                "95b22b17.07bbe8"
            ]
        ]
    },
    {
        "id": "95b22b17.07bbe8",
        "type": "join",
        "z": "8bc72c78.d5201",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 630,
        "y": 1060,
        "wires": [
            [
                "6b0b47ce.c2edc8"
            ]
        ]
    },
    {
        "id": "19afd65f.7792ea",
        "type": "http response",
        "z": "8bc72c78.d5201",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 830,
        "y": 1100,
        "wires": []
    },
    {
        "id": "6b0b47ce.c2edc8",
        "type": "change",
        "z": "8bc72c78.d5201",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload.events",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 1100,
        "wires": [
            [
                "19afd65f.7792ea",
                "a5fd8fb9.ba788"
            ]
        ]
    },
    {
        "id": "91f6ebc7.128f48",
        "type": "comment",
        "z": "8bc72c78.d5201",
        "name": "resource（会議室）別event（予約）一覧取得",
        "info": "",
        "x": 210,
        "y": 820,
        "wires": []
    },
    {
        "id": "6418a73e.66d428",
        "type": "switch",
        "z": "8bc72c78.d5201",
        "name": "",
        "property": "payload.length",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 150,
        "y": 1080,
        "wires": [
            [
                "bda9d435.48de58"
            ],
            [
                "6b0b47ce.c2edc8"
            ]
        ]
    },
    {
        "id": "9a4e12df.a5fb8",
        "type": "debug",
        "z": "8bc72c78.d5201",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 490,
        "y": 1180,
        "wires": []
    },
    {
        "id": "1964e1cf.4af15e",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "calendar.events.insert",
        "func": "var calList = [];\n  const calendar = global.get('calendar');\n  const auth = global.get('auth');\nvar timezone = 'Asia/Tokyo';\n\nvar returned = false;\n\n    var event = {\n      'summary': 'テスト会議',\n      'location': '',\n      'description': '0:UserA:1234',\n      'start': {\n        'dateTime': '2018-11-22T20:15:00+09:00',\n        'timeZone': 'Asia/Tokyo',\n      },\n      'end': {\n        'dateTime': '2018-11-22T20:30:00+09:00',\n        'timeZone': 'Asia/Tokyo',\n      },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n      'attendees': [\n          {'email':'kaigishitsu.work_3835353636383833343637@resource.calendar.google.com'}],\n//      'reminders': {\n//        'useDefault': false,\n//        'overrides': [\n//          {'method': 'email', 'minutes': 24 * 60},\n//          {'method': 'popup', 'minutes': 10},\n//        ],\n//      },\n    };\n    var apiOptions = {\n        auth: auth,\n        calendarId: 'master@kaigishitsu.work',\n        resource: event\n    };\n    console.log('apiOptions:'+apiOptions);\n//    calendar.events.insert(\n//        apiOptions,\n//        (err, event) => {\n//            console.log('*err:'+err);\n//            console.log('*event:'+event);\n//            msg.payload = {err: err, event: event}\n//            if (err) {\n//                console.log('There was an error contacting the Calendar service: ' + err);\n//            } else {\n//                console.log('Event created: %s', event.data.htmlLink);\n//            }\n//            node.send(msg);\n//            console.log('callback end.');\n//        }\n//    );\n\n\n    calendar.events.insert(apiOptions)\n        .then(event => {\n            msg.payload = {event: event};\n            node.send(msg);\n        })\n        .catch(err => {console.log('err:'+err)});\n\n    console.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 300,
        "y": 1180,
        "wires": [
            [
                "9a4e12df.a5fb8",
                "2f4a1ddf.904f72"
            ]
        ]
    },
    {
        "id": "6fc781da.6a9f3",
        "type": "inject",
        "z": "8bc72c78.d5201",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 1180,
        "wires": [
            [
                "1964e1cf.4af15e"
            ]
        ]
    },
    {
        "id": "44f32465.5c0b4c",
        "type": "debug",
        "z": "8bc72c78.d5201",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 850,
        "y": 1020,
        "wires": []
    },
    {
        "id": "84e69560.1f6438",
        "type": "http in",
        "z": "8bc72c78.d5201",
        "name": "",
        "url": "/test/ins",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 1240,
        "wires": [
            [
                "1964e1cf.4af15e"
            ]
        ]
    },
    {
        "id": "2f4a1ddf.904f72",
        "type": "http response",
        "z": "8bc72c78.d5201",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 500,
        "y": 1240,
        "wires": []
    },
    {
        "id": "9f03a069.bff6c",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "calendar.events.list",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        //calendarId: 'primary',\n        calendarId: '1pp3nr9at4s2c5f0brhhbsj7hc@group.calendar.google.com',\n        //timeMin: (new Date()).toISOString(),\n        timeMin: '2018-11-03T00:00:00+09:00',\n        timeMax: '2018-11-03T23:59:00+09:00',\n        //maxResults: 10,\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = {\"events\":eventList};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 290,
        "y": 220,
        "wires": [
            [
                "c9bb36bb.93e818"
            ]
        ]
    },
    {
        "id": "b160d77.b4bb728",
        "type": "inject",
        "z": "fabbdf33.d3c4",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 220,
        "wires": [
            [
                "9f03a069.bff6c"
            ]
        ]
    },
    {
        "id": "c9bb36bb.93e818",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 510,
        "y": 220,
        "wires": []
    },
    {
        "id": "6ec62f59.6825b",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "calendar.calendarList.list",
        "func": "var calList = [];\n  const calendar = global.get('calendar');\n\n  calendar.calendarList.list({}, (err, res) => {\n      console.log('calendarlist.list:'+err);\n      const calendarlist = res.data.items;\n      if(calendarlist.length){\n          calendarlist.map((cal, i) => {\n              console.log('calendarlist:'+cal)\n              calList.push(cal);\n          })\n          msg.payload = {'cals':calList};\n      }\n      node.send(msg);\n  })\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 430,
        "y": 140,
        "wires": [
            [
                "8cfd3a57.73e2e8"
            ]
        ]
    },
    {
        "id": "8cfd3a57.73e2e8",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 630,
        "y": 140,
        "wires": []
    },
    {
        "id": "84b94acd.7fa4a8",
        "type": "inject",
        "z": "fabbdf33.d3c4",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 140,
        "wires": [
            [
                "a8dea35e.20cf5"
            ]
        ]
    },
    {
        "id": "bce82569.9bbbb8",
        "type": "inject",
        "z": "fabbdf33.d3c4",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 260,
        "wires": [
            [
                "42c420f5.e7e28"
            ]
        ]
    },
    {
        "id": "42c420f5.e7e28",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "calendar.events.insert",
        "func": "var calList = [];\n  const calendar = global.get('calendar');\n  const auth = global.get('auth');\n\nvar timezone = 'Asia/Tokyo';\n\n    var event = {\n      'summary': 'テスト会議',\n      'location': 'Tシアン左',\n      'description': '0:UserA:1234',\n      'start': {\n        'dateTime': '2018-11-08T18:15:00+09:00',\n        'timeZone': 'Asia/Tokyo',\n      },\n      'end': {\n        'dateTime': '2018-11-08T18:30:00+09:00',\n        'timeZone': 'Asia/Tokyo',\n      },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n      'attendees': [],\n//      'reminders': {\n//        'useDefault': false,\n//        'overrides': [\n//          {'method': 'email', 'minutes': 24 * 60},\n//          {'method': 'popup', 'minutes': 10},\n//        ],\n//      },\n    };\n    var apiOptions = {\n        auth: auth,\n        calendarId: '1pp3nr9at4s2c5f0brhhbsj7hc@group.calendar.google.com',\n        resource: event\n    };\n    console.log('apiOptions:'+apiOptions);\n    calendar.events.insert(\n        apiOptions,\n        function(err, event) {\n            console.log('err:'+err);\n            console.log('event:'+event);\n            msg.payload['err'] = err;\n            msg.payload['event'] = event;\n            if (err) {\n                console.log('There was an error contacting the Calendar service: ' + err);\n            } else {\n                console.log('Event created: %s', event.htmlLink);\n            }\n            node.send(msg);\n        }\n    );\n    console.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 300,
        "y": 260,
        "wires": [
            [
                "b0971a9d.c628e8"
            ]
        ]
    },
    {
        "id": "b0971a9d.c628e8",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 510,
        "y": 260,
        "wires": []
    },
    {
        "id": "fed44819.0f4298",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "calendar.calendarList.get",
        "func": "var calList = [];\n  const calendar = global.get('calendar');\n\n  calendar.calendarList.get({\n    //calendarId: '1pp3nr9at4s2c5f0brhhbsj7hc@group.calendar.google.com',\n    calendarId: msg.payload.param.calendarId\n  }, (err, res) => {\n      console.log('calendarlist.get err:'+err);\n      console.log('calendarlist.get res:'+res);\n      const cal = res.data;\n//      if(calendarlist.length){\n//          calendarlist.map((cal, i) => {\n//              console.log('calendarlist:'+cal)\n//              calList.push(cal);\n//          })\n//          msg.payload = {'cals':calList};\n//      }\n        msg.payload['cal'] = cal;\n        node.send(msg);\n  })\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 430,
        "y": 180,
        "wires": [
            [
                "f5a67177.d4636"
            ]
        ]
    },
    {
        "id": "f5a67177.d4636",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 630,
        "y": 180,
        "wires": []
    },
    {
        "id": "f39c07f1.e8da28",
        "type": "inject",
        "z": "fabbdf33.d3c4",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 180,
        "wires": [
            [
                "e147b974.2918e8"
            ]
        ]
    },
    {
        "id": "a8dea35e.20cf5",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "param",
        "func": "msg.payload = {\n    'param': {\n        // no params\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 250,
        "y": 140,
        "wires": [
            [
                "6ec62f59.6825b"
            ]
        ]
    },
    {
        "id": "e147b974.2918e8",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "param",
        "func": "msg.payload = {\n    'param': {\n        calendarId: '1pp3nr9at4s2c5f0brhhbsj7hc@group.calendar.google.com',\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 250,
        "y": 180,
        "wires": [
            [
                "fed44819.0f4298"
            ]
        ]
    },
    {
        "id": "4541d81a.6c8ba8",
        "type": "comment",
        "z": "fabbdf33.d3c4",
        "name": "動作検証",
        "info": "",
        "x": 100,
        "y": 100,
        "wires": []
    },
    {
        "id": "2fc08118.5da44e",
        "type": "inject",
        "z": "fabbdf33.d3c4",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 300,
        "wires": [
            [
                "a0707996.41bb28"
            ]
        ]
    },
    {
        "id": "a0707996.41bb28",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "param",
        "func": "var calendarId = 'kaigishitsu.work_3835353636383833343637@resource.calendar.google.com';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'check': {\n            'timeMin': \"2018-11-28T11:42:00+09:00\",\n            'timeMax': \"2018-11-28T11:43:00+09:00\",\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 250,
        "y": 300,
        "wires": [
            [
                "36160b74.1751f4"
            ]
        ]
    },
    {
        "id": "36160b74.1751f4",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "calendar.Freebusy.query",
        "func": "const calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar check = {\n    auth: auth,\n    resource: msg.payload.param.check\n};\n\nconsole.log('calendar.Freebusy.query:'+check)\nvar response = calendar.freebusy.query(check,\n    function(err, response){\n\n        console.log('err: '+ err);\n        console.log('Response: '+ response);\n//        console.log('Response Calendars: '+ response.calendars.calendarId);\n\n//        for (var property in response){\n//            console.log('Property: '+ property);\n//            console.log('Property Value: '+ response[property]);\n//        }\n\n//        for (var calendarValue in response){\n//            console.log('Calendar Value: '+ response.calendars.calendarValue);\n//        }\n        msg.payload = response;\n        node.send(msg);\n    }\n);\n\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 430,
        "y": 300,
        "wires": [
            [
                "2370ef6b.0a3c7"
            ]
        ]
    },
    {
        "id": "2370ef6b.0a3c7",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 630,
        "y": 300,
        "wires": []
    },
    {
        "id": "b269394e.6d4698",
        "type": "catch",
        "z": "fabbdf33.d3c4",
        "name": "",
        "scope": null,
        "x": 640,
        "y": 40,
        "wires": [
            [
                "644dd9eb.4440f8"
            ]
        ]
    },
    {
        "id": "644dd9eb.4440f8",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 800,
        "y": 60,
        "wires": []
    },
    {
        "id": "22430be9.acbd74",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "",
        "func": "const fs = global.get('fs');\nconst readline = global.get('readline');\nconst {google} = global.get('google');\n\nvar eventList = [];\n\n// If modifying these scopes, delete token.json.\nconst SCOPES = ['https://www.googleapis.com/auth/calendar.readonly'];\nconst TOKEN_PATH = 'token.json';\n\n// Load client secrets from a local file.\nfs.readFile('/data/credentials.json', (err, content) => {\n    console.log(']]]readFile start:'+content);\n  if (err) return console.log('Error loading client secret file:', err);\n  // Authorize a client with credentials, then call the Google Calendar API.\n  authorize(JSON.parse(content), listEvents);\n});\n\n/**\n * Create an OAuth2 client with the given credentials, and then execute the\n * given callback function.\n * @param {Object} credentials The authorization client credentials.\n * @param {function} callback The callback to call with the authorized client.\n */\nfunction authorize(credentials, callback) {\n  const {client_secret, client_id, redirect_uris} = credentials.installed;\n  const oAuth2Client = new google.auth.OAuth2(\n      client_id, client_secret, redirect_uris[0]);\n\n    console.log(']]]authorize start:'+credentials);\n  // Check if we have previously stored a token.\n  fs.readFile(TOKEN_PATH, (err, token) => {\n    if (err) return getAccessToken(oAuth2Client, callback);\n    oAuth2Client.setCredentials(JSON.parse(token));\n    callback(oAuth2Client);\n  });\n}\n\n/**\n * Get and store new token after prompting for user authorization, and then\n * execute the given callback with the authorized OAuth2 client.\n * @param {google.auth.OAuth2} oAuth2Client The OAuth2 client to get token for.\n * @param {getEventsCallback} callback The callback for the authorized client.\n */\nfunction getAccessToken(oAuth2Client, callback) {\n  const authUrl = oAuth2Client.generateAuthUrl({\n    access_type: 'offline',\n    scope: SCOPES,\n  });\n  console.log('Authorize this app by visiting this url:', authUrl);\n//  const rl = readline.createInterface({\n//    input: process.stdin,\n//    output: process.stdout,\n//  });\n//  rl.question('Enter the code from that page here: ', (code) => {\n//    rl.close();\n  code='4/hgBo3mDA3IyMA1VGNbHIw0vCzZ0u4vcE42DAN5EnntuTobUbo_L21ek';\n    oAuth2Client.getToken(code, (err, token) => {\n      if (err) return console.error('Error retrieving access token', err);\n      oAuth2Client.setCredentials(token);\n      // Store the token to disk for later program executions\n      fs.writeFile(TOKEN_PATH, JSON.stringify(token), (err) => {\n        if (err) console.error(err);\n        console.log('Token stored to', TOKEN_PATH);\n      });\n      callback(oAuth2Client);\n//    });\n  });\n}\n\n/**\n * Lists the next 10 events on the user's primary calendar.\n * @param {google.auth.OAuth2} auth An authorized OAuth2 client.\n */\nfunction listEvents(auth) {\n  const calendar = google.calendar({version: 'v3', auth});\n  calendar.events.list({\n    calendarId: 'primary',\n//    calendarId: 'roomA',\n    timeMin: (new Date()).toISOString(),\n    maxResults: 10,\n    singleEvents: true,\n    orderBy: 'startTime',\n  }, (err, res) => {\n    if (err) return console.log('The API returned an error: ' + err);\n    const events = res.data.items;\n    if (events.length) {\n      console.log('Upcoming 10 events:');\n      events.map((event, i) => {\n        const start = event.start.dateTime || event.start.date;\n        console.log(`${start} - ${event.summary}`);\n        console.log(event);\n        eventList.push(event);\n      });\n    } else {\n      console.log('No upcoming events found.');\n    }\n    msg.payload = {\"events\":eventList};\n    console.log('node.send();');\n    node.send(msg);\n  });\n}\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 250,
        "y": 420,
        "wires": [
            [
                "7d467852.dd0068"
            ]
        ]
    },
    {
        "id": "5b4c143b.2a7e4c",
        "type": "inject",
        "z": "fabbdf33.d3c4",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 420,
        "wires": [
            [
                "22430be9.acbd74"
            ]
        ]
    },
    {
        "id": "7d467852.dd0068",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 370,
        "y": 420,
        "wires": []
    },
    {
        "id": "a097e672.6a4dd8",
        "type": "inject",
        "z": "8bc72c78.d5201",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"id\":\"1pp3nr9at4s2c5f0brhhbsj7hc@group.calendar.google.com\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 680,
        "wires": [
            [
                "13af259d.e9fbca"
            ]
        ]
    },
    {
        "id": "13af259d.e9fbca",
        "type": "change",
        "z": "8bc72c78.d5201",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 680,
        "wires": [
            [
                "d6ddc4cb.f3dfa8",
                "fcea4673.34a108"
            ]
        ]
    },
    {
        "id": "d6ddc4cb.f3dfa8",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "param",
        "func": "msg.payload = {\n    'param': {\n        calendarId: msg.req.params.id,\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 290,
        "y": 720,
        "wires": [
            [
                "d1c30d4b.cee19"
            ]
        ]
    },
    {
        "id": "fcea4673.34a108",
        "type": "debug",
        "z": "8bc72c78.d5201",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 450,
        "y": 680,
        "wires": []
    },
    {
        "id": "88f92346.14709",
        "type": "http in",
        "z": "8bc72c78.d5201",
        "name": "",
        "url": "/test/resources/:id",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 720,
        "wires": [
            [
                "d6ddc4cb.f3dfa8",
                "fcea4673.34a108"
            ]
        ]
    },
    {
        "id": "d1c30d4b.cee19",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "calendar.calendarList.get",
        "func": "var calList = [];\n  const calendar = global.get('calendar');\n\n  calendar.calendarList.get({\n    //calendarId: '1pp3nr9at4s2c5f0brhhbsj7hc@group.calendar.google.com',\n    calendarId: msg.payload.param.calendarId\n  }, (err, res) => {\n      console.log('calendarlist.get err:'+err);\n      console.log('calendarlist.get res:'+res);\n      const cal = res.data;\n//      if(calendarlist.length){\n//          calendarlist.map((cal, i) => {\n//              console.log('calendarlist:'+cal)\n//              calList.push(cal);\n//          })\n//          msg.payload = {'cals':calList};\n//      }\n        msg.payload['cal'] = cal;\n        node.send(msg);\n  })\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 470,
        "y": 720,
        "wires": [
            [
                "7028ec52.b5b4f4"
            ]
        ]
    },
    {
        "id": "7028ec52.b5b4f4",
        "type": "change",
        "z": "8bc72c78.d5201",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.cal",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 720,
        "wires": [
            [
                "c7ef6ccc.41cb"
            ]
        ]
    },
    {
        "id": "c7ef6ccc.41cb",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "出力形式に変換する",
        "func": "var dsk = msg.payload.description.split(':');\nvar outObj = {\n    resourceId: msg.payload.id,\n    name: msg.payload.summary,\n    capacity: dsk[1],\n    description: dsk[2]\n}\nmsg.payload = outObj;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 460,
        "y": 760,
        "wires": [
            [
                "bec2d612.4b57d8"
            ]
        ]
    },
    {
        "id": "bec2d612.4b57d8",
        "type": "change",
        "z": "8bc72c78.d5201",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload.resource",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 610,
        "y": 800,
        "wires": [
            [
                "f486d51b.622018",
                "cc0d670c.c674c8"
            ]
        ]
    },
    {
        "id": "f486d51b.622018",
        "type": "debug",
        "z": "8bc72c78.d5201",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 850,
        "y": 760,
        "wires": []
    },
    {
        "id": "cc0d670c.c674c8",
        "type": "http response",
        "z": "8bc72c78.d5201",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 830,
        "y": 800,
        "wires": []
    },
    {
        "id": "69ae08a2.e19f78",
        "type": "comment",
        "z": "8bc72c78.d5201",
        "name": "resource（会議室）取得",
        "info": "",
        "x": 150,
        "y": 640,
        "wires": []
    },
    {
        "id": "d45dc2e4.29a14",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "calendar.events.list",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        //calendarId: 'primary',\n        calendarId: 'kaigishitsu.work_3835353636383833343637@resource.calendar.google.com',\n        //timeMin: (new Date()).toISOString(),\n        timeMin: '2018-11-28T11:48:00+09:00',\n        timeMax: '2018-11-28T11:49:00+09:00',\n        //maxResults: 10,\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = {\"events\":eventList};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 290,
        "y": 340,
        "wires": [
            [
                "dacc16ce.a43868"
            ]
        ]
    },
    {
        "id": "dacc16ce.a43868",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 510,
        "y": 340,
        "wires": []
    },
    {
        "id": "527238ba.756598",
        "type": "inject",
        "z": "fabbdf33.d3c4",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 340,
        "wires": [
            [
                "d45dc2e4.29a14"
            ]
        ]
    },
    {
        "id": "4b874b87.26bc24",
        "type": "inject",
        "z": "fabbdf33.d3c4",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 500,
        "wires": [
            [
                "bd5b8cd4.242cc"
            ]
        ]
    },
    {
        "id": "9f2c690e.130148",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 590,
        "y": 500,
        "wires": []
    },
    {
        "id": "bd5b8cd4.242cc",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "時刻フォーマット",
        "func": "var timezone = 9;\nvar timezoneOffset = timezone * 1000 * 60 * 60;\nvar date = new Date(msg.payload + timezoneOffset);\nvar p = {\n    year: date.getFullYear().toString(),\n    month: ('0'+(date.getMonth()+1)).slice(-2),\n    day: ('0'+date.getDate()).slice(-2),\n    hours: ('0'+date.getHours()).slice(-2),\n    minutes: ('0'+date.getMinutes()).slice(-2),\n    secounds: ('0'+date.getSeconds()).slice(-2),\n    timezone:'+'+('0'+timezone).slice(-2)+':00',\n}\nmsg.payload={p:p};\nconsole.log('now:'+date);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 270,
        "y": 500,
        "wires": [
            [
                "add9a51f.aec9f8"
            ]
        ]
    },
    {
        "id": "add9a51f.aec9f8",
        "type": "template",
        "z": "fabbdf33.d3c4",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{{payload.p.year}}-{{payload.p.month}}-{{payload.p.day}}T{{payload.p.hours}}:{{payload.p.minutes}}:00{{payload.p.timezone}}",
        "output": "str",
        "x": 440,
        "y": 500,
        "wires": [
            [
                "9f2c690e.130148"
            ]
        ]
    },
    {
        "id": "b69ea94c.827328",
        "type": "inject",
        "z": "fabbdf33.d3c4",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 600,
        "wires": [
            [
                "56dbba9b.e29ac4"
            ]
        ]
    },
    {
        "id": "56dbba9b.e29ac4",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "時刻フォーマット（cFunc）",
        "func": "var cFunc = global.get('cFunc');\nvar out = cFunc.getTimeString(msg.payload);\nmsg.payload={out:out};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 310,
        "y": 600,
        "wires": [
            [
                "6f56df1e.b8231"
            ]
        ]
    },
    {
        "id": "6f56df1e.b8231",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 530,
        "y": 600,
        "wires": []
    },
    {
        "id": "b69bf31e.76789",
        "type": "inject",
        "z": "fabbdf33.d3c4",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 680,
        "wires": [
            [
                "b00a7ad3.de69b8"
            ]
        ]
    },
    {
        "id": "b00a7ad3.de69b8",
        "type": "change",
        "z": "fabbdf33.d3c4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "now",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 250,
        "y": 680,
        "wires": [
            [
                "cfdbeab5.8a6498"
            ]
        ]
    },
    {
        "id": "fce21ff4.ea489",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 790,
        "y": 700,
        "wires": []
    },
    {
        "id": "291374cc.cd5bcc",
        "type": "subflow:4bf7bdc7.49b4b4",
        "z": "fabbdf33.d3c4",
        "name": "",
        "x": 270,
        "y": 720,
        "wires": [
            [
                "b809fedc.39f42"
            ]
        ]
    },
    {
        "id": "b809fedc.39f42",
        "type": "change",
        "z": "fabbdf33.d3c4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.resources",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 720,
        "wires": [
            [
                "fce21ff4.ea489",
                "11501901.846747"
            ]
        ]
    },
    {
        "id": "11501901.846747",
        "type": "split",
        "z": "fabbdf33.d3c4",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 240,
        "y": 780,
        "wires": [
            [
                "af70080c.a406e8"
            ]
        ]
    },
    {
        "id": "af70080c.a406e8",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "param",
        "func": "var cFunc = global.get('cFunc');\n\nmsg.payload = {\n    'resource': msg.payload,\n    'param': {\n        calendarId: msg.payload.resourceId,\n        timeMin: msg.times.timeMin,\n        timeMax: msg.times.timeMax,\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 370,
        "y": 780,
        "wires": [
            [
                "a4e56235.e572a"
            ]
        ]
    },
    {
        "id": "a4e56235.e572a",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "calendar.events.list",
        "func": "var cFunc=global.get('cFunc');\nvar eventList = [];\nvar calendarId = msg.payload.param.calendarId;\nvar timeMin = msg.payload.param.timeMin;\nvar timeMax = msg.payload.param.timeMax;\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        calendarId: calendarId,\n        timeMin: timeMin,\n        timeMax: timeMax,\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = msg.payload.resource;\n        msg.payload.event = {};\n        if(eventList[0]){\n            var dsk = eventList[0].description.split(':');\n            msg.payload.event = {\n                detail: eventList[0],\n                eventId: eventList[0].id,\n                subject: eventList[0].summary,\n                user:dsk[1],\n                start: eventList[0].start.dateTime.substr(11,5),\n                end: eventList[0].end.dateTime.substr(11,5),\n            };\n            if(dsk[0]==='0'){\n                msg.payload.status=1; //予約済み未CheckIn\n                msg.payload.statusLabel='予約済み';\n            } else {\n                msg.payload.status=2; //使用中\n                msg.payload.statusLabel='使用中';\n            }\n        } else {\n            msg.payload.status=0; //空き\n            msg.payload.statusLabel='空き';\n        }\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 530,
        "y": 780,
        "wires": [
            [
                "3193e274.db876e"
            ]
        ]
    },
    {
        "id": "3193e274.db876e",
        "type": "join",
        "z": "fabbdf33.d3c4",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 690,
        "y": 780,
        "wires": [
            [
                "9bda92cb.89efa"
            ]
        ]
    },
    {
        "id": "cfdbeab5.8a6498",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "set msg.times",
        "func": "var cFunc=global.get('cFunc');\nmsg.times = {\n    timeMin: cFunc.getTimeString(msg.now),\n    timeMax: cFunc.getTimeString(msg.now + 60000),\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 420,
        "y": 680,
        "wires": [
            [
                "291374cc.cd5bcc"
            ]
        ]
    },
    {
        "id": "9bda92cb.89efa",
        "type": "change",
        "z": "fabbdf33.d3c4",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload.resources",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 840,
        "wires": [
            [
                "ff92d357.276f4"
            ]
        ]
    },
    {
        "id": "ff92d357.276f4",
        "type": "change",
        "z": "fabbdf33.d3c4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.at",
                "pt": "msg",
                "to": "times.timeMin",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 840,
        "wires": [
            [
                "607e6c09.0bc0a4"
            ]
        ]
    },
    {
        "id": "607e6c09.0bc0a4",
        "type": "change",
        "z": "fabbdf33.d3c4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "gInfo.currentStatus",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 880,
        "wires": [
            [
                "e801c9d4.a4d468"
            ]
        ]
    },
    {
        "id": "6239cffc.4844c",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 710,
        "y": 880,
        "wires": []
    },
    {
        "id": "e801c9d4.a4d468",
        "type": "change",
        "z": "fabbdf33.d3c4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "gInfo",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 880,
        "wires": [
            [
                "6239cffc.4844c"
            ]
        ]
    },
    {
        "id": "98516c25.3a0ce",
        "type": "inject",
        "z": "ea07e4a2.044d48",
        "name": "起動時",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "x": 100,
        "y": 80,
        "wires": [
            [
                "ddffdad8.e31788"
            ]
        ]
    },
    {
        "id": "957a4bca.c03218",
        "type": "function",
        "z": "90dfcaf6.6b3fd8",
        "name": "認証とカレンダーオブジェクト取得toGlobal",
        "func": "const fs = global.get('fs');\nconst readline = global.get('readline');\nconst {google} = global.get('google');\n\n// var eventList = [];\n\nvar authStats = global.get('authStats') || \n{\n    stat: \"NoClientSecrets\",\n};\nglobal.set('authStats', authStats);\n\n// If modifying these scopes, delete token.json.\nconst SCOPES = ['https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/spreadsheets'];\nconst TOKEN_PATH = '/data/token.json';\n\n// Load client secrets from a local file.\nfs.readFile('/data/credentials.json', (err, content) => {\n    console.log(']]]readFile start:'+content);\n  if (err) {\n      authStats.stat = \"NoClientSecrets\";\n      global.set('authStats', authStats);\n      msg.error = 'Error loading client secret file:'+ err;\n      node.send(msg);\n      return console.log('Error loading client secret file:', err);\n  }\n  // Authorize a client with credentials, then call the Google Calendar API.\n  authorize(JSON.parse(content), saveCalendarToGlobal);\n});\n\n/**\n * Create an OAuth2 client with the given credentials, and then execute the\n * given callback function.\n * @param {Object} credentials The authorization client credentials.\n * @param {function} callback The callback to call with the authorized client.\n */\nfunction authorize(credentials, callback) {\n  const {client_secret, client_id, redirect_uris} = credentials.installed;\n  const oAuth2Client = new google.auth.OAuth2(\n      client_id, client_secret, redirect_uris[0]);\n\n    console.log(']]]authorize start:'+credentials);\n  // Check if we have previously stored a token.\n  fs.readFile(TOKEN_PATH, (err, token) => {\n    if (err) return getAccessToken(oAuth2Client, callback);\n    oAuth2Client.setCredentials(JSON.parse(token));\n    callback(oAuth2Client);\n  });\n}\n\n/**\n * Get and store new token after prompting for user authorization, and then\n * execute the given callback with the authorized OAuth2 client.\n * @param {google.auth.OAuth2} oAuth2Client The OAuth2 client to get token for.\n * @param {getEventsCallback} callback The callback for the authorized client.\n */\nfunction getAccessToken(oAuth2Client, callback) {\n  const authUrl = oAuth2Client.generateAuthUrl({\n    access_type: 'offline',\n    scope: SCOPES,\n  });\n  if(!authStats.code) {\n      authStats.stat = \"NeedToAuthorize\";\n      authStats.url = authUrl;\n      global.set('authStats', authStats);\n      msg.error = 'no token';\n      node.send(msg);\n      return console.log('Authorize this app by visiting this url:', authUrl);\n  } else {\n      code = authStats.code;\n//  code='4/qwA2we0WATDIKq5MEsQDW1vnpzzx2wM26lIl7Mm7zgC0lIJwtxVy2AE';\n    oAuth2Client.getToken(code, (err, token) => {\n      if (err) {\n          authStats.stat = \"NeedToAuthorize\";\n          authStats.url = authUrl;\n          global.set('authStats', authStats);\n          msg.error = 'bad token';\n          node.send(msg);\n          return console.error('Error retrieving access token', err);\n      }\n      oAuth2Client.setCredentials(token);\n      // Store the token to disk for later program executions\n      fs.writeFile(TOKEN_PATH, JSON.stringify(token), (err) => {\n        if (err) console.error(err);\n        console.log('Token stored to', TOKEN_PATH);\n      });\n      callback(oAuth2Client);\n  });\n  }\n}\n\n/**\n * Lists the next 10 events on the user's primary calendar.\n * @param {google.auth.OAuth2} auth An authorized OAuth2 client.\n */\nfunction saveCalendarToGlobal(auth) {\n  const calendar = google.calendar({version: 'v3', auth});\n  const sheets = google.sheets({version: 'v4', auth});\n  console.log('saveCalendarToGlobal called:'+auth);\n  global.set('auth', auth);\n  global.set('calendar', calendar);\n  global.set('sheets', sheets);\n  authStats.stat = \"OK\";\n  global.set('authStats', authStats);\n  node.send(msg);\n}\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 370,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "5b5106ad.98fed8",
        "type": "debug",
        "z": "ea07e4a2.044d48",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 610,
        "y": 80,
        "wires": []
    },
    {
        "id": "c970220e.eca0b",
        "type": "function",
        "z": "ea07e4a2.044d48",
        "name": "グローバルストレージ作成",
        "func": "var gInfo = {\n    resources: [], //リソース一覧\n    currentStatus: {}, //現在状況\n    constants:{ //定数一覧\n        autoCancelMin: 10, //自動キャンセル時間（分）\n    },\n}\nglobal.set('gInfo', gInfo)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 320,
        "y": 120,
        "wires": [
            [
                "d5f580ac.f2cd9"
            ]
        ]
    },
    {
        "id": "ab792673.051eb8",
        "type": "subflow:4bf7bdc7.49b4b4",
        "z": "ea07e4a2.044d48",
        "name": "",
        "x": 290,
        "y": 240,
        "wires": [
            [
                "28e88696.9a7efa"
            ]
        ]
    },
    {
        "id": "28e88696.9a7efa",
        "type": "function",
        "z": "ea07e4a2.044d48",
        "name": "リソース一覧を保持する。",
        "func": "var gInfo = global.get('gInfo');\ngInfo.resources = msg.payload.resources;\nglobal.set('gInfo', gInfo);\nmsg.gInfo = gInfo;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 520,
        "y": 240,
        "wires": [
            [
                "867bffdc.321a5",
                "c89c7a6b.396958"
            ]
        ]
    },
    {
        "id": "d5f580ac.f2cd9",
        "type": "function",
        "z": "ea07e4a2.044d48",
        "name": "cFunc設定",
        "func": "var timezone = 9,\n    timezoneOffset = timezone * 1000 * 60 * 60;\n\nvar cFunc = {\n    timezone: timezone,\n    timezoneOffset: timezoneOffset,\n    getTimeString: function(time){\n        var date = new Date(time + timezoneOffset);\n        var p = this.getDateObject(date);\n        var ret = p.year+'-'+p.month+'-'+p.day+'T'+p.hours+':'+p.minutes+':00'+p.timezone;\n        return ret;\n    },\n    getDateObject: function(date){\n        var p = {\n            year: date.getFullYear().toString(),\n            month: ('0'+(date.getMonth()+1)).slice(-2),\n            day: ('0'+date.getDate()).slice(-2),\n            hours: ('0'+date.getHours()).slice(-2),\n            minutes: ('0'+date.getMinutes()).slice(-2),\n            seconds: ('0'+date.getSeconds()).slice(-2),\n            milliseconds: ('00'+date.getMilliseconds()).slice(-3),\n            timezone:'+'+('0'+timezone).slice(-2)+':00',\n        };\n        return p;\n    },\n    getTimeFromTimeString: function(ts){\n        return new Date(ts).getTime();\n    },\n    getSavedTime(oldTime, newTime){\n        var delta = oldTime - newTime;\n        return Math.ceil(delta / 60000);\n    },\n    getJstCommonString(time){\n        var p = this.getDateObject(new Date(time + timezoneOffset));\n        return p.year+'/'+p.month+'/'+p.day+' '+p.hours+':'+p.minutes+':'+p.seconds+'.'+p.milliseconds;\n    }\n};\nglobal.set('cFunc', cFunc);\nmsg.cFunc = cFunc;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 270,
        "y": 160,
        "wires": [
            [
                "87b56e82.9d0af"
            ]
        ]
    },
    {
        "id": "c89c7a6b.396958",
        "type": "debug",
        "z": "ea07e4a2.044d48",
        "name": "初期化バッチ",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 760,
        "y": 240,
        "wires": []
    },
    {
        "id": "9f1882a.270748",
        "type": "comment",
        "z": "ea07e4a2.044d48",
        "name": "node-red起動時の処理",
        "info": "",
        "x": 120,
        "y": 40,
        "wires": []
    },
    {
        "id": "a8b620d4.0eae2",
        "type": "inject",
        "z": "ea07e4a2.044d48",
        "name": "１分おき",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "*/1 0-23 * * *",
        "once": false,
        "onceDelay": "0.5",
        "x": 110,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "d999eef1.e2931",
        "type": "comment",
        "z": "ea07e4a2.044d48",
        "name": "定期処理",
        "info": "",
        "x": 80,
        "y": 300,
        "wires": []
    },
    {
        "id": "fedc0f1f.e9172",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "calendar.Freebusy.query",
        "func": "const calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar check = {\n    auth: auth,\n    resource: msg.payload.param.check\n};\n\nconsole.log('calendar.Freebusy.query:'+check)\nvar response = calendar.freebusy.query(check,\n    function(err, response){\n\n        console.log('err: '+ err);\n        console.log('Response: '+ response);\n//        console.log('Response Calendars: '+ response.calendars.calendarId);\n\n//        for (var property in response){\n//            console.log('Property: '+ property);\n//            console.log('Property Value: '+ response[property]);\n//        }\n\n//        for (var calendarValue in response){\n//            console.log('Calendar Value: '+ response.calendars.calendarValue);\n//        }\n        msg.payload = response;\n        node.send(msg);\n    }\n);\n\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 1020,
        "wires": [
            [
                "cb3e2c6e.797c3"
            ]
        ]
    },
    {
        "id": "2c0004c.09246fc",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "param",
        "func": "var calendarId = 'kaigishitsu.work_3835353636383833343637@resource.calendar.google.com';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'check': {\n            'timeMin': \"2018-11-28T16:30:00+09:00\",\n            'timeMax': \"2018-11-28T17:00:00+09:00\",\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 1020,
        "wires": [
            [
                "fedc0f1f.e9172"
            ]
        ]
    },
    {
        "id": "cb3e2c6e.797c3",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 610,
        "y": 1020,
        "wires": []
    },
    {
        "id": "e9c35840.905df8",
        "type": "inject",
        "z": "fabbdf33.d3c4",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 1020,
        "wires": [
            [
                "2c0004c.09246fc"
            ]
        ]
    },
    {
        "id": "8264d941.b11378",
        "type": "inject",
        "z": "ea07e4a2.044d48",
        "name": "毎朝",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "00 23 * * *",
        "once": false,
        "onceDelay": 0.1,
        "x": 90,
        "y": 120,
        "wires": [
            [
                "ddffdad8.e31788"
            ]
        ]
    },
    {
        "id": "867bffdc.321a5",
        "type": "change",
        "z": "ea07e4a2.044d48",
        "name": "timestamp",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 300,
        "wires": [
            [
                "7257050f.94fbcc"
            ]
        ]
    },
    {
        "id": "b230c16c.ad9af",
        "type": "http in",
        "z": "8bc72c78.d5201",
        "name": "",
        "url": "/rc/resources/:id/events",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 1400,
        "wires": [
            [
                "da613ddc.79d18",
                "4eebca96.9bb584"
            ]
        ]
    },
    {
        "id": "da613ddc.79d18",
        "type": "debug",
        "z": "8bc72c78.d5201",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 690,
        "y": 1360,
        "wires": []
    },
    {
        "id": "7169b832.ff7778",
        "type": "change",
        "z": "8bc72c78.d5201",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 1360,
        "wires": [
            [
                "83ad6709.bb1188"
            ]
        ]
    },
    {
        "id": "2ea1530c.24659c",
        "type": "inject",
        "z": "8bc72c78.d5201",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"id\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\"},\"query\":{},\"body\":{\"date\":\"2018-11-29\",\"start\":\"18:00\",\"end\":\"19:00\",\"user\":\"社員abc\",\"subject\":\"テスト会議X\",\"pin\":\"1234\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 1360,
        "wires": [
            [
                "7169b832.ff7778"
            ]
        ]
    },
    {
        "id": "299368ed.8dc508",
        "type": "http response",
        "z": "8bc72c78.d5201",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 750,
        "y": 1500,
        "wires": []
    },
    {
        "id": "83ad6709.bb1188",
        "type": "change",
        "z": "8bc72c78.d5201",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "req.body",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 480,
        "y": 1360,
        "wires": [
            [
                "da613ddc.79d18",
                "4eebca96.9bb584"
            ]
        ]
    },
    {
        "id": "5d8e73f0.02c3ec",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "calendar.Freebusy.query",
        "func": "const calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar check = {\n    auth: auth,\n    resource: msg.payload.param.check\n};\n\nconsole.log('calendar.Freebusy.query:'+check);\nvar response = calendar.freebusy.query(check,\n    function(err, response){\n        var obj={status:-1, statusLabel:'不明'};\n        console.dir(err);\n        if(response){\n            console.dir(response.data);\n        }\n        \n        if(response && \n            response.data &&\n            response.data.calendars &&\n            response.data.calendars[msg.req.params.id] &&\n            response.data.calendars[msg.req.params.id].busy){\n            if(response.data.calendars[msg.req.params.id].busy.length === 0){\n                //vacancy\n                obj.status=0;\n                obj.statusLabel='OK';\n            } else {\n                obj.status=1;\n                obj.statusLabel='NG';\n            }\n        }\n        msg.payload={param:msg.payload.param, result:obj};\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 490,
        "y": 1460,
        "wires": [
            [
                "2dfecc3b.6dfc34",
                "b7beb30.8b55e5"
            ]
        ]
    },
    {
        "id": "24c3fbf6.9c3c24",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "param",
        "func": "var calendarId = msg.req.params.id;\nvar timeMin = msg.payload.req.body.date+'T'+msg.payload.req.body.start+':00+09:00';\nvar timeMax = msg.payload.req.body.date+'T'+msg.payload.req.body.end+':00+09:00';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'check': {\n            'timeMin': timeMin,\n            'timeMax': timeMax,\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 110,
        "y": 1460,
        "wires": [
            []
        ]
    },
    {
        "id": "a5fd8fb9.ba788",
        "type": "debug",
        "z": "8bc72c78.d5201",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 850,
        "y": 1060,
        "wires": []
    },
    {
        "id": "579eb977.6cdc18",
        "type": "debug",
        "z": "8bc72c78.d5201",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 750,
        "y": 1460,
        "wires": []
    },
    {
        "id": "2dfecc3b.6dfc34",
        "type": "switch",
        "z": "8bc72c78.d5201",
        "name": "",
        "property": "payload.result.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 230,
        "y": 1520,
        "wires": [
            [
                "15d6cce0.573283"
            ],
            [
                "89660163.12d52"
            ]
        ]
    },
    {
        "id": "15d6cce0.573283",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "",
        "func": "var result={\n    status: \"busy\"\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 490,
        "y": 1520,
        "wires": [
            [
                "299368ed.8dc508",
                "579eb977.6cdc18"
            ]
        ]
    },
    {
        "id": "89660163.12d52",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "calendar.events.insert",
        "func": "var calList = [];\nconst calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar timezone = 'Asia/Tokyo';\nvar master ='master@kaigishitsu.work';\n\nvar returned = false;\n\nvar event = {\n    'summary': msg.req.body.subject,\n    //'location': '',\n    'description': '0:'+msg.req.body.user+':'+msg.req.body.pin,\n    'start': {\n        'dateTime': msg.payload.param.check.timeMin,\n        'timeZone': timezone,\n    },\n    'end': {\n        'dateTime': msg.payload.param.check.timeMax,\n        'timeZone': 'Asia/Tokyo',\n    },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n    'organizer': {'email': master},\n    'attendees': [\n        //{'email': master},\n        {'email': msg.payload.param.calendarId, 'resource': true}\n        ],\n    'reminders': {},\n};\nvar apiOptions = {\n    auth: auth,\n    calendarId: master,\n    resource: event\n};\nconsole.log('apiOptions:'+apiOptions);\ncalendar.events.insert(\n    apiOptions,\n    (err, event) => {\n        if (err) {\n            console.log('There was an error contacting the Calendar service: ' + err);\n        } else {\n            console.log('Event created: %s', event.data.htmlLink);\n        }\n        msg.payload.id=event.data.id;\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 380,
        "y": 1600,
        "wires": [
            [
                "f65731b.e24b3d"
            ]
        ]
    },
    {
        "id": "b7beb30.8b55e5",
        "type": "debug",
        "z": "8bc72c78.d5201",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 750,
        "y": 1420,
        "wires": []
    },
    {
        "id": "f65731b.e24b3d",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "",
        "func": "var result={\n    status: \"ok\",\n    id: msg.payload.id\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 580,
        "y": 1620,
        "wires": [
            [
                "299368ed.8dc508",
                "579eb977.6cdc18",
                "437bbe06.a6d2f"
            ]
        ]
    },
    {
        "id": "4eebca96.9bb584",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "param",
        "func": "var calendarId = msg.req.params.id;\nvar timeMin = msg.payload.date+'T'+msg.payload.start+':00+09:00';\nvar timeMax = msg.payload.date+'T'+msg.payload.end+':00+09:00';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'check': {\n            'timeMin': timeMin,\n            'timeMax': timeMax,\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 310,
        "y": 1460,
        "wires": [
            [
                "5d8e73f0.02c3ec"
            ]
        ]
    },
    {
        "id": "437bbe06.a6d2f",
        "type": "change",
        "z": "8bc72c78.d5201",
        "name": "timestamp",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 1680,
        "wires": [
            [
                "6059dbc8.044834"
            ]
        ]
    },
    {
        "id": "2c56a044.614d7",
        "type": "function",
        "z": "4f14d068.abfcc",
        "name": "calendar.events.insert",
        "func": "var calList = [];\nconst calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar timezone = 'Asia/Tokyo';\nvar master ='master@kaigishitsu.work';\n\nvar returned = false;\n\nvar event = {\n    'summary': msg.payload.event.subject,\n    //'location': '',\n    'description': msg.payload.event.status+':'+msg.payload.event.user+':'+msg.payload.event.pin+':'+msg.payload.event.saved+\":\"+msg.payload.event.checkedin,\n    'start': {\n        'dateTime': msg.payload.param.check.timeMin,\n        'timeZone': timezone,\n    },\n    'end': {\n        'dateTime': msg.payload.param.check.timeMax,\n        'timeZone': 'Asia/Tokyo',\n    },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n    'organizer': {'email': master},\n    'attendees': [\n        //{'email': master},\n        {'email': msg.payload.param.calendarId, 'resource': true}\n        ],\n    'reminders': {},\n};\nvar apiOptions = {\n    auth: auth,\n    calendarId: master,\n    resource: event\n};\nconsole.log('apiOptions:'+apiOptions);\ncalendar.events.insert(\n    apiOptions,\n    (err, event) => {\n        if (err) {\n            console.log('There was an error contacting the Calendar service: ' + err);\n        } else {\n            console.log('Event created: %s', event.data.htmlLink);\n            msg.payload.id=event.data.id;\n            msg.payload.attendees = event.data.attendees;\n        }\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 240,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "5085be80.00a98",
        "type": "change",
        "z": "247548cc.9b7088",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "now",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 300,
        "wires": [
            [
                "41c6c27a.e9fdac"
            ]
        ]
    },
    {
        "id": "41c6c27a.e9fdac",
        "type": "function",
        "z": "247548cc.9b7088",
        "name": "set msg.times",
        "func": "var cFunc=global.get('cFunc');\nmsg.times = {\n    timeMin: cFunc.getTimeString(msg.now),\n    timeMax: cFunc.getTimeString(msg.now + 60000),\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 460,
        "y": 300,
        "wires": [
            [
                "3561b449.10203c"
            ]
        ]
    },
    {
        "id": "3561b449.10203c",
        "type": "change",
        "z": "247548cc.9b7088",
        "name": "リソース一覧取得",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "gInfo.resources",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 300,
        "wires": [
            [
                "41afef07.bdc24",
                "f7b18306.35ed5"
            ]
        ]
    },
    {
        "id": "f7b18306.35ed5",
        "type": "debug",
        "z": "247548cc.9b7088",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 830,
        "y": 300,
        "wires": []
    },
    {
        "id": "41afef07.bdc24",
        "type": "split",
        "z": "247548cc.9b7088",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 290,
        "y": 360,
        "wires": [
            [
                "6057b61.3093748"
            ]
        ]
    },
    {
        "id": "6057b61.3093748",
        "type": "function",
        "z": "247548cc.9b7088",
        "name": "param",
        "func": "var cFunc = global.get('cFunc');\n\nmsg.payload = {\n    'resource': msg.payload,\n    'param': {\n        calendarId: msg.payload.resourceId,\n        timeMin: msg.times.timeMin,\n        timeMax: msg.times.timeMax,\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 420,
        "y": 360,
        "wires": [
            [
                "dbafc138.2f3d5"
            ]
        ]
    },
    {
        "id": "dbafc138.2f3d5",
        "type": "function",
        "z": "247548cc.9b7088",
        "name": "calendar.events.list",
        "func": "var cFunc=global.get('cFunc');\nvar eventList = [];\nvar calendarId = msg.payload.param.calendarId;\nvar timeMin = msg.payload.param.timeMin;\nvar timeMax = msg.payload.param.timeMax;\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        calendarId: calendarId,\n        timeMin: timeMin,\n        timeMax: timeMax,\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = msg.payload.resource;\n        msg.payload.event = {};\n        if(eventList[0]){\n            var dsk = eventList[0].description.split(':');\n            msg.payload.event = {\n                detail: eventList[0],\n                eventId: eventList[0].id,\n                subject: eventList[0].summary,\n                user:dsk[1],\n                pin:dsk[2],\n                start: eventList[0].start.dateTime.substr(11,5),\n                end: eventList[0].end.dateTime.substr(11,5),\n            };\n            if(dsk[0]==='0'){\n                msg.payload.status=1; //予約済み未CheckIn\n                msg.payload.statusLabel='予約済み';\n            } else {\n                msg.payload.status=2; //使用中\n                msg.payload.statusLabel='使用中';\n            }\n        } else {\n            msg.payload.status=0; //空き\n            msg.payload.statusLabel='空き';\n        }\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 580,
        "y": 360,
        "wires": [
            [
                "9e897886.a8cef8"
            ]
        ]
    },
    {
        "id": "9e897886.a8cef8",
        "type": "join",
        "z": "247548cc.9b7088",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 740,
        "y": 360,
        "wires": [
            [
                "47afac05.cabe64"
            ]
        ]
    },
    {
        "id": "47afac05.cabe64",
        "type": "change",
        "z": "247548cc.9b7088",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload.resources",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 420,
        "wires": [
            [
                "bcf816cc.006578"
            ]
        ]
    },
    {
        "id": "bcf816cc.006578",
        "type": "change",
        "z": "247548cc.9b7088",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.at",
                "pt": "msg",
                "to": "times.timeMin",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 510,
        "y": 420,
        "wires": [
            [
                "9e70ceca.afa23"
            ]
        ]
    },
    {
        "id": "9e70ceca.afa23",
        "type": "change",
        "z": "247548cc.9b7088",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "gInfo.currentStatus",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 460,
        "wires": [
            [
                "9b61ef74.36ea3"
            ]
        ]
    },
    {
        "id": "9b61ef74.36ea3",
        "type": "change",
        "z": "247548cc.9b7088",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "gInfo",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 580,
        "y": 460,
        "wires": [
            [
                "4b81b49d.d5ad5c"
            ]
        ]
    },
    {
        "id": "4b81b49d.d5ad5c",
        "type": "debug",
        "z": "247548cc.9b7088",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 750,
        "y": 460,
        "wires": []
    },
    {
        "id": "13f8d787.1dcf38",
        "type": "inject",
        "z": "4038e9de.d0dd68",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 160,
        "wires": [
            [
                "18f16e81.f751d1",
                "cdba358d.9957d8"
            ]
        ]
    },
    {
        "id": "18f16e81.f751d1",
        "type": "debug",
        "z": "4038e9de.d0dd68",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 290,
        "y": 160,
        "wires": []
    },
    {
        "id": "cdba358d.9957d8",
        "type": "change",
        "z": "4038e9de.d0dd68",
        "name": "empty payload",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 200,
        "wires": [
            [
                "9502c63a.de1a68"
            ]
        ]
    },
    {
        "id": "45813922.4e9038",
        "type": "http in",
        "z": "4038e9de.d0dd68",
        "name": "",
        "url": "/resources",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 200,
        "wires": [
            [
                "18f16e81.f751d1",
                "cdba358d.9957d8"
            ]
        ]
    },
    {
        "id": "9502c63a.de1a68",
        "type": "change",
        "z": "4038e9de.d0dd68",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.resources",
                "pt": "msg",
                "to": "gInfo.resources",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 200,
        "wires": [
            [
                "f1ba5642.81c818",
                "d8cd2179.1239a"
            ]
        ]
    },
    {
        "id": "f1ba5642.81c818",
        "type": "debug",
        "z": "4038e9de.d0dd68",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 830,
        "y": 240,
        "wires": []
    },
    {
        "id": "d8cd2179.1239a",
        "type": "http response",
        "z": "4038e9de.d0dd68",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 810,
        "y": 200,
        "wires": []
    },
    {
        "id": "28d3e804.204378",
        "type": "comment",
        "z": "4038e9de.d0dd68",
        "name": "resource（会議室）一覧取得",
        "info": "",
        "x": 160,
        "y": 120,
        "wires": []
    },
    {
        "id": "7cc41b1a.3890a4",
        "type": "catch",
        "z": "4038e9de.d0dd68",
        "name": "",
        "scope": null,
        "x": 700,
        "y": 40,
        "wires": [
            [
                "4f303837.009238"
            ]
        ]
    },
    {
        "id": "4f303837.009238",
        "type": "debug",
        "z": "4038e9de.d0dd68",
        "name": "Exception!!",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 850,
        "y": 40,
        "wires": []
    },
    {
        "id": "b970c715.508ad8",
        "type": "inject",
        "z": "4038e9de.d0dd68",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 320,
        "wires": [
            [
                "4f19cb73.6384e4",
                "bf93ac94.3623f"
            ]
        ]
    },
    {
        "id": "4f19cb73.6384e4",
        "type": "debug",
        "z": "4038e9de.d0dd68",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 290,
        "y": 320,
        "wires": []
    },
    {
        "id": "bf93ac94.3623f",
        "type": "change",
        "z": "4038e9de.d0dd68",
        "name": "empty payload",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 400,
        "y": 360,
        "wires": [
            [
                "c39b0f67.4bf45"
            ]
        ]
    },
    {
        "id": "cf8f5c7e.3af88",
        "type": "http in",
        "z": "4038e9de.d0dd68",
        "name": "",
        "url": "/currentstatus",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 360,
        "wires": [
            [
                "4f19cb73.6384e4",
                "bf93ac94.3623f"
            ]
        ]
    },
    {
        "id": "c39b0f67.4bf45",
        "type": "change",
        "z": "4038e9de.d0dd68",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "gInfo.currentStatus",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 580,
        "y": 360,
        "wires": [
            [
                "33c3b880.7c16f8",
                "98d59cd1.81d23"
            ]
        ]
    },
    {
        "id": "33c3b880.7c16f8",
        "type": "debug",
        "z": "4038e9de.d0dd68",
        "name": "現在状況取得",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 840,
        "y": 400,
        "wires": []
    },
    {
        "id": "98d59cd1.81d23",
        "type": "http response",
        "z": "4038e9de.d0dd68",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 810,
        "y": 360,
        "wires": []
    },
    {
        "id": "ca6d7cc3.2bae",
        "type": "comment",
        "z": "4038e9de.d0dd68",
        "name": "現在状況取得",
        "info": "",
        "x": 110,
        "y": 280,
        "wires": []
    },
    {
        "id": "9644278a.6399b8",
        "type": "function",
        "z": "4038e9de.d0dd68",
        "name": "calendar.events.list",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        calendarId: msg.payload.param.calendarId,\n        timeMin: msg.payload.param.timeMin,\n        timeMax: msg.payload.param.timeMax,\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = {\"events\":eventList};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 330,
        "y": 560,
        "wires": [
            [
                "4e24193f.e39078"
            ]
        ]
    },
    {
        "id": "47f88c38.5bfa04",
        "type": "function",
        "z": "4038e9de.d0dd68",
        "name": "param",
        "func": "var cFunc=global.get('cFunc');\nvar targetDate;\nif(msg.req.query.date){\n    targetDate = new Date(msg.req.query.date);\n}else{\n    targetDate = new Date();\n    targetDate.setHours(0);\n    targetDate.setMinutes(0);\n    targetDate.setSeconds(0);\n    targetDate.setMilliseconds(0);\n}\n\nvar dateStr=cFunc.getTimeString(targetDate);\nvar startHour=dateStr.substr(0,11)+'00:00:00'+dateStr.substr(19,25);\nvar endHour=dateStr.substr(0,11)+'23:59:59'+dateStr.substr(19,25);\nmsg.payload={\n    //param:{\n    //    resourceId: msg.req.params.id,\n    //    date: date,\n    //},\n    param: {\n        calendarId: msg.req.params.id,\n        timeMin: startHour,\n        timeMax: endHour,\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 470,
        "y": 520,
        "wires": [
            [
                "9644278a.6399b8"
            ]
        ]
    },
    {
        "id": "4e24193f.e39078",
        "type": "change",
        "z": "4038e9de.d0dd68",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.events",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 560,
        "wires": [
            [
                "93fce19.9cf232"
            ]
        ]
    },
    {
        "id": "4b48cc85.dd7214",
        "type": "http in",
        "z": "4038e9de.d0dd68",
        "name": "",
        "url": "/resources/:id/events/",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 520,
        "wires": [
            [
                "c0fef705.52aa48",
                "47f88c38.5bfa04"
            ]
        ]
    },
    {
        "id": "93fce19.9cf232",
        "type": "switch",
        "z": "4038e9de.d0dd68",
        "name": "",
        "property": "payload.length",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 170,
        "y": 620,
        "wires": [
            [
                "2838fdc4.cb0712"
            ],
            [
                "ceebfe4c.8c15c"
            ]
        ]
    },
    {
        "id": "c0fef705.52aa48",
        "type": "debug",
        "z": "4038e9de.d0dd68",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 470,
        "y": 480,
        "wires": []
    },
    {
        "id": "2838fdc4.cb0712",
        "type": "split",
        "z": "4038e9de.d0dd68",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": "1",
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 290,
        "y": 600,
        "wires": [
            [
                "ab379a9c.1e9cf8"
            ]
        ]
    },
    {
        "id": "ceebfe4c.8c15c",
        "type": "change",
        "z": "4038e9de.d0dd68",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "payload.events",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 790,
        "y": 620,
        "wires": [
            [
                "586e921e.8862ec",
                "80429a4b.89e088"
            ]
        ]
    },
    {
        "id": "ab379a9c.1e9cf8",
        "type": "function",
        "z": "4038e9de.d0dd68",
        "name": "出力形式に変換する",
        "func": "var dsk = msg.payload.description.split(':');\nvar status = \"\";\nswitch (dsk[0]){\ncase \"0\":\n    break;\ncase \"1\":\n    break;\ncase \"2\":\n    status = \"チェックアウト済\";\n    break;\ncase \"9\":\n    status = \"自動キャンセル\";\n    break;\n}\nvar outObj = {\n    detail: msg.payload,\n    eventId: msg.payload.id,\n    subject: msg.payload.summary,\n    user:dsk[1],\n    status: status,\n    start: msg.payload.start.dateTime.substr(11,5),\n    end: msg.payload.end.dateTime.substr(11,5),\n}\nmsg.payload = outObj;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 460,
        "y": 600,
        "wires": [
            [
                "fda94b30.ec90f8"
            ]
        ]
    },
    {
        "id": "fda94b30.ec90f8",
        "type": "join",
        "z": "4038e9de.d0dd68",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 630,
        "y": 600,
        "wires": [
            [
                "ceebfe4c.8c15c"
            ]
        ]
    },
    {
        "id": "586e921e.8862ec",
        "type": "http response",
        "z": "4038e9de.d0dd68",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 810,
        "y": 520,
        "wires": []
    },
    {
        "id": "80429a4b.89e088",
        "type": "debug",
        "z": "4038e9de.d0dd68",
        "name": "予約一覧",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 820,
        "y": 560,
        "wires": []
    },
    {
        "id": "ff71164e.bb7338",
        "type": "comment",
        "z": "4038e9de.d0dd68",
        "name": "リソース別予約一覧取得",
        "info": "",
        "x": 150,
        "y": 440,
        "wires": []
    },
    {
        "id": "627eda3b.385454",
        "type": "change",
        "z": "4038e9de.d0dd68",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 480,
        "wires": [
            [
                "47f88c38.5bfa04",
                "c0fef705.52aa48"
            ]
        ]
    },
    {
        "id": "ff6978c4.ce8ad8",
        "type": "inject",
        "z": "4038e9de.d0dd68",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"id\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\"},\"query\":{}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 480,
        "wires": [
            [
                "627eda3b.385454"
            ]
        ]
    },
    {
        "id": "2aa1379f.678828",
        "type": "inject",
        "z": "4038e9de.d0dd68",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"resourceid\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\",\"eventid\":\"djcjsd67gkduhog10cnatfjreg\"},\"query\":{}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 720,
        "wires": [
            [
                "9a518663.634358"
            ]
        ]
    },
    {
        "id": "9a518663.634358",
        "type": "change",
        "z": "4038e9de.d0dd68",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 720,
        "wires": [
            [
                "3739af10.5b53a",
                "487b73ca.dd9cbc"
            ]
        ]
    },
    {
        "id": "3739af10.5b53a",
        "type": "debug",
        "z": "4038e9de.d0dd68",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 470,
        "y": 720,
        "wires": []
    },
    {
        "id": "487b73ca.dd9cbc",
        "type": "function",
        "z": "4038e9de.d0dd68",
        "name": "param",
        "func": "msg.payload={\n    //param:{\n    //    resourceId: msg.req.params.id,\n    //    date: date,\n    //},\n    param: {\n        calendarId: msg.req.params.resourceid,\n        eventId: msg.req.params.eventid\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 470,
        "y": 760,
        "wires": [
            [
                "7a219a0b.4cd154"
            ]
        ]
    },
    {
        "id": "7a219a0b.4cd154",
        "type": "function",
        "z": "4038e9de.d0dd68",
        "name": "calendar.events.get",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\nconsole.log('calling calendar.events.get###')\nconsole.log('calendarId:'+msg.payload.param.calendarId);\nconsole.log('eventId:'+msg.payload.param.eventId);\n\n    calendar.events.get({\n        calendarId: msg.payload.param.calendarId,\n        eventId: msg.payload.param.eventId\n    }, (err, res) => {\n        if (err){\n            console.log('The API returned an error: ' + err);\n            msg.payload = {};\n            console.log('node.send();');\n            node.send(msg);\n            return;\n        }\n        console.log('res.data>>>');\n        console.dir(res.data);\n        const event = res.data;\n        if (event) {\n            console.log('target event:');\n            const start = event.start.dateTime || event.start.date;\n            console.log(`${start} - ${event.summary}`);\n            console.log(event);\n        } else {\n            console.log('No event found.');\n        }\n        msg.payload = {\"event\":event};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 630,
        "y": 760,
        "wires": [
            [
                "38328a15.98c336",
                "176f452f.e69a8b"
            ]
        ]
    },
    {
        "id": "38328a15.98c336",
        "type": "debug",
        "z": "4038e9de.d0dd68",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 820,
        "y": 760,
        "wires": []
    },
    {
        "id": "9234a5a0.bcf4c8",
        "type": "http in",
        "z": "4038e9de.d0dd68",
        "name": "",
        "url": "/resources/:resourceid/events/:eventid",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 210,
        "y": 760,
        "wires": [
            [
                "487b73ca.dd9cbc",
                "3739af10.5b53a"
            ]
        ]
    },
    {
        "id": "f36464b2.d0d7d8",
        "type": "http response",
        "z": "4038e9de.d0dd68",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 810,
        "y": 860,
        "wires": []
    },
    {
        "id": "60235603.872ba8",
        "type": "comment",
        "z": "4038e9de.d0dd68",
        "name": "予約情報取得",
        "info": "",
        "x": 110,
        "y": 680,
        "wires": []
    },
    {
        "id": "d6f56a8b.8d2d98",
        "type": "function",
        "z": "4038e9de.d0dd68",
        "name": "出力形式に変換する",
        "func": "var dsk = msg.payload.description.split(':');\nvar outObj = {\n    detail: msg.payload,\n    eventId: msg.payload.id,\n    subject: msg.payload.summary,\n    user:dsk[1],\n    start: msg.payload.start.dateTime.substr(11,5),\n    end: msg.payload.end.dateTime.substr(11,5),\n}\nmsg.payload = {result: 'ok',event:outObj};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 520,
        "y": 820,
        "wires": [
            [
                "965288ae.33c3e8",
                "f36464b2.d0d7d8"
            ]
        ]
    },
    {
        "id": "16428942.139a97",
        "type": "change",
        "z": "4038e9de.d0dd68",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.event",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 820,
        "wires": [
            [
                "d6f56a8b.8d2d98"
            ]
        ]
    },
    {
        "id": "965288ae.33c3e8",
        "type": "debug",
        "z": "4038e9de.d0dd68",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 830,
        "y": 820,
        "wires": []
    },
    {
        "id": "176f452f.e69a8b",
        "type": "switch",
        "z": "4038e9de.d0dd68",
        "name": "",
        "property": "payload.event",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 170,
        "y": 840,
        "wires": [
            [
                "16428942.139a97"
            ],
            [
                "b1d12c62.2771c"
            ]
        ]
    },
    {
        "id": "b1d12c62.2771c",
        "type": "function",
        "z": "4038e9de.d0dd68",
        "name": "not found",
        "func": "msg.payload = {result: 'not found',event:{}};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 860,
        "wires": [
            [
                "f36464b2.d0d7d8",
                "965288ae.33c3e8"
            ]
        ]
    },
    {
        "id": "7257050f.94fbcc",
        "type": "subflow:247548cc.9b7088",
        "z": "ea07e4a2.044d48",
        "name": "",
        "x": 480,
        "y": 340,
        "wires": [
            [
                "dda3e345.458cb",
                "8943d642.1722b8"
            ]
        ]
    },
    {
        "id": "dda3e345.458cb",
        "type": "debug",
        "z": "ea07e4a2.044d48",
        "name": "現在状況更新バッチ",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 780,
        "y": 340,
        "wires": []
    },
    {
        "id": "93cb00b9.2e036",
        "type": "inject",
        "z": "8bc72c78.d5201",
        "name": "",
        "topic": "",
        "payload": "2019-01-05T16:25:00+09:00",
        "payloadType": "str",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 1760,
        "wires": [
            [
                "10869f9a.2b435"
            ]
        ]
    },
    {
        "id": "10869f9a.2b435",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "",
        "func": "var cFunc=global.get('cFunc');\n\nvar t = cFunc.getTimeFromTimeString(msg.payload);\nmsg.t = t;\nvar n = new Date().getTime();\nmsg.n = n;\nmsg.d = cFunc.getSavedTime(t, n);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 1760,
        "wires": [
            [
                "ba940904.b76478"
            ]
        ]
    },
    {
        "id": "b9152e74.f8ccb",
        "type": "debug",
        "z": "8bc72c78.d5201",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 430,
        "y": 1760,
        "wires": []
    },
    {
        "id": "8943d642.1722b8",
        "type": "change",
        "z": "ea07e4a2.044d48",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "now",
                "pt": "msg",
                "to": "payload.currentStatus.at",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 170,
        "y": 460,
        "wires": [
            [
                "12759645.34775a"
            ]
        ]
    },
    {
        "id": "12759645.34775a",
        "type": "change",
        "z": "ea07e4a2.044d48",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.currentStatus.resources",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 460,
        "wires": [
            [
                "e41d9cfe.73052"
            ]
        ]
    },
    {
        "id": "e41d9cfe.73052",
        "type": "split",
        "z": "ea07e4a2.044d48",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 170,
        "y": 520,
        "wires": [
            [
                "89fa88ff.9bf808",
                "8fe86fc4.8eb1b"
            ]
        ]
    },
    {
        "id": "89fa88ff.9bf808",
        "type": "debug",
        "z": "ea07e4a2.044d48",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 490,
        "y": 620,
        "wires": []
    },
    {
        "id": "8fe86fc4.8eb1b",
        "type": "switch",
        "z": "ea07e4a2.044d48",
        "name": "未チェックイン？",
        "property": "payload.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 350,
        "y": 520,
        "wires": [
            [
                "eaa1d9d9.7bd9b8"
            ],
            []
        ]
    },
    {
        "id": "eaa1d9d9.7bd9b8",
        "type": "function",
        "z": "ea07e4a2.044d48",
        "name": "",
        "func": "var cFunc=global.get('cFunc');\nvar gInfo=global.get('gInfo');\nvar startTime = msg.payload.event.detail.start.dateTime;\n\nvar tStart = cFunc.getTimeFromTimeString(startTime);\nvar tNow = cFunc.getTimeFromTimeString(msg.now);\n\nvar delta = tNow - tStart;\nvar deltaMin = Math.floor(delta / 60000);\nvar timeToAutoCancel = gInfo.constants.autoCancelMin - deltaMin;\n\nmsg.payload.timePast = deltaMin;\nmsg.payload.timeToAutoCancel = timeToAutoCancel;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 510,
        "y": 500,
        "wires": [
            [
                "e80ccf6f.2c212"
            ]
        ]
    },
    {
        "id": "b5272fa1.282f1",
        "type": "debug",
        "z": "ea07e4a2.044d48",
        "name": "自動キャンセル発動",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 860,
        "y": 560,
        "wires": []
    },
    {
        "id": "e80ccf6f.2c212",
        "type": "switch",
        "z": "ea07e4a2.044d48",
        "name": "時間切れ？",
        "property": "payload.timePast",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gte",
                "v": "10",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 650,
        "y": 480,
        "wires": [
            [
                "a9e41664.a8e938"
            ],
            []
        ]
    },
    {
        "id": "73c1f25e.60b67c",
        "type": "http request",
        "z": "ea07e4a2.044d48",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "url": "",
        "x": 820,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "a9e41664.a8e938",
        "type": "function",
        "z": "ea07e4a2.044d48",
        "name": "",
        "func": "var dsk = msg.payload.event.detail.description.split(':');\n\nvar data =\n{\n    \"req\": {\n        \"params\": {\n            \"resourceid\": msg.payload.resourceId,\n            \"eventid\": msg.payload.event.eventId\n        },\n        \"query\": {\n            \"operation\": \"autocancel\"\n        },\n        \"body\": {\n            \"pin\": dsk[2]\n        }\n    }\n};\nmsg.payload = data;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 790,
        "y": 480,
        "wires": [
            [
                "b5272fa1.282f1",
                "ca55bed.8b1e94"
            ]
        ]
    },
    {
        "id": "ca55bed.8b1e94",
        "type": "link out",
        "z": "ea07e4a2.044d48",
        "name": "",
        "links": [
            "530ad113.0ba55",
            "12c9435f.e498ad"
        ],
        "x": 820,
        "y": 600,
        "wires": []
    },
    {
        "id": "c7197d31.a696b",
        "type": "inject",
        "z": "fabbdf33.d3c4",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 1140,
        "wires": [
            [
                "333f59f1.d2f626"
            ]
        ]
    },
    {
        "id": "333f59f1.d2f626",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "param",
        "func": "var calendarId = 'kaigishitsu.work_3835353636383833343637@resource.calendar.google.com';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'check': {\n            'timeMin': \"2019-03-13T16:30:00+09:00\",\n            'timeMax': \"2019-03-13T17:10:00+09:00\",\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    },\n    'event': {\n        \"subject\": \"てすと\",\n        \"user\": \"tana\",\n        \"pin\": \"100\",\n        \"status\": 0,\n        \"saved\": 0\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 1140,
        "wires": [
            [
                "99b640db.8685c"
            ]
        ]
    },
    {
        "id": "99b640db.8685c",
        "type": "subflow:4f14d068.abfcc",
        "z": "fabbdf33.d3c4",
        "name": "",
        "x": 380,
        "y": 1140,
        "wires": [
            [
                "fd2252af.591b7"
            ]
        ]
    },
    {
        "id": "fd2252af.591b7",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 530,
        "y": 1140,
        "wires": []
    },
    {
        "id": "1aaceafd.56e905",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "calendar.events.update",
        "func": "var calList = [];\nconst calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar timezone = 'Asia/Tokyo';\nvar master ='master@kaigishitsu.work';\n\nvar returned = false;\n\nvar event = {\n    'summary': msg.payload.event.subject,\n    //'location': '',\n    'description': msg.payload.event.status+':'+msg.payload.event.user+':'+msg.payload.event.pin+':'+msg.payload.event.saved,\n    'start': {\n        'dateTime': msg.payload.param.check.timeMin,\n        'timeZone': timezone,\n    },\n    'end': {\n        'dateTime': msg.payload.param.check.timeMax,\n        'timeZone': 'Asia/Tokyo',\n    },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n    'organizer': {'email': master},\n    'attendees': [\n        //{'email': master},\n        {'email': msg.payload.param.calendarId, 'resource': true}\n        ],\n    'reminders': {},\n};\nvar apiOptions = {\n    auth: auth,\n    calendarId: master,\n    eventId: msg.payload.eventId,\n    resource: event\n};\nconsole.log('apiOptions:'+apiOptions);\ncalendar.events.update(\n    apiOptions,\n    (err, event) => {\n        if (err) {\n            msg.payload.err = err;\n            console.log('There was an error contacting the Calendar service: ' + err);\n        } else {\n            console.log('Event created: %s', event.data.htmlLink);\n        }\n        msg.payload.id=event.data.id;\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 410,
        "y": 1240,
        "wires": [
            [
                "63bb201e.be8aa"
            ]
        ]
    },
    {
        "id": "d164666e.03f788",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "param",
        "func": "var calendarId = 'kaigishitsu.work_3835353636383833343637@resource.calendar.google.com';\nvar eventId = '4kl4nfgrr0nhual90mn5klv614';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'check': {\n            'timeMin': \"2019-03-13T16:30:00+09:00\",\n            'timeMax': \"2019-03-13T17:20:00+09:00\",\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    },\n    'event': {\n        \"subject\": \"てすと\",\n        \"user\": \"tana\",\n        \"pin\": \"100\",\n        \"status\": 0,\n        \"saved\": 0\n    },\n    'eventId': eventId\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 230,
        "y": 1240,
        "wires": [
            [
                "1aaceafd.56e905"
            ]
        ]
    },
    {
        "id": "bdce52ec.4fa9",
        "type": "inject",
        "z": "fabbdf33.d3c4",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 1240,
        "wires": [
            [
                "d164666e.03f788"
            ]
        ]
    },
    {
        "id": "63bb201e.be8aa",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 590,
        "y": 1240,
        "wires": []
    },
    {
        "id": "6059dbc8.044834",
        "type": "subflow:247548cc.9b7088",
        "z": "8bc72c78.d5201",
        "name": "",
        "x": 670,
        "y": 1680,
        "wires": [
            []
        ]
    },
    {
        "id": "87b56e82.9d0af",
        "type": "switch",
        "z": "ea07e4a2.044d48",
        "name": "",
        "property": "authStats.stat",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "OK",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 410,
        "y": 160,
        "wires": [
            [
                "ab792673.051eb8"
            ],
            [
                "9d0181a.4ac578"
            ]
        ]
    },
    {
        "id": "82cf3eca.c5217",
        "type": "debug",
        "z": "ea07e4a2.044d48",
        "name": "初期化エラー（未認証）",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 810,
        "y": 160,
        "wires": []
    },
    {
        "id": "9d0181a.4ac578",
        "type": "template",
        "z": "ea07e4a2.044d48",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Authorization not completed. status:{{global.authStats.stat}}",
        "output": "str",
        "x": 620,
        "y": 160,
        "wires": [
            [
                "82cf3eca.c5217"
            ]
        ]
    },
    {
        "id": "352a857d.36a1ba",
        "type": "http in",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "url": "/mente/stats",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 100,
        "wires": [
            [
                "be878cec.3fb59",
                "dad051ff.6a3d9"
            ]
        ]
    },
    {
        "id": "30207a1a.85d196",
        "type": "comment",
        "z": "fb1d09b1.5e4f88",
        "name": "状況取得",
        "info": "",
        "x": 100,
        "y": 60,
        "wires": []
    },
    {
        "id": "50c156ac.469528",
        "type": "http response",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1000,
        "y": 100,
        "wires": []
    },
    {
        "id": "975a51ef.df402",
        "type": "http in",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "url": "/mente/setcredentials",
        "method": "post",
        "upload": true,
        "swaggerDoc": "",
        "x": 160,
        "y": 300,
        "wires": [
            [
                "20e5a3cf.dca91c",
                "9f5b3384.cb85"
            ]
        ]
    },
    {
        "id": "20e5a3cf.dca91c",
        "type": "function",
        "z": "fb1d09b1.5e4f88",
        "name": "file check",
        "func": "let files = msg.req.files;\n\nif(files.length === 0) {\n    msg.payload = null;\n    return msg;\n}\n\nmsg.payload = files[0].buffer;\nmsg.filename = \"/data/credentials.json\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 360,
        "y": 300,
        "wires": [
            [
                "87be3ce5.9476"
            ]
        ]
    },
    {
        "id": "917aaa4d.f88cc8",
        "type": "file",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "filename": "/data/credentials.json",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "x": 680,
        "y": 320,
        "wires": [
            [
                "87625d98.46b48"
            ]
        ]
    },
    {
        "id": "ddffdad8.e31788",
        "type": "subflow:90dfcaf6.6b3fd8",
        "z": "ea07e4a2.044d48",
        "x": 370,
        "y": 80,
        "wires": [
            [
                "5b5106ad.98fed8",
                "c970220e.eca0b"
            ]
        ]
    },
    {
        "id": "87625d98.46b48",
        "type": "subflow:90dfcaf6.6b3fd8",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "x": 750,
        "y": 380,
        "wires": [
            [
                "a2ccf973.f86498",
                "ae8924a7.eefff8",
                "188fb2ec.9c1e8d"
            ]
        ]
    },
    {
        "id": "f0386955.5b4e78",
        "type": "switch",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "property": "authStats.stat",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "OK",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "NeedToAuthorize",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "NoClientSecrets",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 450,
        "y": 120,
        "wires": [
            [
                "3b409e98.f9e2f2"
            ],
            [
                "aaae3993.6a2518"
            ],
            [
                "990aeac9.88a7f8"
            ],
            [
                "ebe1c953.653188"
            ]
        ]
    },
    {
        "id": "3b409e98.f9e2f2",
        "type": "template",
        "z": "fb1d09b1.5e4f88",
        "name": "ok",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!doctype html>\n<html>\n    <head>\n        <meta charset=\"utf-8\">\n        <title>stats</title>\n    </head>\n    <body>\n        <p>status:{{global.authStats.stat}}</p>\n    </body>\n</html>",
        "output": "str",
        "x": 590,
        "y": 60,
        "wires": [
            [
                "50c156ac.469528"
            ]
        ]
    },
    {
        "id": "be878cec.3fb59",
        "type": "debug",
        "z": "fb1d09b1.5e4f88",
        "name": "mente/stats",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 290,
        "y": 60,
        "wires": []
    },
    {
        "id": "431dc18e.7204a",
        "type": "debug",
        "z": "fb1d09b1.5e4f88",
        "name": "Error!",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 1210,
        "y": 40,
        "wires": []
    },
    {
        "id": "990aeac9.88a7f8",
        "type": "template",
        "z": "fb1d09b1.5e4f88",
        "name": "upload credentials",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!doctype html>\n<html>\n    <head>\n        <meta charset=\"utf-8\">\n        <title>stats</title>\n    </head>\n    <body>\n        <p>{{payload}}</p>\n        <p>status:{{global.authStats.stat}}</p>\n        <form action=\"/mente/setcredentials\" method=\"post\" enctype=\"multipart/form-data\">\n            <input name=\"file\" type=\"file\" id=\"file\"><br>\n            <input type=\"submit\" value=\"アップロード\">\n        </form>\n    </body>\n</html>",
        "output": "str",
        "x": 630,
        "y": 140,
        "wires": [
            [
                "50c156ac.469528"
            ]
        ]
    },
    {
        "id": "4cfdc92e.8820b8",
        "type": "catch",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "scope": null,
        "x": 1060,
        "y": 40,
        "wires": [
            [
                "431dc18e.7204a"
            ]
        ]
    },
    {
        "id": "57fca504.bfdb6c",
        "type": "link in",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "links": [
            "a2ccf973.f86498",
            "a82e116b.66e5e"
        ],
        "x": 235,
        "y": 140,
        "wires": [
            [
                "f0386955.5b4e78"
            ]
        ]
    },
    {
        "id": "a2ccf973.f86498",
        "type": "link out",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "links": [
            "57fca504.bfdb6c"
        ],
        "x": 995,
        "y": 280,
        "wires": []
    },
    {
        "id": "87be3ce5.9476",
        "type": "switch",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 490,
        "y": 300,
        "wires": [
            [
                "6d3cf652.023098"
            ],
            [
                "917aaa4d.f88cc8"
            ]
        ]
    },
    {
        "id": "dad051ff.6a3d9",
        "type": "change",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 100,
        "wires": [
            [
                "f0386955.5b4e78"
            ]
        ]
    },
    {
        "id": "9f5b3384.cb85",
        "type": "debug",
        "z": "fb1d09b1.5e4f88",
        "name": "mente/setcredentials",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 400,
        "y": 260,
        "wires": []
    },
    {
        "id": "6d3cf652.023098",
        "type": "change",
        "z": "fb1d09b1.5e4f88",
        "name": "No file.",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "No file.",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 280,
        "wires": [
            [
                "a2ccf973.f86498"
            ]
        ]
    },
    {
        "id": "30eadb85.e9e414",
        "type": "link in",
        "z": "ea07e4a2.044d48",
        "name": "",
        "links": [
            "cdad4521.28ded8"
        ],
        "x": 80,
        "y": 240,
        "wires": [
            [
                "ab792673.051eb8"
            ]
        ]
    },
    {
        "id": "cdad4521.28ded8",
        "type": "link out",
        "z": "fb1d09b1.5e4f88",
        "name": "データ取得へ...",
        "links": [
            "30eadb85.e9e414"
        ],
        "x": 1095,
        "y": 380,
        "wires": []
    },
    {
        "id": "ae8924a7.eefff8",
        "type": "switch",
        "z": "fb1d09b1.5e4f88",
        "name": "if OK",
        "property": "authStats.stat",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "OK",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1010,
        "y": 380,
        "wires": [
            [
                "cdad4521.28ded8"
            ]
        ]
    },
    {
        "id": "aaae3993.6a2518",
        "type": "template",
        "z": "fb1d09b1.5e4f88",
        "name": "authorize",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!doctype html>\n<html>\n    <head>\n        <meta charset=\"utf-8\">\n        <title>stats</title>\n    </head>\n    <body>\n        <p>status:{{global.authStats.stat}}</p>\n        click <a href=\"{{global.authStats.url}}\" target=\"_blank\">here</a> to authorize.\n        <hr/>\n        <form action=\"/mente/setcode\" method=\"get\">\n            <input name=\"code\" type=\"text\" id=\"code\"><br>\n            <input type=\"submit\" value=\"設定\">\n        </form>\n    </body>\n</html>",
        "output": "str",
        "x": 600,
        "y": 100,
        "wires": [
            [
                "50c156ac.469528"
            ]
        ]
    },
    {
        "id": "31e5366c.526d8a",
        "type": "catch",
        "z": "90dfcaf6.6b3fd8",
        "name": "",
        "scope": null,
        "x": 480,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "99a5b006.443ef",
        "type": "http in",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "url": "/mente/setcode",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 440,
        "wires": [
            [
                "e52254d.179c1a8",
                "603470de.3e3a2"
            ]
        ]
    },
    {
        "id": "e52254d.179c1a8",
        "type": "switch",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "property": "payload.code",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "empty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 290,
        "y": 460,
        "wires": [
            [
                "13fbb309.04dfbd"
            ],
            [
                "13fbb309.04dfbd"
            ],
            [
                "23aab131.daf26e"
            ]
        ]
    },
    {
        "id": "13fbb309.04dfbd",
        "type": "change",
        "z": "fb1d09b1.5e4f88",
        "name": "No code.",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "No code.",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 440,
        "wires": [
            [
                "a82e116b.66e5e"
            ]
        ]
    },
    {
        "id": "a82e116b.66e5e",
        "type": "link out",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "links": [
            "57fca504.bfdb6c"
        ],
        "x": 535,
        "y": 440,
        "wires": []
    },
    {
        "id": "23aab131.daf26e",
        "type": "function",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "func": "var authStats = global.get('authStats') || \n{\n};\nauthStats.code = msg.payload.code;\nglobal.set('authStats', authStats);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 430,
        "y": 480,
        "wires": [
            [
                "87625d98.46b48"
            ]
        ]
    },
    {
        "id": "cb0c5081.465dd",
        "type": "comment",
        "z": "fb1d09b1.5e4f88",
        "name": "ユーザID設定",
        "info": "",
        "x": 110,
        "y": 260,
        "wires": []
    },
    {
        "id": "c5f7105a.dd14",
        "type": "comment",
        "z": "fb1d09b1.5e4f88",
        "name": "oAuth2認証",
        "info": "",
        "x": 110,
        "y": 400,
        "wires": []
    },
    {
        "id": "603470de.3e3a2",
        "type": "debug",
        "z": "fb1d09b1.5e4f88",
        "name": "mente/setcode",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 320,
        "y": 400,
        "wires": []
    },
    {
        "id": "227d1110.59c9ce",
        "type": "comment",
        "z": "fb1d09b1.5e4f88",
        "name": "データ取得へ...",
        "info": "",
        "x": 1160,
        "y": 340,
        "wires": []
    },
    {
        "id": "ebe1c953.653188",
        "type": "template",
        "z": "fb1d09b1.5e4f88",
        "name": "unknown status",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!doctype html>\n<html>\n    <head>\n        <meta charset=\"utf-8\">\n        <title>stats</title>\n    </head>\n    <body>\n        <p>status:{{global.authStats.stat}}</p>\n        click <a href=\"{{global.authStats.url}}\" target=\"_blank\">here</a> to authorize.\n        <hr/>\n        <form action=\"/mente/setcode\" method=\"get\">\n            <input name=\"code\" type=\"text\" id=\"code\"><br>\n            <input type=\"submit\" value=\"設定\">\n        </form>\n        <form action=\"/mente/setcredentials\" method=\"post\" enctype=\"multipart/form-data\">\n            <input name=\"file\" type=\"file\" id=\"file\"><br>\n            <input type=\"submit\" value=\"アップロード\">\n        </form>\n    </body>\n</html>",
        "output": "str",
        "x": 620,
        "y": 180,
        "wires": [
            [
                "50c156ac.469528"
            ]
        ]
    },
    {
        "id": "77aec57c.ed44dc",
        "type": "function",
        "z": "ba669923.5b3848",
        "name": "create commandLog",
        "func": "var cFunc=global.get('cFunc');\nvar cLog = {\n    datetime: new Date().getTime(),\n    requestType: \"\",\n    resourceId: \"\",\n    eventId: \"\",\n    pin: \"\",\n    result: \"\",\n    before: {\n        subject: \"\",\n        description: \"\",\n        start: \"\",\n        end: \"\",\n    },\n    request: {\n        subject: \"\",\n        description: \"\",\n        start: \"\",\n        end: \"\",\n    }\n}\nmsg.cLog = cLog;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 240,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "83e0f421.1d8698",
        "type": "function",
        "z": "c58a19c0.ad3338",
        "name": "write log",
        "func": "const auth = global.get('auth');\nconst sheets = global.get('sheets');\nconst cFunc = global.get('cFunc');\n\nvar l = msg.cLog;\n\nfunction c(ts){\n    if(!ts || ts ===\"\"){\n        return ts;\n    }\n    return cFunc.getJstCommonString(cFunc.getTimeFromTimeString(ts));\n}\nconst req = {\n    spreadsheetId: '1XkAkXYc3tDURodovPVib4S1eEn-m-HXfR4JphY_BWnc',\n    range: 'A1',\n    valueInputOption: 'USER_ENTERED',\n    insertDataOption: 'INSERT_ROWS',\n    resource: {\n        values: [\n            [\n\t\t\t\tcFunc.getJstCommonString(l.datetime),\n\t\t\t\tl.requestType,\n\t\t\t\tl.resourceId,\n\t\t\t\tl.eventId,\n\t\t\t\tl.pin,\n\t\t\t\tl.result,\n\t\t\t\tl.before.subject,\n\t\t\t\tl.before.description,\n\t\t\t\tc(l.before.start),\n\t\t\t\tc(l.before.end),\n\t\t\t\tl.request.subject,\n\t\t\t\tl.request.description,\n\t\t\t\tc(l.request.start),\n\t\t\t\tc(l.request.end),\n            ],\n        ],\n    },\n    auth: auth,\n};\nconsole.log('***** calling sheets.spreadsheets.values.append *****')\nsheets.spreadsheets.values.append(req, (err, res) =>{\n    if(err){\n        console.log('***** error!' + err);\n    } else {\n        console.log('***** res: ' + res);\n    }\n});\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 240,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "ba940904.b76478",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "",
        "func": "var cFunc=global.get('cFunc');\n\nvar fmt = new Date(msg.t);\nmsg.fmt = fmt;\n\nvar df = cFunc.getDateObject(fmt);\nmsg.df = df;\n\nvar n2 = new Date();\nmsg.n2 = n2;\nvar t2 = cFunc.getTimeString(n2.getTime());\nmsg.t2 = t2;\nvar d2 = cFunc.getDateObject(n2);\nmsg.d2 = d2;\n\nvar jt = cFunc.getJstCommonString(msg.t);\nmsg.jt = jt;\nvar jt2 = cFunc.getJstCommonString(n2.getTime());\nmsg.jt2 = jt2;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 270,
        "y": 1800,
        "wires": [
            [
                "b9152e74.f8ccb"
            ]
        ]
    },
    {
        "id": "74870052.0b6d4",
        "type": "inject",
        "z": "fabbdf33.d3c4",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 100,
        "y": 1380,
        "wires": [
            [
                "76c9c106.edbc"
            ]
        ]
    },
    {
        "id": "76c9c106.edbc",
        "type": "function",
        "z": "fabbdf33.d3c4",
        "name": "set CommandLog(Modify)",
        "func": "msg.cLog = {before:{},request:{}};\nmsg.cLog.requestType = \"Modify\";\nmsg.cLog.resourceId = \"msg.req.params.resourceid\";\nmsg.cLog.eventId = \"msg.req.params.eventid\";\nmsg.cLog.pin = \"msg.req.body.pin\";\nmsg.cLog.before.subject = \"msg.orgEvent.summary\";\nmsg.cLog.before.description = \"msg.orgEvent.description\";\nmsg.cLog.before.start = \"msg.orgEvent.start.dateTime\";\nmsg.cLog.before.end = \"msg.orgEvent.end.dateTime\";\n\n//var timeMin = msg.req.body.date+'T'+msg.req.body.start+':00+09:00';\n//var timeMax = msg.req.body.date+'T'+msg.req.body.end+':00+09:00';\n//var orgStats = msg.orgEvent.description.split(':');\n//var orgStatus = orgStats[0];\n//var orgSaved = orgStats[3];\nmsg.cLog.request.subject = \"msg.req.body.subject\";\nmsg.cLog.request.description = \"orgStatus+':'+msg.req.body.user+':'+msg.req.body.newPin+':'+orgSaved\",\nmsg.cLog.request.start = \"timeMin\";\nmsg.cLog.request.end = \"timeMax\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 300,
        "y": 1380,
        "wires": [
            [
                "fdbf9bff.e4f788"
            ]
        ]
    },
    {
        "id": "fdbf9bff.e4f788",
        "type": "subflow:c58a19c0.ad3338",
        "z": "fabbdf33.d3c4",
        "x": 500,
        "y": 1380,
        "wires": [
            [
                "8f072a09.5363b8"
            ]
        ]
    },
    {
        "id": "8f072a09.5363b8",
        "type": "debug",
        "z": "fabbdf33.d3c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 630,
        "y": 1380,
        "wires": []
    },
    {
        "id": "385fd8a.2f07228",
        "type": "change",
        "z": "f07df9cc.834608",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "req.body",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 510,
        "y": 100,
        "wires": [
            [
                "d21e2614.84f7d8",
                "10a4548a.b5c54b"
            ]
        ]
    },
    {
        "id": "dbb03cb3.116fb",
        "type": "change",
        "z": "f07df9cc.834608",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 100,
        "wires": [
            [
                "385fd8a.2f07228"
            ]
        ]
    },
    {
        "id": "d21e2614.84f7d8",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 690,
        "y": 60,
        "wires": []
    },
    {
        "id": "906a4f33.f8389",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "param",
        "func": "var calendarId = msg.req.params.id;\nvar timeMin = msg.payload.date+'T'+msg.payload.start+':00+09:00';\nvar timeMax = msg.payload.date+'T'+msg.payload.end+':00+09:00';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'check': {\n            'timeMin': timeMin,\n            'timeMax': timeMax,\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 690,
        "y": 140,
        "wires": [
            [
                "881a2a79.cbf518"
            ]
        ]
    },
    {
        "id": "ab1f15d3.2b9cb8",
        "type": "inject",
        "z": "f07df9cc.834608",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"id\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\"},\"query\":{},\"body\":{\"date\":\"2018-11-29\",\"start\":\"18:00\",\"end\":\"19:00\",\"user\":\"社員abc\",\"subject\":\"テスト会議X\",\"pin\":\"1234\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 100,
        "wires": [
            [
                "dbb03cb3.116fb"
            ]
        ]
    },
    {
        "id": "b74f7518.bd1558",
        "type": "http in",
        "z": "f07df9cc.834608",
        "name": "",
        "url": "/resources/:id/events",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 140,
        "wires": [
            [
                "d21e2614.84f7d8",
                "10a4548a.b5c54b"
            ]
        ]
    },
    {
        "id": "3845c40.a4e183c",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "calendar.Freebusy.query",
        "func": "const calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar check = {\n    auth: auth,\n    resource: msg.payload.param.check\n};\n\nconsole.log('calendar.Freebusy.query:'+check);\nvar response = calendar.freebusy.query(check,\n    function(err, response){\n        var obj={status:-1, statusLabel:'不明'};\n        console.dir(err);\n        if(response){\n            console.dir(response.data);\n        }\n        \n        if(response && \n            response.data &&\n            response.data.calendars &&\n            response.data.calendars[msg.req.params.id] &&\n            response.data.calendars[msg.req.params.id].busy){\n            if(response.data.calendars[msg.req.params.id].busy.length === 0){\n                //vacancy\n                obj.status=0;\n                obj.statusLabel='OK';\n            } else {\n                obj.status=1;\n                obj.statusLabel='NG';\n            }\n        }\n        msg.payload={param:msg.payload.param, result:obj};\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 360,
        "y": 180,
        "wires": [
            [
                "ca3568fe.320208",
                "fbbede64.235db"
            ]
        ]
    },
    {
        "id": "ca3568fe.320208",
        "type": "switch",
        "z": "f07df9cc.834608",
        "name": "",
        "property": "payload.result.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 180,
        "y": 240,
        "wires": [
            [
                "445978ec.615398"
            ],
            [
                "e32ca0e0.b84d2"
            ]
        ]
    },
    {
        "id": "fbbede64.235db",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 560,
        "y": 180,
        "wires": []
    },
    {
        "id": "445978ec.615398",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "busy",
        "func": "var result={\n    status: \"busy\"\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 320,
        "y": 220,
        "wires": [
            [
                "1a97b3ec.56bfcc"
            ]
        ]
    },
    {
        "id": "c53e239c.5e58",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "ok",
        "func": "var result={\n    status: \"ok\",\n    id: msg.payload.id\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 880,
        "y": 260,
        "wires": [
            [
                "4108abf9.e16224"
            ]
        ]
    },
    {
        "id": "1d503cbb.a62dc3",
        "type": "comment",
        "z": "f07df9cc.834608",
        "name": "予約登録",
        "info": "",
        "x": 110,
        "y": 60,
        "wires": []
    },
    {
        "id": "e32ca0e0.b84d2",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "event",
        "func": "msg.payload.event={\n    \"subject\": msg.req.body.subject,\n    \"user\": msg.req.body.user,\n    \"pin\": msg.req.body.pin,\n    \"status\": 0,\n    \"saved\": 0,\n    \"checkedin\": -1\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 320,
        "y": 260,
        "wires": [
            [
                "301a639d.9ce71c"
            ]
        ]
    },
    {
        "id": "301a639d.9ce71c",
        "type": "subflow:4f14d068.abfcc",
        "z": "f07df9cc.834608",
        "name": "",
        "x": 480,
        "y": 260,
        "wires": [
            [
                "ae27c46c.b7b118",
                "743f2ab5.25e834"
            ]
        ]
    },
    {
        "id": "4108abf9.e16224",
        "type": "link out",
        "z": "f07df9cc.834608",
        "name": "",
        "links": [
            "d91dcffa.0378",
            "7544acc8.2bedc4"
        ],
        "x": 975,
        "y": 260,
        "wires": []
    },
    {
        "id": "ae27c46c.b7b118",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "イベント登録の戻りpayload",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 720,
        "y": 300,
        "wires": []
    },
    {
        "id": "1a97b3ec.56bfcc",
        "type": "link out",
        "z": "f07df9cc.834608",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "7e437210.166ecc"
        ],
        "x": 855,
        "y": 220,
        "wires": []
    },
    {
        "id": "881a2a79.cbf518",
        "type": "subflow:ba669923.5b3848",
        "z": "f07df9cc.834608",
        "x": 860,
        "y": 140,
        "wires": [
            [
                "a668046a.254128"
            ]
        ]
    },
    {
        "id": "a668046a.254128",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "set CommandLog(Create)",
        "func": "msg.cLog.requestType = \"Create\";\nmsg.cLog.resourceId = msg.req.params.id;\nmsg.cLog.eventId = \"\";\n//msg.cLog.pin = msg.req.body.pin;\n//msg.cLog.before.subject = msg.orgEvent.summary;\n//msg.cLog.before.description = msg.orgEvent.description;\n//msg.cLog.before.start = msg.orgEvent.start.dateTime;\n//msg.cLog.before.end = msg.orgEvent.end.dateTime;\n\nmsg.cLog.request.subject = msg.req.body.subject;\nmsg.cLog.request.description = '0:'+msg.req.body.user+':'+msg.req.body.pin+':0:-1',\nmsg.cLog.request.start = msg.payload.param.check.timeMin;\nmsg.cLog.request.end = msg.payload.param.check.timeMax;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1100,
        "y": 140,
        "wires": [
            [
                "3845c40.a4e183c"
            ]
        ]
    },
    {
        "id": "743f2ab5.25e834",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "set CommandLog(Create)",
        "func": "msg.cLog.eventId = msg.payload.id;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 700,
        "y": 260,
        "wires": [
            [
                "c53e239c.5e58"
            ]
        ]
    },
    {
        "id": "6538f7b8.3747e8",
        "type": "http in",
        "z": "f07df9cc.834608",
        "name": "",
        "url": "/resources/:resourceid/events/:eventid",
        "method": "delete",
        "upload": false,
        "swaggerDoc": "",
        "x": 220,
        "y": 460,
        "wires": [
            [
                "8f854932.e48c28",
                "fdcd142e.e3f288"
            ]
        ]
    },
    {
        "id": "8f854932.e48c28",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "param",
        "func": "var master ='master@kaigishitsu.work';\n\nmsg.payload={\n    param: {\n        //calendarId: msg.req.params.resourceid,\n        calendarId: master,\n        eventId: msg.req.params.eventid\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 490,
        "y": 460,
        "wires": [
            [
                "928b24c7.2e45e8"
            ]
        ]
    },
    {
        "id": "fdcd142e.e3f288",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 490,
        "y": 420,
        "wires": []
    },
    {
        "id": "7c68d01c.c4ff6",
        "type": "change",
        "z": "f07df9cc.834608",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 420,
        "wires": [
            [
                "fdcd142e.e3f288",
                "8f854932.e48c28"
            ]
        ]
    },
    {
        "id": "f6024aef.5999d8",
        "type": "inject",
        "z": "f07df9cc.834608",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"resourceid\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\",\"eventid\":\"djcjsd67gkduhog10cnatfjreg\"},\"query\":{}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 420,
        "wires": [
            [
                "7c68d01c.c4ff6"
            ]
        ]
    },
    {
        "id": "a08cd256.2b8e8",
        "type": "comment",
        "z": "f07df9cc.834608",
        "name": "予約削除",
        "info": "",
        "x": 110,
        "y": 380,
        "wires": []
    },
    {
        "id": "f9089f5f.13507",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "calendar.events.delete",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\nconsole.log('calling calendar.events.delete###')\nconsole.log('calendarId:'+msg.payload.param.calendarId);\nconsole.log('eventId:'+msg.payload.param.eventId);\n\n    calendar.events.delete({\n        calendarId: msg.payload.param.calendarId,\n        eventId: msg.payload.param.eventId\n    }, \n    (err, event) => {\n        if (err) {\n            console.log('There was an error contacting the Calendar service: ' + err);\n        } else {\n            console.log('Event deleted.');\n        }\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 590,
        "y": 540,
        "wires": [
            [
                "13126e96.190c51"
            ]
        ]
    },
    {
        "id": "13126e96.190c51",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "ok",
        "func": "var result={\n    status: \"ok\",\n    id: msg.payload.id\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 770,
        "y": 540,
        "wires": [
            [
                "e2f95a11.e4c448"
            ]
        ]
    },
    {
        "id": "e2f95a11.e4c448",
        "type": "link out",
        "z": "f07df9cc.834608",
        "name": "",
        "links": [
            "350ae040.5d597",
            "d91dcffa.0378",
            "7544acc8.2bedc4"
        ],
        "x": 855,
        "y": 540,
        "wires": []
    },
    {
        "id": "928b24c7.2e45e8",
        "type": "subflow:ba669923.5b3848",
        "z": "f07df9cc.834608",
        "x": 580,
        "y": 500,
        "wires": [
            [
                "272c26af.95949a"
            ]
        ]
    },
    {
        "id": "272c26af.95949a",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "set CommandLog(Delete)",
        "func": "msg.cLog.requestType = \"Delete\";\nmsg.cLog.resourceId = msg.payload.param.calendarId;\nmsg.cLog.eventId = msg.req.params.eventid;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 820,
        "y": 500,
        "wires": [
            [
                "f9089f5f.13507"
            ]
        ]
    },
    {
        "id": "8bdfc9fb.6c7428",
        "type": "comment",
        "z": "f07df9cc.834608",
        "name": "予約変更",
        "info": "",
        "x": 100,
        "y": 620,
        "wires": []
    },
    {
        "id": "a51b6aba.55cc58",
        "type": "http in",
        "z": "f07df9cc.834608",
        "name": "",
        "url": "/resources/:resourceid/events/:eventid",
        "method": "put",
        "upload": false,
        "swaggerDoc": "",
        "x": 210,
        "y": 700,
        "wires": [
            [
                "4860739a.741bfc",
                "a924dfe1.8443e"
            ]
        ]
    },
    {
        "id": "8c34c146.54b5d",
        "type": "inject",
        "z": "f07df9cc.834608",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"resourceid\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\",\"eventid\":\"djcjsd67gkduhog10cnatfjreg\"},\"query\":{},\"body\":{\"date\":\"2018-11-29\",\"start\":\"18:00\",\"end\":\"19:00\",\"user\":\"社員abc\",\"subject\":\"テスト会議X\",\"pin\":\"1234\",\"newPin\":\"1234\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 660,
        "wires": [
            [
                "2e30c1db.99c23e"
            ]
        ]
    },
    {
        "id": "2e30c1db.99c23e",
        "type": "change",
        "z": "f07df9cc.834608",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 660,
        "wires": [
            [
                "4860739a.741bfc",
                "a924dfe1.8443e"
            ]
        ]
    },
    {
        "id": "4860739a.741bfc",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "予約変更",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 480,
        "y": 660,
        "wires": []
    },
    {
        "id": "19f1d700.28bd29",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "param",
        "func": "msg.payload={\n    //param:{\n    //    resourceId: msg.req.params.id,\n    //    date: date,\n    //},\n    param: {\n        calendarId: msg.req.params.resourceid,\n        eventId: msg.req.params.eventid\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 470,
        "y": 740,
        "wires": [
            [
                "3f7074de.84826c"
            ]
        ]
    },
    {
        "id": "3f7074de.84826c",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "calendar.events.get",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\nconsole.log('calling calendar.events.get###')\nconsole.log('calendarId:'+msg.payload.param.calendarId);\nconsole.log('eventId:'+msg.payload.param.eventId);\n\n    calendar.events.get({\n        calendarId: msg.payload.param.calendarId,\n        eventId: msg.payload.param.eventId\n    }, (err, res) => {\n        if (err){\n            console.log('The API returned an error: ' + err);\n            msg.payload = {};\n            console.log('node.send();');\n            node.send(msg);\n            return;\n        }\n        console.log('res.data>>>');\n        console.dir(res.data);\n        const event = res.data;\n        if (event) {\n            console.log('target event:');\n            const start = event.start.dateTime || event.start.date;\n            console.log(`${start} - ${event.summary}`);\n            console.log(event);\n        } else {\n            console.log('No event found.');\n        }\n        msg.payload = {\"event\":event};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 640,
        "y": 740,
        "wires": [
            [
                "a1bae314.8e561"
            ]
        ]
    },
    {
        "id": "14d28a65.91a386",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 1070,
        "y": 740,
        "wires": []
    },
    {
        "id": "a1bae314.8e561",
        "type": "change",
        "z": "f07df9cc.834608",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "orgEvent",
                "pt": "msg",
                "to": "payload.event",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 850,
        "y": 740,
        "wires": [
            [
                "14d28a65.91a386",
                "b5e59301.49f92"
            ]
        ]
    },
    {
        "id": "566527c6.c3c328",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "param",
        "func": "var calendarId = msg.req.params.resourceid;\nvar eventId = msg.req.params.eventid;\nvar timeMin = msg.req.body.date+'T'+msg.req.body.start+':00+09:00';\nvar timeMax = msg.req.body.date+'T'+msg.req.body.end+':00+09:00';\nvar orgStats = msg.orgEvent.description.split(':');\nvar orgStatus = orgStats[0];\nvar orgSaved = orgStats[3];\nvar orgCheckedin = orgStats[4] || '-1';\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'eventId': eventId,\n        'check': {\n            'timeMin': timeMin,\n            'timeMax': timeMax,\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    },\n    'event': {\n        \"subject\": msg.req.body.subject,\n        \"user\": msg.req.body.user,\n        \"pin\": msg.req.body.newPin,\n        \"status\": parseInt(orgStatus, 10),\n        \"saved\": parseInt(orgSaved, 10),\n        \"checkedin\": parseInt(orgCheckedin, 10)\n    },\n    'eventId': eventId,\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 390,
        "y": 1200,
        "wires": [
            [
                "3be30d99.3d8252"
            ]
        ]
    },
    {
        "id": "3be30d99.3d8252",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "calendar.events.update",
        "func": "var calList = [];\nconst calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar timezone = 'Asia/Tokyo';\nvar master ='master@kaigishitsu.work';\n\nvar returned = false;\n\nvar event = {\n    'summary': msg.payload.event.subject,\n    //'location': '',\n    'description': msg.payload.event.status+':'+msg.payload.event.user+':'+msg.payload.event.pin+':'+msg.payload.event.saved+':'+msg.payload.event.checkedin,\n    'start': {\n        'dateTime': msg.payload.param.check.timeMin,\n        'timeZone': timezone,\n    },\n    'end': {\n        'dateTime': msg.payload.param.check.timeMax,\n        'timeZone': 'Asia/Tokyo',\n    },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n    'organizer': {'email': master},\n    'attendees': [\n        //{'email': master},\n        {'email': msg.payload.param.calendarId, 'resource': true}\n        ],\n    'reminders': {},\n};\nvar apiOptions = {\n    auth: auth,\n    calendarId: master,\n    eventId: msg.payload.eventId,\n    resource: event\n};\nconsole.log('apiOptions:'+apiOptions);\ncalendar.events.update(\n    apiOptions,\n    (err, event) => {\n        if (err) {\n            msg.payload.err = err;\n            console.log('There was an error contacting the Calendar service: ' + err);\n        } else {\n            console.log('Event created: %s', event.data.htmlLink);\n            msg.payload.id=event.data.id;\n        }\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 570,
        "y": 1200,
        "wires": [
            [
                "303963fa.19016c"
            ]
        ]
    },
    {
        "id": "c204ff5f.43c29",
        "type": "change",
        "z": "f07df9cc.834608",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.orgReq",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "371b819e.c103ae",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "busy",
        "func": "var result={\n    status: \"busy\"\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 770,
        "y": 1080,
        "wires": [
            [
                "bec31823.d12cb8"
            ]
        ]
    },
    {
        "id": "f24c3a4d.3a3738",
        "type": "switch",
        "z": "f07df9cc.834608",
        "name": "pinCheck",
        "property": "payload.targetPin",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "req.body.pin",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 880,
        "wires": [
            [
                "cc2ca20d.ae8f3"
            ],
            [
                "759f4ea6.d005"
            ]
        ]
    },
    {
        "id": "a9b980c4.719c5",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "brew PIN",
        "func": "var targetPin = msg.orgEvent.description.split(':')[2];\nmsg.payload.targetPin = targetPin;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 480,
        "y": 880,
        "wires": [
            [
                "f24c3a4d.3a3738"
            ]
        ]
    },
    {
        "id": "63281a72.57f234",
        "type": "link out",
        "z": "f07df9cc.834608",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "7e437210.166ecc"
        ],
        "x": 875,
        "y": 860,
        "wires": []
    },
    {
        "id": "cc2ca20d.ae8f3",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "bad pin",
        "func": "msg.payload = {\n    \"result\": {\"status\":'bad pin'}\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 780,
        "y": 860,
        "wires": [
            [
                "63281a72.57f234"
            ]
        ]
    },
    {
        "id": "bec31823.d12cb8",
        "type": "link out",
        "z": "f07df9cc.834608",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "7e437210.166ecc"
        ],
        "x": 875,
        "y": 1080,
        "wires": []
    },
    {
        "id": "759f4ea6.d005",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "param",
        "func": "var timeMin = msg.req.body.date+'T'+msg.req.body.start+':00+09:00';\nvar timeMax = msg.req.body.date+'T'+msg.req.body.end+':00+09:00';\n\nmsg.payload={\n    param: {\n        calendarId: msg.req.params.resourceid,\n        timeMin: timeMin,\n        timeMax: timeMax,\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 330,
        "y": 980,
        "wires": [
            [
                "57d3e775.0cbde8"
            ]
        ]
    },
    {
        "id": "57d3e775.0cbde8",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "calendar.events.list",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\n    calendar.events.list({\n        calendarId: msg.payload.param.calendarId,\n        timeMin: msg.payload.param.timeMin,\n        timeMax: msg.payload.param.timeMax,\n        singleEvents: true,\n        orderBy: 'startTime',\n    }, (err, res) => {\n        if (err) return console.log('The API returned an error: ' + err);\n        const events = res.data.items;\n        if (events.length) {\n            console.log('Upcoming 10 events:');\n            events.map((event, i) => {\n                const start = event.start.dateTime || event.start.date;\n                console.log(`${start} - ${event.summary}`);\n                console.log(event);\n                eventList.push(event);\n            });\n        } else {\n            console.log('No upcoming events found.');\n        }\n        msg.payload = {\"events\":eventList};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 500,
        "y": 980,
        "wires": [
            [
                "75bce6b0.6affa8"
            ]
        ]
    },
    {
        "id": "75bce6b0.6affa8",
        "type": "change",
        "z": "f07df9cc.834608",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.events",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 980,
        "wires": [
            [
                "4e2026d9.504c28"
            ]
        ]
    },
    {
        "id": "4e2026d9.504c28",
        "type": "switch",
        "z": "f07df9cc.834608",
        "name": "# of events",
        "property": "payload.length",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 350,
        "y": 1040,
        "wires": [
            [
                "566527c6.c3c328"
            ],
            [
                "e9f66a88.9f0b98"
            ],
            [
                "371b819e.c103ae"
            ]
        ]
    },
    {
        "id": "e3929bb0.38f998",
        "type": "comment",
        "z": "f07df9cc.834608",
        "name": "destination vacancy check",
        "info": "",
        "x": 340,
        "y": 940,
        "wires": []
    },
    {
        "id": "e9f66a88.9f0b98",
        "type": "switch",
        "z": "f07df9cc.834608",
        "name": "self?",
        "property": "payload[0].id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "req.params.eventid",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 530,
        "y": 1040,
        "wires": [
            [
                "566527c6.c3c328"
            ],
            [
                "371b819e.c103ae"
            ]
        ]
    },
    {
        "id": "256bf25e.f8a0de",
        "type": "comment",
        "z": "f07df9cc.834608",
        "name": "update event",
        "info": "",
        "x": 410,
        "y": 1160,
        "wires": []
    },
    {
        "id": "303963fa.19016c",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "ok",
        "func": "var result={\n    status: \"ok\",\n    id: msg.req.params.eventid\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 770,
        "y": 1200,
        "wires": [
            [
                "6a2a6cff.87c584"
            ]
        ]
    },
    {
        "id": "6a2a6cff.87c584",
        "type": "link out",
        "z": "f07df9cc.834608",
        "name": "",
        "links": [
            "350ae040.5d597",
            "d91dcffa.0378",
            "7544acc8.2bedc4"
        ],
        "x": 875,
        "y": 1200,
        "wires": []
    },
    {
        "id": "418a4037.f13a",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "set CommandLog(Modify)",
        "func": "msg.cLog.requestType = \"Modify\";\nmsg.cLog.resourceId = msg.req.params.resourceid;\nmsg.cLog.eventId = msg.req.params.eventid;\nmsg.cLog.pin = msg.req.body.pin;\nmsg.cLog.before.subject = msg.orgEvent.summary;\nmsg.cLog.before.description = msg.orgEvent.description;\nmsg.cLog.before.start = msg.orgEvent.start.dateTime;\nmsg.cLog.before.end = msg.orgEvent.end.dateTime;\n\nvar timeMin = msg.req.body.date+'T'+msg.req.body.start+':00+09:00';\nvar timeMax = msg.req.body.date+'T'+msg.req.body.end+':00+09:00';\nvar orgStats = msg.orgEvent.description.split(':');\nvar orgStatus = orgStats[0];\nvar orgSaved = orgStats[3];\nvar orgCheckedin = orgStats[4] || '-1';\nmsg.cLog.request.subject = msg.req.body.subject;\nmsg.cLog.request.description = orgStatus+':'+msg.req.body.user+':'+msg.req.body.newPin+':'+orgSaved+':'+orgCheckedin,\nmsg.cLog.request.start = timeMin;\nmsg.cLog.request.end = timeMax;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 820,
        "y": 780,
        "wires": [
            [
                "a9b980c4.719c5"
            ]
        ]
    },
    {
        "id": "b5e59301.49f92",
        "type": "subflow:ba669923.5b3848",
        "z": "f07df9cc.834608",
        "x": 580,
        "y": 780,
        "wires": [
            [
                "418a4037.f13a"
            ]
        ]
    },
    {
        "id": "b5784771.96c4a8",
        "type": "http in",
        "z": "f07df9cc.834608",
        "name": "",
        "url": "/resources/:resourceid/events/:eventid",
        "method": "patch",
        "upload": false,
        "swaggerDoc": "",
        "x": 220,
        "y": 1440,
        "wires": [
            [
                "2378c7f0.0f81a8"
            ]
        ]
    },
    {
        "id": "9f7518e1.c16968",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 490,
        "y": 1400,
        "wires": []
    },
    {
        "id": "4965f4c7.8816ec",
        "type": "change",
        "z": "f07df9cc.834608",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload.req",
                "pt": "msg",
                "to": "req",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 1400,
        "wires": [
            [
                "9f7518e1.c16968",
                "2378c7f0.0f81a8"
            ]
        ]
    },
    {
        "id": "2b87e7fc.033998",
        "type": "inject",
        "z": "f07df9cc.834608",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"resourceid\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\",\"eventid\":\"uvgn061ebva54f5fqtjhiliid0\"},\"query\":{\"operation\":\"checkin\"},\"body\":{\"pin\":\"9999\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 1320,
        "wires": [
            [
                "4965f4c7.8816ec"
            ]
        ]
    },
    {
        "id": "a73b918c.0c2c",
        "type": "comment",
        "z": "f07df9cc.834608",
        "name": "CheckIn/CheckOut/AutoCancel",
        "info": "?operation=checkin/checkout/autocancel\n",
        "x": 170,
        "y": 1280,
        "wires": []
    },
    {
        "id": "fb5650ef.d96b8",
        "type": "switch",
        "z": "f07df9cc.834608",
        "name": "",
        "property": "req.query.operation",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "checkin",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "checkout",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "autocancel",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 210,
        "y": 1560,
        "wires": [
            [
                "f8a37237.7cdd3"
            ],
            [
                "f8a37237.7cdd3"
            ],
            [
                "f8a37237.7cdd3"
            ],
            [
                "fe932d45.fef12"
            ]
        ]
    },
    {
        "id": "fe932d45.fef12",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "bad parameter",
        "func": "msg.payload = {\n    \"result\": {\"status\":'bad parameter'}\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 360,
        "y": 1860,
        "wires": [
            [
                "903f88eb.4f1d48"
            ]
        ]
    },
    {
        "id": "ecd6e5d2.3a5e58",
        "type": "subflow:247548cc.9b7088",
        "z": "f07df9cc.834608",
        "name": "",
        "x": 620,
        "y": 1540,
        "wires": [
            [
                "6fe50731.a26c58"
            ]
        ]
    },
    {
        "id": "f8a37237.7cdd3",
        "type": "change",
        "z": "f07df9cc.834608",
        "name": "timestamp",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 1540,
        "wires": [
            [
                "ecd6e5d2.3a5e58"
            ]
        ]
    },
    {
        "id": "6fe50731.a26c58",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "get event and status",
        "func": "var status = -1;\nvar event;\nif (msg.payload.currentStatus &&\n    msg.payload.currentStatus.resources){\n    for (var resource of msg.payload.currentStatus.resources){\n        console.log('resource>>>');\n        console.dir(resource);\n        if(msg.req.params.resourceid === resource.resourceId){\n            console.log('resource:match, eventId:'+resource.event.eventId);\n            if(msg.req.params.eventid === resource.event.eventId)\n            status = resource.status;\n            event = resource.event;\n            break;\n        }\n    }\n}\nmsg.payload={\n    \"status\": status,\n    \"event\": event\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 460,
        "y": 1580,
        "wires": [
            [
                "486bd338.91067c",
                "9b27d451.265dc8"
            ]
        ]
    },
    {
        "id": "193e591d.d790e7",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 830,
        "y": 1680,
        "wires": []
    },
    {
        "id": "c70f0f6.4aba6f",
        "type": "switch",
        "z": "f07df9cc.834608",
        "name": "statusCheck",
        "property": "payload.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gte",
                "v": "0",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 390,
        "y": 1780,
        "wires": [
            [
                "2a40c93f.0a1516"
            ],
            [
                "93ddc39.ddc104"
            ]
        ]
    },
    {
        "id": "93ddc39.ddc104",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "no current event found",
        "func": "msg.payload = {\n    \"result\": {\"status\":'no current event found'}\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 610,
        "y": 1800,
        "wires": [
            [
                "468035e5.0a854c"
            ]
        ]
    },
    {
        "id": "bc676572.982ec8",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "newStatus",
        "func": "var cFunc=global.get('cFunc');\n\nvar targetStatus;\nvar newEventStatus;\nvar newEndTime;\nvar savedTime = 0;\nvar orgStats = msg.payload.event.detail.description.split(':');\nvar checkedinTime = -1;\nif(orgStats[4]){\n    checkedinTime = parseInt(orgStats[4], 10);    \n}\n\nvar now = msg.payload.now;\nswitch(msg.req.query.operation){\n    case 'checkin':\n        targetStatus = 1; //未CheckIn\n        newEventStatus = 1; //CheckedIn\n        // チェックイン時間の計算\n        checkedinTime = cFunc.getSavedTime(\n            now,\n            cFunc.getTimeFromTimeString(msg.payload.event.detail.start.dateTime)\n            );\n    break;\n    case 'checkout':\n        targetStatus = 2; //CheckIn\n        newEventStatus = 2; //CheckedOut\n        newEndTime = cFunc.getTimeString(now);\n        // 節約時間の計算\n        savedTime = cFunc.getSavedTime(\n            cFunc.getTimeFromTimeString(msg.payload.event.detail.end.dateTime), \n            now);\n    break;\n    case 'autocancel':\n        targetStatus = 1; //未CheckIn\n        newEventStatus = 9; //AutoCanceled\n        newEndTime = cFunc.getTimeString(now);\n        // 節約時間の計算\n        savedTime = cFunc.getSavedTime(\n            cFunc.getTimeFromTimeString(msg.payload.event.detail.end.dateTime), \n            now);\n    break;\n}\nmsg.payload.target = {\n    targetStatus: targetStatus,\n    newEventStatus: newEventStatus,\n    newEndTime: newEndTime,\n    savedTime: savedTime,\n    checkedinTime: checkedinTime\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 710,
        "y": 1640,
        "wires": [
            [
                "193e591d.d790e7",
                "c03c64e3.600f28"
            ]
        ]
    },
    {
        "id": "2a40c93f.0a1516",
        "type": "switch",
        "z": "f07df9cc.834608",
        "name": "pinCheck",
        "property": "payload.event.pin",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "req.body.pin",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 400,
        "y": 1700,
        "wires": [
            [
                "8e14c6a4.95bf28"
            ],
            [
                "f9c7cadf.c69348"
            ]
        ]
    },
    {
        "id": "f9c7cadf.c69348",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "bad pin",
        "func": "msg.payload = {\n    \"result\": {\"status\":'bad pin'}\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 560,
        "y": 1720,
        "wires": [
            [
                "7720f00e.176ac"
            ]
        ]
    },
    {
        "id": "486bd338.91067c",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 880,
        "y": 1540,
        "wires": []
    },
    {
        "id": "c03c64e3.600f28",
        "type": "switch",
        "z": "f07df9cc.834608",
        "name": "",
        "property": "payload.status",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "payload.target.targetStatus",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 850,
        "y": 1640,
        "wires": [
            [
                "1a0e3450.ef8e0c"
            ],
            [
                "b26f9074.be57e"
            ]
        ]
    },
    {
        "id": "b26f9074.be57e",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "bad status",
        "func": "msg.payload = {\n    \"result\": {status:'bad status'}\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1040,
        "y": 1840,
        "wires": [
            [
                "c3881d63.f419c"
            ]
        ]
    },
    {
        "id": "c3881d63.f419c",
        "type": "link out",
        "z": "f07df9cc.834608",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "7e437210.166ecc"
        ],
        "x": 1145,
        "y": 1840,
        "wires": []
    },
    {
        "id": "7720f00e.176ac",
        "type": "link out",
        "z": "f07df9cc.834608",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "7e437210.166ecc"
        ],
        "x": 655,
        "y": 1720,
        "wires": []
    },
    {
        "id": "468035e5.0a854c",
        "type": "link out",
        "z": "f07df9cc.834608",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "7e437210.166ecc"
        ],
        "x": 745,
        "y": 1800,
        "wires": []
    },
    {
        "id": "748ad68a.df8c68",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "calendar.events.update",
        "func": "var calList = [];\nconst calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar timezone = 'Asia/Tokyo';\nvar master ='master@kaigishitsu.work';\n\nvar returned = false;\n\nvar event = {\n    'summary': msg.payload.event.subject,\n    //'location': '',\n    'description': msg.payload.event.status+':'+msg.payload.event.user+':'+msg.payload.event.pin+':'+msg.payload.event.savedTime+':'+msg.payload.event.checkedinTime,\n    'start': {\n        'dateTime': msg.payload.param.check.timeMin,\n        'timeZone': timezone,\n    },\n    'end': {\n        'dateTime': msg.payload.param.check.timeMax,\n        'timeZone': 'Asia/Tokyo',\n    },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n    'organizer': {'email': master},\n    'attendees': [\n        //{'email': master},\n        {'email': msg.payload.param.calendarId, 'resource': true}\n        ],\n    'reminders': {},\n};\nvar apiOptions = {\n    auth: auth,\n    calendarId: master,\n    eventId: msg.payload.param.eventId,\n    resource: event\n};\nconsole.log('>>>>>calendar.events.update<<<<<')\nconsole.dir(apiOptions);\ncalendar.events.update(\n    apiOptions,\n    (err, event) => {\n        if (err) {\n            console.log('There was an error contacting the Calendar service: ' + err);\n        } else {\n            console.log('Event updated: %s', event.data.htmlLink);\n        }\n        msg.payload.id=event.data.id;\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 1110,
        "y": 1700,
        "wires": [
            [
                "f04c313d.a17d1"
            ]
        ]
    },
    {
        "id": "1a0e3450.ef8e0c",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "param",
        "func": "var check = {};\nvar calendarId = msg.req.params.resourceid;\nvar eventId = msg.payload.event.eventId;\nvar timeMin = msg.payload.event.detail.start.dateTime;\nvar timeMax = msg.payload.event.detail.end.dateTime;\nif(msg.payload.target.newEndTime){\n    timeMax = msg.payload.target.newEndTime;\n}\nvar param = {\n        'calendarId': calendarId,\n        'eventId': eventId,\n        'check': {\n            'timeMin': timeMin,\n            'timeMax': timeMax,\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    };\n\nmsg.payload.event.status = msg.payload.target.newEventStatus;\nmsg.payload.event.savedTime = msg.payload.target.savedTime;\nmsg.payload.event.checkedinTime = msg.payload.target.checkedinTime;\nmsg.payload.param = param;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 990,
        "y": 1620,
        "wires": [
            [
                "8a2d3ddf.5fcfe",
                "859e8b1d.880588"
            ]
        ]
    },
    {
        "id": "f04c313d.a17d1",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "ok",
        "func": "var result={\n    status: \"ok\",\n    id: msg.payload.id\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1070,
        "y": 1740,
        "wires": [
            [
                "9515c0ff.1a4b5",
                "33a66bd8.01d544"
            ]
        ]
    },
    {
        "id": "9515c0ff.1a4b5",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 1250,
        "y": 1780,
        "wires": []
    },
    {
        "id": "8a2d3ddf.5fcfe",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 1180,
        "y": 1620,
        "wires": []
    },
    {
        "id": "56287c92.caf394",
        "type": "inject",
        "z": "f07df9cc.834608",
        "name": "",
        "topic": "",
        "payload": "{\"req\":{\"params\":{\"resourceid\":\"kaigishitsu.work_3835353636383833343637@resource.calendar.google.com\",\"eventid\":\"uvgn061ebva54f5fqtjhiliid0\"},\"query\":{\"operation\":\"checkout\"},\"body\":{\"pin\":\"9999\"}}}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 110,
        "y": 1360,
        "wires": [
            [
                "4965f4c7.8816ec"
            ]
        ]
    },
    {
        "id": "8e14c6a4.95bf28",
        "type": "change",
        "z": "f07df9cc.834608",
        "name": "timestamp",
        "rules": [
            {
                "t": "set",
                "p": "payload.now",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 1640,
        "wires": [
            [
                "bc676572.982ec8"
            ]
        ]
    },
    {
        "id": "33a66bd8.01d544",
        "type": "link out",
        "z": "f07df9cc.834608",
        "name": "",
        "links": [
            "350ae040.5d597",
            "d91dcffa.0378",
            "7544acc8.2bedc4"
        ],
        "x": 1215,
        "y": 1740,
        "wires": []
    },
    {
        "id": "12c9435f.e498ad",
        "type": "link in",
        "z": "f07df9cc.834608",
        "name": "CheckIn/CheckOut/AutoCancel",
        "links": [
            "ca55bed.8b1e94"
        ],
        "x": 55,
        "y": 1400,
        "wires": [
            [
                "4965f4c7.8816ec"
            ]
        ]
    },
    {
        "id": "c62893ce.c92f5",
        "type": "link out",
        "z": "f07df9cc.834608",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "7e437210.166ecc"
        ],
        "x": 715,
        "y": 1860,
        "wires": []
    },
    {
        "id": "2378c7f0.0f81a8",
        "type": "subflow:ba669923.5b3848",
        "z": "f07df9cc.834608",
        "x": 540,
        "y": 1440,
        "wires": [
            [
                "fb5650ef.d96b8"
            ]
        ]
    },
    {
        "id": "903f88eb.4f1d48",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "set CommandLog(patch)",
        "func": "msg.cLog.requestType = \"patch\";\nmsg.cLog.resourceId = msg.req.params.resourceid;\nmsg.cLog.eventId = msg.payload.event.eventId;\n\nmsg.cLog.pin = msg.req.body.pin;\n//msg.cLog.before.subject = msg.orgEvent.summary;\n//msg.cLog.before.description = msg.orgEvent.description;\n//msg.cLog.before.start = msg.orgEvent.start.dateTime;\n//msg.cLog.before.end = msg.orgEvent.end.dateTime;\n\n//var calendarId = msg.req.params.id;\n//var timeMin = msg.payload.date+'T'+msg.payload.start+':00+09:00';\n//var timeMax = msg.payload.date+'T'+msg.payload.end+':00+09:00';\n//msg.cLog.request.subject = msg.req.body.subject;\n//msg.cLog.request.description = '0:'+msg.req.body.user+':'+msg.req.body.pin+':0',\n//msg.cLog.request.start = timeMin;\n//msg.cLog.request.end = timeMax;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 570,
        "y": 1860,
        "wires": [
            [
                "c62893ce.c92f5"
            ]
        ]
    },
    {
        "id": "9b27d451.265dc8",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "set CommandLog(CheckIn/CheckOut/AutoCancel)",
        "func": "msg.cLog.requestType = msg.req.query.operation;\nmsg.cLog.resourceId = msg.req.params.resourceid;\nmsg.cLog.eventId = msg.payload.event.eventId;\nmsg.cLog.pin = msg.req.body.pin;\n\nif(msg.payload.event.detail.summary){\n    msg.cLog.before.subject = msg.payload.event.detail.summary;\n    msg.cLog.before.description = msg.payload.event.detail.description;\n    msg.cLog.before.start = msg.payload.event.detail.start.dateTime;\n    msg.cLog.before.end = msg.payload.event.detail.end.dateTime;\n}\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 780,
        "y": 1580,
        "wires": [
            [
                "c70f0f6.4aba6f"
            ]
        ]
    },
    {
        "id": "859e8b1d.880588",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "set CommandLog(CheckIn/CheckOut/AutoCancel)2",
        "func": "\nvar timeMin = msg.payload.event.detail.start.dateTime;\nvar timeMax = msg.payload.event.detail.end.dateTime;\nif(msg.payload.target.newEndTime){\n    timeMax = msg.payload.target.newEndTime;\n}\n//msg.cLog.request.subject = msg.req.body.subject;\nmsg.cLog.request.description = msg.payload.target.newEventStatus+':'+msg.payload.event.user+':'+msg.payload.event.pin+':'+msg.payload.target.savedTime+':'+msg.payload.event.checkedinTime;\nmsg.cLog.request.start = timeMin;\nmsg.cLog.request.end = timeMax;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1190,
        "y": 1660,
        "wires": [
            [
                "748ad68a.df8c68"
            ]
        ]
    },
    {
        "id": "c035aecb.c33fb",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 400,
        "y": 2060,
        "wires": []
    },
    {
        "id": "7e437210.166ecc",
        "type": "link in",
        "z": "f07df9cc.834608",
        "name": "out w/logout",
        "links": [
            "1d0c40.ab6223c",
            "6b12229d.33d81c",
            "7427da23.5b53b4",
            "7c6fb6c4.dbb518",
            "ac5455ae.6eaf78",
            "ed3bf30c.4f206",
            "efcfca3d.22bf88",
            "f7e33d4.fa2f1c",
            "1a97b3ec.56bfcc",
            "66979f6a.1b196",
            "63281a72.57f234",
            "bec31823.d12cb8",
            "c3881d63.f419c",
            "7720f00e.176ac",
            "468035e5.0a854c",
            "c62893ce.c92f5",
            "3bc4a06a.d7f17"
        ],
        "x": 195,
        "y": 2100,
        "wires": [
            [
                "c035aecb.c33fb",
                "bc59f604.a291c8",
                "6279bd41.643714"
            ]
        ]
    },
    {
        "id": "bc59f604.a291c8",
        "type": "http response",
        "z": "f07df9cc.834608",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 370,
        "y": 2100,
        "wires": []
    },
    {
        "id": "6279bd41.643714",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "set commandLog(Result)",
        "func": "msg.cLog.result = msg.payload.result.status;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 2140,
        "wires": [
            [
                "685c2d6d.8fb614",
                "b56f8956.655848"
            ]
        ]
    },
    {
        "id": "685c2d6d.8fb614",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 640,
        "y": 2100,
        "wires": []
    },
    {
        "id": "763ec8f8.c07ce8",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 780,
        "y": 2140,
        "wires": []
    },
    {
        "id": "b56f8956.655848",
        "type": "subflow:c58a19c0.ad3338",
        "z": "f07df9cc.834608",
        "x": 650,
        "y": 2140,
        "wires": [
            [
                "763ec8f8.c07ce8"
            ]
        ]
    },
    {
        "id": "264fa5cb.16bc1a",
        "type": "comment",
        "z": "f07df9cc.834608",
        "name": "返答、ログ出力",
        "info": "",
        "x": 260,
        "y": 2040,
        "wires": []
    },
    {
        "id": "3ba795f6.cdd36a",
        "type": "delay",
        "z": "8bc72c78.d5201",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 140,
        "y": 1960,
        "wires": [
            [
                "70e82684.ff6798"
            ]
        ]
    },
    {
        "id": "70e82684.ff6798",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "param",
        "func": "msg.payload={\n    //param:{\n    //    resourceId: msg.req.params.id,\n    //    date: date,\n    //},\n    param: {\n        calendarId: msg.req.params.resourceid,\n        eventId: msg.req.params.eventid\n    }\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 270,
        "y": 1960,
        "wires": [
            [
                "47f37a1a.31e624"
            ]
        ]
    },
    {
        "id": "47f37a1a.31e624",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "calendar.events.get",
        "func": "var eventList = [];\n\nconst calendar = global.get('calendar');\n\nconsole.log('calling calendar.events.get###')\nconsole.log('calendarId:'+msg.payload.param.calendarId);\nconsole.log('eventId:'+msg.payload.param.eventId);\n\n    calendar.events.get({\n        calendarId: msg.payload.param.calendarId,\n        eventId: msg.payload.param.eventId\n    }, (err, res) => {\n        if (err){\n            console.log('The API returned an error: ' + err);\n            msg.payload = {};\n            console.log('node.send();');\n            node.send(msg);\n            return;\n        }\n        console.log('res.data>>>');\n        console.dir(res.data);\n        const event = res.data;\n        if (event) {\n            console.log('target event:');\n            const start = event.start.dateTime || event.start.date;\n            console.log(`${start} - ${event.summary}`);\n            console.log(event);\n        } else {\n            console.log('No event found.');\n        }\n        msg.payload = {\"event\":event};\n        console.log('node.send();');\n        node.send(msg);\n    });\n\nconsole.log('function end.');\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 440,
        "y": 1960,
        "wires": [
            [
                "a4266326.d621e",
                "982091d1.ae2df"
            ]
        ]
    },
    {
        "id": "a4266326.d621e",
        "type": "change",
        "z": "8bc72c78.d5201",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.event.attendees",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 1960,
        "wires": [
            [
                "43cd9340.ee29dc",
                "66bc1e7e.f0c94"
            ]
        ]
    },
    {
        "id": "43cd9340.ee29dc",
        "type": "switch",
        "z": "8bc72c78.d5201",
        "name": "",
        "property": "payload[0].responseStatus",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "accepted",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "declined",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 250,
        "y": 2040,
        "wires": [
            [
                "b0a6ceae.e9f38"
            ],
            [
                "b134ef12.b3a1e"
            ],
            [
                "3ba795f6.cdd36a"
            ]
        ]
    },
    {
        "id": "b0a6ceae.e9f38",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "ok",
        "func": "var result={\n    status: \"ok\",\n    id: msg.req.params.eventid\n};\nmsg.payload={result:result};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 370,
        "y": 2020,
        "wires": [
            [
                "88a056f8.0e44a8"
            ]
        ]
    },
    {
        "id": "88a056f8.0e44a8",
        "type": "link out",
        "z": "8bc72c78.d5201",
        "name": "",
        "links": [
            "350ae040.5d597",
            "d91dcffa.0378",
            "7544acc8.2bedc4"
        ],
        "x": 455,
        "y": 2020,
        "wires": []
    },
    {
        "id": "b134ef12.b3a1e",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "param",
        "func": "var calendarId = msg.req.params.resourceid;\nvar eventId = msg.req.params.eventid;\nvar timeMin = msg.orgEvent.start.dateTime;\nvar timeMax = msg.orgEvent.end.dateTime;\nvar dsk = msg.orgEvent.description.split(':');\n\nmsg.payload = {\n    'param': {\n        'calendarId': calendarId,\n        'eventId': eventId,\n        'check': {\n            'timeMin': timeMin,\n            'timeMax': timeMax,\n            'timeZone': 'Asia/Tokyo',\n            'items': [{'id': calendarId}],\n        }\n    },\n    'event': {\n        \"subject\": msg.orgEvent.summary,\n        \"description\": msg.orgEvent.description,\n        \"status\": dsk[0],\n        \"user\": dsk[1],\n        \"pin\": dsk[2],\n        \"saved\": dsk[3]\n    },\n    'eventId': eventId,\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 370,
        "y": 2060,
        "wires": [
            [
                "c1b761f0.85d28"
            ]
        ]
    },
    {
        "id": "c1b761f0.85d28",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "calendar.events.update",
        "func": "var calList = [];\nconst calendar = global.get('calendar');\nconst auth = global.get('auth');\nvar timezone = 'Asia/Tokyo';\nvar master ='master@kaigishitsu.work';\n\nvar returned = false;\n\nvar event = {\n    'summary': msg.payload.event.subject,\n    //'location': '',\n    'description': msg.payload.event.status+':'+msg.payload.event.user+':'+msg.payload.event.pin+':'+msg.payload.event.saved,\n    'start': {\n        'dateTime': msg.payload.param.check.timeMin,\n        'timeZone': timezone,\n    },\n    'end': {\n        'dateTime': msg.payload.param.check.timeMax,\n        'timeZone': 'Asia/Tokyo',\n    },\n//      'recurrence': [\n//        'RRULE:FREQ=DAILY;COUNT=2'\n//      ],\n    'organizer': {'email': master},\n    'attendees': [\n        //{'email': master},\n        {'email': msg.payload.param.calendarId, 'resource': true}\n        ],\n    'reminders': {},\n};\nvar apiOptions = {\n    auth: auth,\n    calendarId: master,\n    eventId: msg.payload.eventId,\n    resource: event\n};\nconsole.log('apiOptions:'+apiOptions);\ncalendar.events.update(\n    apiOptions,\n    (err, event) => {\n        if (err) {\n            msg.payload.err = err;\n            console.log('There was an error contacting the Calendar service: ' + err);\n        } else {\n            console.log('Event created: %s', event.data.htmlLink);\n            msg.payload.id=event.data.id;\n        }\n        node.send(msg);\n    }\n);\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 550,
        "y": 2060,
        "wires": [
            []
        ]
    },
    {
        "id": "982091d1.ae2df",
        "type": "debug",
        "z": "8bc72c78.d5201",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 610,
        "y": 1920,
        "wires": []
    },
    {
        "id": "66bc1e7e.f0c94",
        "type": "debug",
        "z": "8bc72c78.d5201",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 870,
        "y": 1980,
        "wires": []
    },
    {
        "id": "85fd28f7.3db2e8",
        "type": "comment",
        "z": "8bc72c78.d5201",
        "name": "check if the change is accepted",
        "info": "",
        "x": 200,
        "y": 1920,
        "wires": []
    },
    {
        "id": "58741fa1.fd808",
        "type": "change",
        "z": "f07df9cc.834608",
        "name": "timestamp",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 2320,
        "wires": [
            [
                "b35dad53.7411a"
            ]
        ]
    },
    {
        "id": "b35dad53.7411a",
        "type": "subflow:247548cc.9b7088",
        "z": "f07df9cc.834608",
        "name": "",
        "x": 820,
        "y": 2320,
        "wires": [
            [
                "2d52ed8d.c90292",
                "7b89d0d9.4b134"
            ]
        ]
    },
    {
        "id": "2d52ed8d.c90292",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "現在状況after登録/更新",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "x": 1030,
        "y": 2260,
        "wires": []
    },
    {
        "id": "7af77bca.75f0b4",
        "type": "delay",
        "z": "f07df9cc.834608",
        "name": "",
        "pauseType": "delay",
        "timeout": "4",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 500,
        "y": 2320,
        "wires": [
            [
                "58741fa1.fd808"
            ]
        ]
    },
    {
        "id": "6d1dee76.038a",
        "type": "change",
        "z": "f07df9cc.834608",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 330,
        "y": 2320,
        "wires": [
            [
                "7af77bca.75f0b4"
            ]
        ]
    },
    {
        "id": "7b89d0d9.4b134",
        "type": "change",
        "z": "f07df9cc.834608",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "response",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1020,
        "y": 2320,
        "wires": [
            [
                "3bc4a06a.d7f17"
            ]
        ]
    },
    {
        "id": "7544acc8.2bedc4",
        "type": "link in",
        "z": "f07df9cc.834608",
        "name": "ちょっと待って状況取得してresponse返す",
        "links": [
            "4108abf9.e16224",
            "b2ef4b94.e935b8",
            "4fd015f5.f2a5bc",
            "a3817771.6099f8",
            "204d2f3b.b7a51",
            "a6feb63e.314d58",
            "e2f95a11.e4c448",
            "6a2a6cff.87c584",
            "33a66bd8.01d544",
            "88a056f8.0e44a8"
        ],
        "x": 195,
        "y": 2320,
        "wires": [
            [
                "6d1dee76.038a"
            ]
        ]
    },
    {
        "id": "3bc4a06a.d7f17",
        "type": "link out",
        "z": "f07df9cc.834608",
        "name": "",
        "links": [
            "6a3e6699.a46ed8",
            "7e437210.166ecc"
        ],
        "x": 1135,
        "y": 2320,
        "wires": []
    },
    {
        "id": "cb7a050c.28e3c8",
        "type": "comment",
        "z": "f07df9cc.834608",
        "name": "現在状況を取得して返す",
        "info": "",
        "x": 290,
        "y": 2280,
        "wires": []
    },
    {
        "id": "89b6fef4.ffb39",
        "type": "catch",
        "z": "f07df9cc.834608",
        "name": "",
        "scope": null,
        "x": 1140,
        "y": 40,
        "wires": [
            [
                "61bc09dc.6371b8"
            ]
        ]
    },
    {
        "id": "61bc09dc.6371b8",
        "type": "debug",
        "z": "f07df9cc.834608",
        "name": "Exception!!",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 1290,
        "y": 40,
        "wires": []
    },
    {
        "id": "a924dfe1.8443e",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "escape for ':'",
        "func": "if(msg.req && msg.req.body && msg.req.body.user){\n    var u = msg.req.body.user.replace(/:/g, '：');\n    msg.req.body.user = u;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 330,
        "y": 740,
        "wires": [
            [
                "19f1d700.28bd29"
            ]
        ]
    },
    {
        "id": "10a4548a.b5c54b",
        "type": "function",
        "z": "f07df9cc.834608",
        "name": "escape for ':'",
        "func": "if(msg.req && msg.req.body && msg.req.body.user){\n    var u = msg.req.body.user.replace(/:/g, '：');\n    msg.req.body.user = u;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 550,
        "y": 140,
        "wires": [
            [
                "906a4f33.f8389"
            ]
        ]
    },
    {
        "id": "4f6c96d4.090a08",
        "type": "inject",
        "z": "8bc72c78.d5201",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "x": 120,
        "y": 220,
        "wires": [
            [
                "986fb625.6a4e48"
            ]
        ]
    },
    {
        "id": "986fb625.6a4e48",
        "type": "function",
        "z": "8bc72c78.d5201",
        "name": "",
        "func": "const auth = global.get('auth');\nconst sheets = global.get('sheets');\nconst cFunc = global.get('cFunc');\n\nconst req = {\n    spreadsheetId: '1HGQJF1RozlO7w4GmtUledSytyXsycFGOYN79ydUEqbs',\n    resource: {\n        dataFilters: [\n              {a1Range: \"B2:C3\",},\n//            {\n//                developerMetadataLookup: {\n//                    locationType: 'ROW',\n//                    metadataValue: 'valueOfA3',\n//                    \n//                },\n//            },\n        ],\n    },\n    auth: auth,\n};\nconsole.log('***** calling sheets.spreadsheets.values.batchGetByDataFilter *****')\nsheets.spreadsheets.values.batchGetByDataFilter(req, (err, res) =>{\n    if(err){\n        console.log('***** error!' + err);\n    } else {\n        msg.payload = {\n            data : res.data,\n        };\n        console.log('***** res?: ' + res);\n        console.dir(res);\n        console.dir(res.data);\n        node.send(msg);\n    }\n});\nreturn;",
        "outputs": 1,
        "noerr": 0,
        "x": 220,
        "y": 300,
        "wires": [
            [
                "b27c4c61.a2ae9"
            ]
        ]
    },
    {
        "id": "b27c4c61.a2ae9",
        "type": "debug",
        "z": "8bc72c78.d5201",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 300,
        "y": 240,
        "wires": []
    },
    {
        "id": "188fb2ec.9c1e8d",
        "type": "debug",
        "z": "fb1d09b1.5e4f88",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 840,
        "y": 460,
        "wires": []
    }
]